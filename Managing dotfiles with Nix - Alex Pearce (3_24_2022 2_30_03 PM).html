<!DOCTYPE html> <html style=--highlight-color:var(--highlight-color-1)><!--
 Page saved with SingleFile 
 url: https://alexpearce.me/2021/07/managing-dotfiles-with-nix/ 
 saved date: Thu Mar 24 2022 14:30:03 GMT+0530 (India Standard Time)
--><meta charset=utf-8><style>.utterances{position:relative;box-sizing:border-box;width:100%;max-width:760px;margin-left:auto;margin-right:auto}.utterances-frame{color-scheme:light;position:absolute;left:0;right:0;width:1px;min-width:100%;max-width:100%;height:100%;border:0}</style>
<meta http-equiv=X-UA-Compatible content="IE=edge">
<meta name=viewport content="width=device-width, initial-scale=1">
<title>Managing dotfiles with Nix - Alex Pearce</title>
<meta name=description content="How to manage your programs and dotfiles with Nix and Home Manager.">
<meta property=og:url content=https://alexpearce.me/2021/07/managing-dotfiles-with-nix/>
<meta property=og:title content="Managing dotfiles with Nix">
<meta property=og:description content="How to manage your programs and dotfiles with Nix and Home Manager.">
<style media=screen>:root{--content-width:680px;--font-stack:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--mono-stack:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--background-color:#ffffff;--copy-color:#24292e;--highlight-color-count:3;--highlight-color-1:#20a0ff;--highlight-color-2:#de4943;--highlight-color-3:#5bad64;--highlight-color:var(--highlight-color-1);--header-color:var(--copy-color);--code-background:#f4f4f4}@media (prefers-color-scheme:dark){:root{--background-color:#38444c;--copy-color:#f0f4f8;--code-background:#2f3940}}*{box-sizing:border-box}html{margin:0;padding:0;border-top:2px solid var(--highlight-color)}body{width:100%;margin:0;padding:0 1em;font-size:16px;font-family:var(--font-stack);line-height:1.63em;background:var(--background-color);color:var(--copy-color)}.masthead h1{padding-top:0;text-align:center}.masthead nav ul{display:flex;margin:0;padding:0;justify-content:center;list-style-type:none}.masthead nav ul li{margin:0 2em}main{margin:20px auto;padding:24px;border-radius:8px}@media only screen and (min-width:680px){main{width:var(--content-width);padding:24px 48px;box-shadow:0 2px 10px 0 rgba(0,0,0,0.03),0 2px 20px 10px rgba(0,0,0,0.02)}@media (prefers-color-scheme:dark){main{box-shadow:0 2px 10px 0 rgba(0,0,0,0.075),0 2px 20px 10px rgba(0,0,0,0.05)}}}hr,footer{border:0;border-top:1px solid #eee}hr.footnotes-sep{border-top-style:dashed}footer{display:flex;flex-flow:row-reverse;justify-content:space-between;margin:1em 0 0 0;padding:1em 0}@media (prefers-color-scheme:dark){hr,footer{border-top-color:#495862}}h1{font-size:1.75em;line-height:1.86em;padding-top:1.50em;margin-bottom:0.357em}h2{font-size:1.44em;line-height:1.13em;padding-top:1.35em;margin-bottom:0.913em}h3{font-size:1.19em;line-height:1.37em;padding-top:1.74em;margin-bottom:1.00em}h4{font-size:1.00em;line-height:1.63em;padding-top:0.500em;margin-bottom:1.13em}p{font-size:1.00em;line-height:1.63em;padding-top:0.500em;margin-bottom:1.13em}h1,h2,h3{color:var(--header-color)}h1 a{color:var(--header-color)}a{color:var(--highlight-color);text-decoration:none}a:hover{text-decoration:underline}ul,ol{padding-left:1.25em}header span{display:block}.with-icon::before,.with-icon::before{display:inline-block;content:' ';background-size:1em 1em;height:1em;width:1em;margin-left:-1.5em;margin-right:0.5em;opacity:0.9}.post-date::before{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc1MTInIGhlaWdodD0nNTEyJyB2aWV3Qm94PScwIDAgNTEyIDUxMic+PHRpdGxlPmlvbmljb25zLXY1LWU8L3RpdGxlPjxwYXRoIGQ9J000MTYsNjRINDAwVjQ4LjQ1YzAtOC42MS02LjYyLTE2LTE1LjIzLTE2LjQzQTE2LDE2LDAsMCwwLDM2OCw0OFY2NEgxNDRWNDguNDVjMC04LjYxLTYuNjItMTYtMTUuMjMtMTYuNDNBMTYsMTYsMCwwLDAsMTEyLDQ4VjY0SDk2YTY0LDY0LDAsMCwwLTY0LDY0VjQxNmE2NCw2NCwwLDAsMCw2NCw2NEg0MTZhNjQsNjQsMCwwLDAsNjQtNjRWMTI4QTY0LDY0LDAsMCwwLDQxNiw2NFpNMTM2LDQxNmEyNCwyNCwwLDEsMSwyNC0yNEEyNCwyNCwwLDAsMSwxMzYsNDE2Wm0wLTgwYTI0LDI0LDAsMSwxLDI0LTI0QTI0LDI0LDAsMCwxLDEzNiwzMzZabTgwLDgwYTI0LDI0LDAsMSwxLDI0LTI0QTI0LDI0LDAsMCwxLDIxNiw0MTZabTAtODBhMjQsMjQsMCwxLDEsMjQtMjRBMjQsMjQsMCwwLDEsMjE2LDMzNlptODAsODBhMjQsMjQsMCwxLDEsMjQtMjRBMjQsMjQsMCwwLDEsMjk2LDQxNlptMC04MGEyNCwyNCwwLDEsMSwyNC0yNEEyNCwyNCwwLDAsMSwyOTYsMzM2Wm0wLTgwYTI0LDI0LDAsMSwxLDI0LTI0QTI0LDI0LDAsMCwxLDI5NiwyNTZabTgwLDgwYTI0LDI0LDAsMSwxLDI0LTI0QTI0LDI0LDAsMCwxLDM3NiwzMzZabTAtODBhMjQsMjQsMCwxLDEsMjQtMjRBMjQsMjQsMCwwLDEsMzc2LDI1NlptNzItMTIwdjE2YTgsOCwwLDAsMS04LDhINzJhOCw4LDAsMCwxLTgtOFYxMjhBMzIuMDksMzIuMDksMCwwLDEsOTYsOTZINDE2YTMyLjA5LDMyLjA5LDAsMCwxLDMyLDMyWicvPjwvc3ZnPg==)}.post-tags::before{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc1MTInIGhlaWdodD0nNTEyJyB2aWV3Qm94PScwIDAgNTEyIDUxMic+PHRpdGxlPmlvbmljb25zLXY1LXA8L3RpdGxlPjxwYXRoIGQ9J000NDgsMTgzLjh2LTEyM0E0NC42Niw0NC42NiwwLDAsMCw0MDMuMjksMTZIMjgwLjM2YTMwLjYyLDMwLjYyLDAsMCwwLTIxLjUxLDguODlMMTMuMDksMjcwLjU4YTQ0Ljg2LDQ0Ljg2LDAsMCwwLDAsNjMuMzRsMTE3LDExN2E0NC44NCw0NC44NCwwLDAsMCw2My4zMywwTDQzOS4xMSwyMDUuMzFBMzAuNiwzMC42LDAsMCwwLDQ0OCwxODMuOFpNMzUyLDE0NGEzMiwzMiwwLDEsMSwzMi0zMkEzMiwzMiwwLDAsMSwzNTIsMTQ0WicvPjxwYXRoIGQ9J000OTYsNjRhMTYsMTYsMCwwLDAtMTYsMTZWMjA3LjM3TDIxOC42OSw0NjguNjlhMTYsMTYsMCwxLDAsMjIuNjIsMjIuNjJsMjYyLTI2MkEyOS44NCwyOS44NCwwLDAsMCw1MTIsMjA4VjgwQTE2LDE2LDAsMCwwLDQ5Niw2NFonLz48L3N2Zz4=)}@media (prefers-color-scheme:dark){.with-icon::before{filter:invert()}}header h1{padding:0}.post-tags{display:flex;margin:0;padding:0;list-style-type:none;text-transform:lowercase}.post-tags li{padding:0 4px}.post-tags li:first-child{padding-left:0}.post-tags li:after{content:","}.post-tags li:last-child:after{content:""}pre,code{font-family:var(--mono-stack);background:var(--code-background);border-radius:4px}pre{padding:0.7em 1em 0.8em 1em;overflow:auto}pre code{padding:0}code{padding:0.1em 0.3em 0.2em}.utterances{margin-top:-30px}code[class*="language-"],pre[class*="language-"]{direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*="language-"]::-moz-selection,pre[class*="language-"] ::-moz-selection,code[class*="language-"]::-moz-selection,code[class*="language-"] ::-moz-selection{text-shadow:none;background:#fafbf9}pre[class*="language-"]::selection,pre[class*="language-"] ::selection,code[class*="language-"]::selection,code[class*="language-"] ::selection{text-shadow:none;background:#fafbf9}pre[class*="language-"]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*="language-"]{padding:.1em;border-radius:.3em}.token.comment{color:#bdc3b7}.token.punctuation{color:#bdc3b7}.token.operator,.token.number{color:#1b6498}.token.function{color:#66a329}.token.selector{color:#4d8217}.token.attr-name{color:#66a329}.token.boolean,.token.string,.token.url,.token.attr-value,.token.keyword{color:#277fbe}.token.variable{color:#8dcefc}</style>
<link rel=canonical href=https://alexpearce.me/2021/07/managing-dotfiles-with-nix/>
<link rel=alternate type=application/rss+xml title="Alex Pearce" href=https://alexpearce.me/atom.xml>
<link rel=icon href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAA6hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgICAgICAgICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iPgogICAgICAgICA8eG1wOk1vZGlmeURhdGU+MjAxNi0wMi0wOFQxNDowMjo2NjwveG1wOk1vZGlmeURhdGU+CiAgICAgICAgIDx4bXA6Q3JlYXRvclRvb2w+UGl4ZWxtYXRvciAzLjQuMjwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpDb21wcmVzc2lvbj41PC90aWZmOkNvbXByZXNzaW9uPgogICAgICAgICA8dGlmZjpSZXNvbHV0aW9uVW5pdD4yPC90aWZmOlJlc29sdXRpb25Vbml0PgogICAgICAgICA8dGlmZjpZUmVzb2x1dGlvbj43MjwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6WFJlc29sdXRpb24+NzI8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgICAgIDxleGlmOlBpeGVsWERpbWVuc2lvbj4zMjwvZXhpZjpQaXhlbFhEaW1lbnNpb24+CiAgICAgICAgIDxleGlmOkNvbG9yU3BhY2U+MTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+MzI8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4K2ik4+QAAAstJREFUSA3tlstPGlEUxpkBQQQKAWyBVFBL00JiG7WNJU3cGWM1rJo0MSZN06RN+hc0cdFVd11302XTlU2aNH1sGhcE6yNitRVBQRBQGdEBeTrgMNNDbjNORygsNN0wi5sz93z3+809c+ZmMJalRed54edpXvFuAupWuFmi/18iyT8eYWU79D201me2DnRe58tYkWhjb5vMZ5L5bOaoQNHFEl1Wylo1bcpuvdFuNPPFNQHgMuVxgQt1XBQACiXq/ZKLyKTochm8HjqGFDI5kSbdQe/nX/MGtfbZ4Fi7SoMwNbvIF48mC1kQBRO7GSrPfyiFtHVyZPzF6ASatBnMPabOIVv/5L3xLr2BSCdfuz7RTIUNV02AO7ja23EFds2wrCcaRGr+iGEY/xZiqVjivOGAABg7KRJlqwOyVOHnTtjRbe8zXwWdJ7KB1HVHi+4i0hDZJAqqA2ZDPoWs1W609JutoAsdEKlCrq47CMoMg2QmtQ4F1QEzm97blms4hkFXQJXYSpUCjQC88QjI2pWayxp9TcD63nYie+jotiFFg1ViWGZ+yz+16JJJWp4OjnJvqEqbzmyuquXKXPEISMDQyBUwbpF7B7m0XqlGVP4YJokPP2agocU43tthdd50aNtUnEAIyJeo5VgIpG/cXzgRjuMMw0CVhu23uEkugGo8vjsil0oBL2wskUgImA/7YLMvnY9UMjln8W5hGrrWE6kOaBFLzNoqO0PLhS/ZHVyD5uG7g26gq3JUxFL78G44aoPBX4DQQTyeJpEdf7213aRVXICZxYY/CG75CWDnkPy4MgsJ6GXB2RBN7mvkbZCaC/sDiV3oWoou+YkYclmKBiJkokgfc6b8AEO/LXBqvp37xk+8uv8EzhyYgSNven2ZnxrrufPVu8B9Uyhl0V16PvyAL0PxH8DpxFnNnJTorBwFPk2AoCCnb5slOl0TwcxvIPAaHY0GYrkAAAAASUVORK5CYII="><style>.sf-hidden{display:none!important}</style><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:;"></head>
 <body>
 <div class=masthead>
 <h1 class=title><a href=https://alexpearce.me/>Alex Pearce</a></h1>
 <nav>
 <ul>
 <li><a href=https://alexpearce.me/>About</a></li>
 <li><a href=https://alexpearce.me/blog>Blog</a></li>
 <li><a href=https://github.com/alexpearce>Projects</a></li>
 </ul>
 </nav>
 </div>
 <main>
 <article class=post itemscope itemtype=http://schema.org/BlogPosting>
 <header class=post-header>
 <h1 class=post-title itemprop="name headline"><a href=https://alexpearce.me/2021/07/managing-dotfiles-with-nix/>Managing dotfiles with Nix</a></h1>
 <span class="post-date with-icon"><time datetime=2021-07-27T00:00:00+00:00 itemprop=datePublished>Published on 27 July 2021</time></span>
 <ul class="post-tags with-icon">
 
 <li><a href=https://alexpearce.me/blog/tags/tutorials/>Tutorials</a></li>
 
 <li><a href=https://alexpearce.me/blog/tags/terminal/>Terminal</a></li>
 
 <li><a href=https://alexpearce.me/blog/tags/sysadmin/>sysadmin</a></li>
 
 </ul>
 </header>
 <div itemprop=articleBody>
 <p>For several years I’ve been <a href=https://alexpearce.me/2016/02/managing-dotfiles-with-stow/>managing my dotfiles with GNU Stow</a>,
but there are a few things about it that bug me:</p>
<ul>
<li>You have to install the relevant programs separately.</li>
<li>You end up with many configurations files in many different languages.</li>
<li>It’s tricky to manage configurations which you want to differ slightly for
different machines and environments, e.g. macOS and Linux.</li>
</ul>
<p>For the first point I’ve long used <a href=https://brew.sh/>Homebrew</a> on macOS to install
system-wide programs. It is user-friendly but is pretty slow and it’s hard to
remember what packages I installed for what purpose.</p>
<p>To address these issues, I recently moved my dotfiles configuration to one
based on <a href=https://nixos.org/>Nix</a> and <a href=https://github.com/nix-community/home-manager>Home Manager</a> and I’m really enjoying
using them.</p>
<p>In this post I’d like to walk you through how to set up Nix and Home Manager
for managing programs and configuration on your own machine.</p>
<h2 id=nix%3F-home-manager%3F>Nix? Home Manager? <a class="header-anchor sf-hidden" href=#nix%3F-home-manager%3F>🔗</a></h2>
<p>Let’s first go over what the tools we’ll be using actually are.</p>
<p><a href=https://nixos.org/>Nix</a> is a package management and build system. Package and environment
definitions are written in the <a href=https://nixos.wiki/wiki/Nix_Expression_Language>Nix Expression Language</a>.</p>
<p>Nix aims to make building packages fully reproducible by explicitly defining
every input. Each package is placed in a file-system path which contains a
cryptographic checksum constructed from all inputs. Because a package’s source
is itself an input Nix can install multiple versions of any package side by
side. Environments can then be defined by choosing which versions of certain
packages you want to use. This paves the way for development environments
without system-wide conflicts!</p>
<p><a href=https://github.com/nix-community/home-manager>Home Manager</a> combines the package management prowess of Nix
with a system for generating program configuration from a Nix file.</p>
<p>This Home Manager configuration installs a few packages and sets some custom
configuration:</p>
<pre class=language-nix><code class=language-nix><span class="token punctuation">{</span> config<span class="token punctuation">,</span> pkgs<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">:</span><br><br><span class="token punctuation">{</span><br>  home <span class="token operator">=</span> <span class="token punctuation">{</span><br>    username <span class="token operator">=</span> <span class="token string">"apearce"</span><span class="token punctuation">;</span><br>    homeDirectory <span class="token operator">=</span> <span class="token string">"/Users/apearce"</span><span class="token punctuation">;</span><br>    <span class="token comment"># Specify packages not explicitly configured below</span><br>    packages <span class="token operator">=</span> <span class="token keyword">with</span> pkgs<span class="token punctuation">;</span> <span class="token punctuation">[</span><br>      jq<br>      neovim<br>      ripgrep<br>    <span class="token punctuation">]</span><span class="token punctuation">;</span><br>    sessionVariables <span class="token operator">=</span> <span class="token punctuation">{</span><br>      EDITOR <span class="token operator">=</span> <span class="token string">"neovim"</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    stateVersion <span class="token operator">=</span> <span class="token string">"21.11"</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  programs <span class="token operator">=</span> <span class="token punctuation">{</span><br>    fish <span class="token operator">=</span> <span class="token punctuation">{</span><br>      enable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>      shellAliases <span class="token operator">=</span> <span class="token punctuation">{</span><br>        rm <span class="token operator">=</span> <span class="token string">"rm -i"</span><span class="token punctuation">;</span><br>        cp <span class="token operator">=</span> <span class="token string">"cp -i"</span><span class="token punctuation">;</span><br>        mv <span class="token operator">=</span> <span class="token string">"mv -i"</span><span class="token punctuation">;</span><br>        mkdir <span class="token operator">=</span> <span class="token string">"mkdir -p"</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br>      shellAbbrs <span class="token operator">=</span> <span class="token punctuation">{</span><br>        g <span class="token operator">=</span> <span class="token string">"git"</span><span class="token punctuation">;</span><br>        m <span class="token operator">=</span> <span class="token string">"make"</span><span class="token punctuation">;</span><br>        n <span class="token operator">=</span> <span class="token string">"nvim"</span><span class="token punctuation">;</span><br>        o <span class="token operator">=</span> <span class="token string">"open"</span><span class="token punctuation">;</span><br>        p <span class="token operator">=</span> <span class="token string">"python3"</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>    home<span class="token operator">-</span>manager<span class="token punctuation">.</span>enable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>We’ll go over the details later, but you might be able to pick out a few
interesting features already:</p>
<ol>
<li>The <code>packages</code> key defines a list of programs we want Home Manager to
install.</li>
<li>The <code>programs</code> key defines a list of programs we want Home Manager to
install <em>and configure</em> in some custom way.</li>
</ol>
<p>The second point is how Home Manager manages our ‘dotfiles’ for us: there are
no longer any dotfiles!</p>
<p>Home Manager reads the configuration and figures out what programs need to be
installed and what dotfiles need to be generated. This is a <em>declarative</em>
approach and contracts with the imperative approach of using your OS’s package
manager and GNU Stow.</p>
<h2 id=installing-nix>Installing Nix <a class="header-anchor sf-hidden" href=#installing-nix>🔗</a></h2>
<p>The <a href=https://nixos.org/download.html>official installation instructions</a> are the best place to
start. Linux and macOS (on x86 and ARM) are both well supported.</p>
<pre class=language-shell><code class=language-shell>$ <span class="token function">curl</span> -L https://nixos.org/nix/install -o install.sh<br>$ <span class="token function">sh</span> install.sh --darwin-use-unencrypted-nix-store-volume<br>…<br>Installation finished<span class="token operator">!</span>  To ensure that the necessary environment<br>variables are set, either log <span class="token keyword">in</span> again, or <span class="token builtin class-name">type</span><br><br>  <span class="token builtin class-name">.</span> /Users/apearce/.nix-profile/etc/profile.d/nix.sh<br><br><span class="token keyword">in</span> your shell.</code></pre>
<p>The installer will quickly setup your system with the <code>/nix</code> folder, where
packages will be installed, and the binaries we’ll use to administer it.</p>
<p>If your default shell is <strong>bash</strong> or <strong>zsh</strong> then you should be able to start a new
shell and verify that you now have Nix installed:</p>
<pre class=language-shell><code class=language-shell>$ nix-shell -p nix-info --run <span class="token string">"nix-info -m"</span><br>…<br> - system: <span class="token variable"><span class="token variable">`</span>"aarch64-darwin"<span class="token variable">`</span></span><br> - <span class="token function">host</span> os: <span class="token variable"><span class="token variable">`</span>Darwin <span class="token number">21.1</span>.0, macOS <span class="token number">12.0</span>.1<span class="token variable">`</span></span><br> - multi-user?: <span class="token variable"><span class="token variable">`</span>no<span class="token variable">`</span></span><br> - sandbox: <span class="token variable"><span class="token variable">`</span>no<span class="token variable">`</span></span><br> - version: <span class="token variable"><span class="token variable">`</span>nix-env <span class="token punctuation">(</span>Nix<span class="token punctuation">)</span> <span class="token number">2.3</span>.16<span class="token variable">`</span></span><br> - channels<span class="token punctuation">(</span>apearce<span class="token punctuation">)</span>: <span class="token variable"><span class="token variable">`</span>"nixpkgs-21.11pre326545.9303cc04458"<span class="token variable">`</span></span><br> - nixpkgs: <span class="token variable"><span class="token variable">`</span>/Users/apearce/.nix-defexpr/channels/nixpkgs<span class="token variable">`</span></span></code></pre>
<p>If your default shell is <a href=https://fishshell.com/><strong>fish</strong></a> (heck yeah! 🐟) then this won’t work
as the Nix installer <a href=https://github.com/NixOS/nix/issues/1512>does not inject hooks for fish</a>. You
can run a bash or zsh sub-shell instead though:</p>
<pre class=language-shell><code class=language-shell>$ <span class="token function">zsh</span> -c <span class="token string">'nix-shell -p nix-info --run "nix-info -m"'</span></code></pre>
<p>Luckily there is a nice <a href=https://github.com/lilyball/nix-env.fish>fish plugin</a> that fixes this for us.
We’ll include this as part of our fish configuration in Home Manager later.
Until then you can drop in to a bash or zsh sub-shell for the upcoming
examples.</p>
<h3 id=trying-out-nix>Trying out Nix <a class="header-anchor sf-hidden" href=#trying-out-nix>🔗</a></h3>
<p>We can already try some of the cool features of Nix before we install Home Manager.</p>
<p>One of the neatest things is that we can ask Nix to start a sub-shell with some
specific programs included. Once we leave that sub-shell the programs will no
longer be available.</p>
<pre class=language-shell><code class=language-shell><span class="token comment"># See that `cowsay` is not available on our machine</span><br>$ <span class="token function">which</span> cowsay<br><br>$ nix-shell -p cowsay<br>these paths will be fetched <span class="token punctuation">(</span><span class="token number">7.62</span> MiB download, <span class="token number">48.87</span> MiB unpacked<span class="token punctuation">)</span>:<br>  /nix/store/frs6r654963v8klf875n8755a24x4z66-cowsay-3.04<br>  /nix/store/v1aja3gzmzxr112ndr2dbm9km82bv9rb-perl-5.34.0<br>copying path <span class="token string">'/nix/store/v1aja3gzmzxr112ndr2dbm9km82bv9rb-perl-5.34.0'</span> from <span class="token string">'https://cache.nixos.org'</span><span class="token punctuation">..</span>.<br>copying path <span class="token string">'/nix/store/frs6r654963v8klf875n8755a24x4z66-cowsay-3.04'</span> from <span class="token string">'https://cache.nixos.org'</span><span class="token punctuation">..</span>.<br><br><span class="token punctuation">[</span>nix-shell:~<span class="token punctuation">]</span>$ <span class="token function">which</span> cowsay<br>/nix/store/frs6r654963v8klf875n8755a24x4z66-cowsay-3.04/bin/cowsay<br><br><span class="token punctuation">[</span>nix-shell:~<span class="token punctuation">]</span>$ cowsay <span class="token string">'Moo?'</span><br> ______<br><span class="token operator">&lt;</span> Moo? <span class="token operator">&gt;</span><br> ------<br>        <span class="token punctuation">\</span>   ^__^<br>         <span class="token punctuation">\</span>  <span class="token punctuation">(</span>oo<span class="token punctuation">)</span><span class="token punctuation">\</span>_______<br>            <span class="token punctuation">(</span>__<span class="token punctuation">)</span><span class="token punctuation">\</span>       <span class="token punctuation">)</span><span class="token punctuation">\</span>/<span class="token punctuation">\</span><br>                <span class="token operator">||</span>----w <span class="token operator">|</span><br>                <span class="token operator">||</span>     <span class="token operator">||</span><br><br><span class="token punctuation">[</span>nix-shell:~<span class="token punctuation">]</span>$ <span class="token builtin class-name">exit</span><br><br><span class="token comment"># Back in the original shell, `cowsay` is still not available</span><br>$ <span class="token function">which</span> cowsay<br></code></pre>
<p>Nix:</p>
<ol>
<li>Downloads and installs the <code>cowsay</code> Nix package.</li>
<li>Creates an environment in which the <code>cowsay</code> Nix package is available (i.e.
in our executable <code>PATH</code>).</li>
<li>Starts a sub-shell which knows about the custom environment.</li>
</ol>
<p>(This technique can be extended to create <a href=https://nix.dev/tutorials/ad-hoc-developer-environments>ad-hoc development
environments</a> if you want to try to the latest hotness without
having to worry about anything conflicting with your usual tools. I hope to
expand on this further in a future post.)</p>
<p>Home Manager leverages this infrastructure to create a user-specific
environment, pulling in the packages we ask for.</p>
<h2 id=installing-home-manager>Installing Home Manager <a class="header-anchor sf-hidden" href=#installing-home-manager>🔗</a></h2>
<p>The <a href=https://github.com/nix-community/home-manager#installation>Home Manager installation</a> starts by including
a specific Nix ‘channel’ (a repository of Nix package definitions):</p>
<pre class=language-shell><code class=language-shell>$ nix-channel --add https://github.com/nix-community/home-manager/archive/master.tar.gz home-manager<br>$ nix-channel --update</code></pre>
<p>Then run the installer using the <code>install</code> definition from the new channel:</p>
<pre class=language-shell><code class=language-shell>$ nix-shell <span class="token string">'&lt;home-manager&gt;'</span> -A <span class="token function">install</span></code></pre>
<p>We can check that Home Manager has been installed:</p>
<pre class=language-shell><code class=language-shell>$ nix-env --query --installed<br>home-manager-path</code></pre>
<p>And we can then run the <code>home-manager</code> binary and see the default configuration
that was installed:</p>
<pre class=language-shell><code class=language-shell>$ home-manager --version<br><span class="token number">21.11</span><br>$ <span class="token function">cat</span> ~/.config/nixpkgs/home.nix</code></pre>
<p>It’ll look something like this:</p>
<pre class=language-nix><code class=language-nix><span class="token punctuation">{</span> config<span class="token punctuation">,</span> pkgs<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">:</span><br><br><span class="token punctuation">{</span><br>  <span class="token comment"># Let Home Manager install and manage itself.</span><br>  programs<span class="token punctuation">.</span>home<span class="token operator">-</span>manager<span class="token punctuation">.</span>enable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br><br>  <span class="token comment"># Home Manager needs a bit of information about you and the</span><br>  <span class="token comment"># paths it should manage.</span><br>  home<span class="token punctuation">.</span>username <span class="token operator">=</span> <span class="token string">"apearce"</span><span class="token punctuation">;</span><br>  home<span class="token punctuation">.</span>homeDirectory <span class="token operator">=</span> <span class="token string">"/Users/apearce"</span><span class="token punctuation">;</span><br><br>  <span class="token comment"># This value determines the Home Manager release that your</span><br>  <span class="token comment"># configuration is compatible with. This helps avoid breakage</span><br>  <span class="token comment"># when a new Home Manager release introduces backwards</span><br>  <span class="token comment"># incompatible changes.</span><br>  <span class="token comment">#</span><br>  <span class="token comment"># You can update Home Manager without changing this value. See</span><br>  <span class="token comment"># the Home Manager release notes for a list of state version</span><br>  <span class="token comment"># changes in each release.</span><br>  home<span class="token punctuation">.</span>stateVersion <span class="token operator">=</span> <span class="token string">"21.11"</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>All that’s left for us to do is edit this to suit our needs.</p>
<h2 id=configuring-home-manager>Configuring Home Manager <a class="header-anchor sf-hidden" href=#configuring-home-manager>🔗</a></h2>
<p>There are two jobs we’ll use Home Manager to take care of:</p>
<ol>
<li>Installing programs.</li>
<li>Creating and installing program configuration files (dotfiles).</li>
</ol>
<p>Home Manager will automatically install programs which we define configuration
for, so we’ll start with the programs we don’t need to configure explicitly.</p>
<h3 id=programs>Programs <a class="header-anchor sf-hidden" href=#programs>🔗</a></h3>
<p>I don’t have any configuration files for utilities like <a href=https://github.com/BurntSushi/ripgrep>ripgrep</a>. For
programs like this we can just tell Home Manager to install the corresponding
Nix package, which looks like this in your <code>~/.config/nixpkgs/home.nix</code>:</p>
<pre class=language-nix><code class=language-nix><span class="token punctuation">{</span> config<span class="token punctuation">,</span> pkgs<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">:</span><br><br><span class="token punctuation">{</span><br>  home<span class="token punctuation">.</span>username <span class="token operator">=</span> <span class="token string">"apearce"</span><span class="token punctuation">;</span><br>  <span class="token comment"># &lt;...&gt;</span><br><br>  packages <span class="token operator">=</span> <span class="token keyword">with</span> pkgs<span class="token punctuation">;</span> <span class="token punctuation">[</span><br>    ripgrep<br>  <span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>We then ask Home Manager to build and deploy the environment defined by our
<code>home.nix</code> with a single command:</p>
<pre class=language-shell><code class=language-shell>$ home-manager switch</code></pre>
<p>Once that’s finished we can verify that the <code>rg</code> binary is now available under
Home Manager’s installation path:</p>
<pre class=language-shell><code class=language-shell>$ <span class="token function">which</span> rg<br>/Users/apearce/.nix-profile/bin/rg</code></pre>
<p>We can install any Nix package this way; <a href=https://search.nixos.org/packages>search through them</a> to see what’s
available.</p>
<p>Uninstalling a package just means removing it from the list and running
<code>home-manager switch</code> as usual.</p>
<h3 id=configuration>Configuration <a class="header-anchor sf-hidden" href=#configuration>🔗</a></h3>
<p>Home Manager is able to convert configuration in <code>home.nix</code> into
program-specific configuration files.</p>
<p>This <code>home.nix</code> enables the <a href=https://github.com/sharkdp/bat>bat</a> Home Manager <em>module</em> and sets some
configuration:</p>
<pre class=language-nix><code class=language-nix><span class="token punctuation">{</span> config<span class="token punctuation">,</span> pkgs<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">:</span><br><br><span class="token punctuation">{</span><br>  home<span class="token punctuation">.</span>username <span class="token operator">=</span> <span class="token string">"apearce"</span><span class="token punctuation">;</span><br>  <span class="token comment"># ...</span><br><br>  programs<span class="token punctuation">.</span>bat <span class="token operator">=</span> <span class="token punctuation">{</span><br>    enable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>    config <span class="token operator">=</span> <span class="token punctuation">{</span><br>      theme <span class="token operator">=</span> <span class="token string">"GitHub"</span><span class="token punctuation">;</span><br>      italic<span class="token operator">-</span>text <span class="token operator">=</span> <span class="token string">"always"</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>After running <code>home-manager switch</code> we see we have the <code>bat</code> binary <em>and</em> a bat
configuration file:</p>
<pre class=language-shell><code class=language-shell>$ <span class="token function">which</span> bat<br>/Users/apearce/.nix-profile/bin/bat<br>$ <span class="token function">ls</span> -l ~/.config/bat<br>total <span class="token number">0</span><br>lrwxr-xr-x  <span class="token number">1</span> apearce  staff  <span class="token number">81</span> <span class="token number">26</span> Jul <span class="token number">14</span>:22 config -<span class="token operator">&gt;</span> /nix/store/j6vkynxy202rlgznwlcghhyydif277yl-home-manager-files/.config/bat/config<br>$ <span class="token function">cat</span> ~/.config/bat/config<br>--italic-text<span class="token operator">=</span><span class="token string">"always"</span><br>--theme<span class="token operator">=</span><span class="token string">"GitHub"</span></code></pre>
<p>Notice how the <code>~/.config/bat/config</code> file is just a <a href=https://en.wikipedia.org/wiki/Symbolic_link>symbolic link</a>
to a file managed by Home Manager. Home Manager will create, update, and remove
these files as necessary whenever we run <code>home-manager switch</code>. We no longer
need to manager dotfiles by hand!</p>
<p>The full list of Home Manager modules is best discovered by <a href=https://github.com/nix-community/home-manager/tree/master/modules/programs>browsing the
source</a>, so it’s useful to be able to skim these files to
learn how to configure the programs you care about.</p>
<p>The <a href=https://github.com/nix-community/home-manager/blob/f6f6990fc811454cb3082ba3662b711488fd0554/modules/programs/bat.nix><code>bat.nix</code></a> file, for example, has an
<code>options.programs.bat</code> member which contains the possible options we can set:</p>
<pre class=language-nix><code class=language-nix>options<span class="token punctuation">.</span>programs<span class="token punctuation">.</span>bat <span class="token operator">=</span> <span class="token punctuation">{</span><br>  enable <span class="token operator">=</span> mkEnableOption <span class="token string">"bat, a cat clone with wings"</span><span class="token punctuation">;</span><br><br>  config <span class="token operator">=</span> mkOption <span class="token punctuation">{</span><br>    type <span class="token operator">=</span> types<span class="token punctuation">.</span>attrsOf types<span class="token punctuation">.</span>str<span class="token punctuation">;</span><br>    default <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    example <span class="token operator">=</span> <span class="token punctuation">{</span><br>      theme <span class="token operator">=</span> <span class="token string">"TwoDark"</span><span class="token punctuation">;</span><br>      pager <span class="token operator">=</span> <span class="token string">"less -FR"</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    description <span class="token operator">=</span> <span class="token string">''<br>      Bat configuration.<br>    ''</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token comment"># ...</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>We set <code>programs.bat.enable = true</code> to tell Home Manager to generate the
default configuration. (Home Manager will, rather sensibly, also install bat in
this case; we don’t need to include it in the <code>packages</code> list.)</p>
<p>For the <code>programs.bat.config</code> member, the <code>typesAttrsOf types.str</code> value for
the <code>config.type</code> member tells us that we can set <code>programs.bat.config</code> to an
<a href=https://nixos.org/guides/nix-pills/basics-of-language.html#idm140737320585856>attribute set</a> of strings, which is what we did above.</p>
<p>The <a href=https://github.com/nix-community/home-manager/blob/f6f6990fc811454cb3082ba3662b711488fd0554/modules/programs/bat.nix#L47-L57><code>config</code> member</a> in the <code>bat.nix</code> file defines
how Home Manager will go from our Nix configuration to dotfiles. You don’t
normally need to know the details of how this is done, but looking at the
<code>config</code> member can be a good approach to understanding how to reproduce the
dotfiles you already have with Home Manager: reverse engineering!</p>
<p>Let’s go through a few more configurations to demonstrate more complex
structures.</p>
<h4 id=git>Git <a class="header-anchor sf-hidden" href=#git>🔗</a></h4>
<p>Git is primarily driven through the <code>~/.gitconfig</code> and <code>~/.gitignore</code> files, also
stored as <code>~/.config/git/{config,ignore}</code>.</p>
<p>A fairly standard Git configuration with Home Manager might look like this:</p>
<pre class=language-nix><code class=language-nix>programs<span class="token punctuation">.</span>git <span class="token operator">=</span> <span class="token punctuation">{</span><br>  enable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>  userName <span class="token operator">=</span> <span class="token string">"Your Name"</span><span class="token punctuation">;</span><br>  userEmail <span class="token operator">=</span> <span class="token string">"email@example.com"</span><span class="token punctuation">;</span><br>  aliases <span class="token operator">=</span> <span class="token punctuation">{</span><br>    prettylog <span class="token operator">=</span> <span class="token string">"..."</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  extraConfig <span class="token operator">=</span> <span class="token punctuation">{</span><br>    core <span class="token operator">=</span> <span class="token punctuation">{</span><br>      editor <span class="token operator">=</span> <span class="token string">"nvim"</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    color <span class="token operator">=</span> <span class="token punctuation">{</span><br>      ui <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    push <span class="token operator">=</span> <span class="token punctuation">{</span><br>      default <span class="token operator">=</span> <span class="token string">"simple"</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    pull <span class="token operator">=</span> <span class="token punctuation">{</span><br>      ff <span class="token operator">=</span> <span class="token string">"only"</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    init <span class="token operator">=</span> <span class="token punctuation">{</span><br>      defaultBranch <span class="token operator">=</span> <span class="token string">"main"</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  ignores <span class="token operator">=</span> <span class="token punctuation">[</span><br>    <span class="token string">".DS_Store"</span><br>    <span class="token string">"*.pyc"</span><br>  <span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Some members get mapped to specific configuration values in Git’s dotfiles,
e.g. setting <code>userName</code> results in:</p>
<pre class=language-ini><code class=language-ini><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">user</span><span class="token punctuation">]</span></span><br>	<span class="token key attr-name">name</span> <span class="token punctuation">=</span> <span class="token value attr-value">"<span class="token inner-value">Alex Pearce</span>"</span></code></pre>
<p>For configuration values without specific members the <code>extraConfig</code> attribute
set can be used.</p>
<p>The list of strings in the <code>ignores</code> member get placed in the <code>ignores</code>
configuration file.</p>
<p>One last trick is that we can easily integrate the <a href=https://github.com/dandavison/delta>delta diff
utility</a> utility into our Git configuration:</p>
<pre class=language-nix><code class=language-nix>programs<span class="token punctuation">.</span>git <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token comment"># ...</span><br>  delta <span class="token operator">=</span> <span class="token punctuation">{</span><br>    enable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>    options <span class="token operator">=</span> <span class="token punctuation">{</span><br>      navigate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>      line<span class="token operator">-</span>numbers <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>      syntax<span class="token operator">-</span>theme <span class="token operator">=</span> <span class="token string">"GitHub"</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>With this, Home Manager will take care of ensuring that delta is installed and
that Git’s <code>config</code> file contains entries for enabling delta.</p>
<p>The fact that <em>nested</em> configuration, with the <code>delta</code> member being inside the
<code>git</code> member, is able to affect not only the parent configuration (<code>git</code>) is a
neat feature of Home Manager modules. This technique can be used by other
modules to install handy aliases in your Home-Manager-managed shell, for
example.</p>
<h4 id=fish-shell>Fish shell <a class="header-anchor sf-hidden" href=#fish-shell>🔗</a></h4>
<p>I mentioned earlier that we can use the <a href=https://fishshell.com/>fish shell</a> with Nix if we also
use the <a href=https://github.com/lilyball/nix-env.fish><code>nix-env.fish</code></a> plugin.</p>
<p>As you might expect by now, we can tell Home Manager to install this plugin for
us, along with giving Home Manager the rest of our fish configuration.</p>
<pre class=language-nix><code class=language-nix>fish <span class="token operator">=</span> <span class="token punctuation">{</span><br>  enable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>  plugins <span class="token operator">=</span> <span class="token punctuation">[</span><br>    <span class="token comment"># Need this when using Fish as a default macOS shell in order to pick</span><br>    <span class="token comment"># up ~/.nix-profile/bin</span><br>    <span class="token punctuation">{</span><br>      name <span class="token operator">=</span> <span class="token string">"nix-env"</span><span class="token punctuation">;</span><br>      src <span class="token operator">=</span> pkgs<span class="token punctuation">.</span>fetchFromGitHub <span class="token punctuation">{</span><br>        owner <span class="token operator">=</span> <span class="token string">"lilyball"</span><span class="token punctuation">;</span><br>        repo <span class="token operator">=</span> <span class="token string">"nix-env.fish"</span><span class="token punctuation">;</span><br>        rev <span class="token operator">=</span> <span class="token string">"00c6cc762427efe08ac0bd0d1b1d12048d3ca727"</span><span class="token punctuation">;</span><br>        sha256 <span class="token operator">=</span> <span class="token string">"1hrl22dd0aaszdanhvddvqz3aq40jp9zi2zn0v1hjnf7fx4bgpma"</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><span class="token punctuation">;</span><br>  shellInit <span class="token operator">=</span> <span class="token string">''<br>    # Set syntax highlighting colours; var names defined here:<br>    # http://fishshell.com/docs/current/index.html#variables-color<br>    set fish_color_autosuggestion brblack<br>  ''</span><span class="token punctuation">;</span><br>  shellAliases <span class="token operator">=</span> <span class="token punctuation">{</span><br>    rm <span class="token operator">=</span> <span class="token string">"rm -i"</span><span class="token punctuation">;</span><br>    cp <span class="token operator">=</span> <span class="token string">"cp -i"</span><span class="token punctuation">;</span><br>    mv <span class="token operator">=</span> <span class="token string">"mv -i"</span><span class="token punctuation">;</span><br>    mkdir <span class="token operator">=</span> <span class="token string">"mkdir -p"</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  shellAbbrs <span class="token operator">=</span> <span class="token punctuation">{</span><br>    g <span class="token operator">=</span> <span class="token string">"git"</span><span class="token punctuation">;</span><br>    m <span class="token operator">=</span> <span class="token string">"make"</span><span class="token punctuation">;</span><br>    n <span class="token operator">=</span> <span class="token string">"nvim"</span><span class="token punctuation">;</span><br>    o <span class="token operator">=</span> <span class="token string">"open"</span><span class="token punctuation">;</span><br>    p <span class="token operator">=</span> <span class="token string">"python3"</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  functions <span class="token operator">=</span> <span class="token punctuation">{</span><br>    fish_greeting <span class="token operator">=</span> <span class="token punctuation">{</span><br>      description <span class="token operator">=</span> <span class="token string">"Greeting to show when starting a fish shell"</span><span class="token punctuation">;</span><br>      body <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    mkdcd <span class="token operator">=</span> <span class="token punctuation">{</span><br>      description <span class="token operator">=</span> <span class="token string">"Make a directory tree and enter it"</span><span class="token punctuation">;</span><br>      body <span class="token operator">=</span> <span class="token string">"mkdir -p $argv[1]; and cd $argv[1]"</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>After running <code>home-manager switch</code> I just needed two steps to switch my
default shell on macOS:</p>
<ol>
<li>Add the full path <code>/Users/apearce/.nix-profile/bin/fish</code> to the end of the
<code>/etc/shells</code> file.</li>
<li>Change shell with <code>chsh -s ~/.nix-profile/bin/fish</code>.</li>
</ol>
<p>I could then open a new terminal window and be dropped into a fish shell which
had access to all my Home-Manager-installed programs. 🎉</p>
<p>My final tweak was to include <a href=https://iterm2.com/documentation-shell-integration.html>iTerm2’s shell
integration</a> as a fish plugin. Fish plugins
are installed to <code>~/.config/fish/conf.d/&lt;plugin folder&gt;</code> and these are <a href=https://fishshell.com/docs/current/#configuration-files>sourced
<em>before</em></a> the main <code>config.fish</code> file, so I needed a few tweaks:</p>
<ol>
<li>Download the integration script using the
<a href=https://iterm2.com/documentation-shell-integration.html>instructions</a>.</li>
<li>Wrap the contents of the integration script in a <code>function iterm2_shell_integration...end</code>
block.</li>
<li>Place the script in a folder structure next to the <code>home.nix</code> file as
<code>config/fish/iterm2_shell_integration/functions/iterm2_shell_integration.fish</code>.
This mimics the folder structure of fish plugins.</li>
<li>Call the integration function in <code>config.fish</code>.</li>
</ol>
<p>The Nix configuration looks like this:</p>
<pre class=language-nix><code class=language-nix>fish <span class="token operator">=</span> <span class="token punctuation">{</span><br>  enable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>  plugins <span class="token operator">=</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      name <span class="token operator">=</span> <span class="token string">"iterm2-shell-integration"</span><span class="token punctuation">;</span><br>      src <span class="token operator">=</span> <span class="token url">./config/fish/iterm2_shell_integration</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token comment"># ...</span><br>  <span class="token punctuation">]</span><span class="token punctuation">;</span><br>  interactiveShellInit <span class="token operator">=</span> <span class="token string">''<br>    # Activate the iTerm 2 shell integration<br>    iterm2_shell_integration<br>  ''</span><span class="token punctuation">;</span><br>  <span class="token comment"># ...</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>I hope to get around to packaging the integration script as a bona fide fish plugin.</p>
<h4 id=neovim>Neovim <a class="header-anchor sf-hidden" href=#neovim>🔗</a></h4>
<p>I recently migrated my <a href=https://neovim.io/>Neovim</a> configuration to Lua, which means
having an <code>init.lua</code> file rather than an <code>init.vim</code> file.</p>
<p>Home Manager <a href=https://github.com/nix-community/home-manager/issues/1907>always creates an <code>init.vim</code></a> but Neovim
will complain if an <code>init.lua</code> file is also found. So for now I manage my
Neovim dotfiles explicitly in my <code>home.nix</code>, which means I also need to install
<code>neovim</code> explicitly.</p>
<pre class=language-nix><code class=language-nix><span class="token punctuation">{</span> config<span class="token punctuation">,</span> pkgs<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">:</span><br><br><span class="token punctuation">{</span><br>  home <span class="token operator">=</span> <span class="token punctuation">{</span><br>    <span class="token comment"># ...</span><br>    packages <span class="token operator">=</span> <span class="token keyword">with</span> pkgs<span class="token punctuation">;</span> <span class="token punctuation">[</span><br>      neovim<br>    <span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token comment"># ...</span><br><br>  xdg<span class="token punctuation">.</span>configFile<span class="token punctuation">.</span>nvim <span class="token operator">=</span> <span class="token punctuation">{</span><br>    source <span class="token operator">=</span> <span class="token url">./config/neovim</span><span class="token punctuation">;</span><br>    recursive <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>My <code>init.lua</code> and other Neovim files live in a folder next to my <code>home.nix</code>
called <code>config/neovim</code>. Home Manager effectively copies those files to the
location Neovim expects to see them:</p>
<pre class=language-shell><code class=language-shell>$ <span class="token function">ls</span> -l ~/.config/nvim<br>lrwxr-xr-x <span class="token number">84</span> apearce <span class="token number">27</span> Jul <span class="token number">14</span>:34 init.lua -<span class="token operator">&gt;</span> /nix/store/vxw9a54wykhyyi67hqkf6xmixxmpfxb1-home-manager-files/.config/nvim/init.lua<br>drwxr-xr-x  - apearce <span class="token number">27</span> Jul <span class="token number">14</span>:34 lua<br>drwxr-xr-x  - apearce <span class="token number">25</span> Jul <span class="token number">20</span>:17 plugin</code></pre>
<p>Any updates to my <code>config/neovim/init.lua</code> must be followed by <code>home-manager switch</code> for Neovim to see the changes.</p>
<h3 id=putting-it-all-together%3A-migrating-from-homebrew>Putting it all together: migrating from Homebrew <a class="header-anchor sf-hidden" href=#putting-it-all-together%3A-migrating-from-homebrew>🔗</a></h3>
<p>We’ve now gone through all the building blocks you’ll need to manage all of
your programs and their configuration with Home Manager.</p>
<p>One of my goals was to move away from Homebrew and manage programs on my laptop
exclusively with Home Manager.</p>
<p>I first dumped the list of packages I had installed with Homebrew:</p>
<pre class=language-shell><code class=language-shell>$ brew bundle dump</code></pre>
<p>The resulting <code>Brewfile</code> looks like this:</p>
<pre><code>tap "homebrew/bundle"
tap "homebrew/core"
brew "cargo-instruments"
# ...
brew "stow"
</code></pre>
<p>There were lots of entries I didn’t remember installing explicitly, but it was
still a much shorter and more comprehensible list than the output of <code>brew list</code>.</p>
<p>I then went through this list and for each item:</p>
<ol>
<li><a href=https://search.nixos.org/packages>Searched</a> the corresponding Nix package.</li>
<li>Added the Nix package name to the <code>home.packages</code> list in my <code>home.nix</code>
file.</li>
<li>Ran <code>home-manager switch</code>.</li>
<li>Verified that the program was picked up by my shell (<code>which &lt;executable name&gt;</code>) and was runnable (<code>&lt;executable name&gt; --version</code> or similar).</li>
<li>Looked at the corresponding <a href=https://github.com/nix-community/home-manager/tree/master/modules/programs>Home Manager module</a>, if
it existed, to see if I could port over any dotfiles.</li>
</ol>
<h2 id=summary>Summary <a class="header-anchor sf-hidden" href=#summary>🔗</a></h2>
<p>With Home Manager I was able to:</p>
<ul>
<li>Switch to a configuration-as-code system, which will allow me to define
configuration depending on the system it is being deployed on.</li>
<li>Define almost all of my dotfile-like configuration in a <a href=https://github.com/alexpearce/dotfiles/blob/d444f75b1ae800ce4dc2f70dea4357cedd245263/home.nix>single
file</a>.</li>
<li>Remove Homebrew from my system. (This is particularly cool as I could then
also remove Xcode, which is huge and takes <em>ages</em> to update.)</li>
</ul>
<p>These are big pluses, and I’m happy with the result overall, but there are
downsides.</p>
<ul>
<li>Understanding the philosophy of Nix, the various terms and commands, as well
as the Expression Language in depth is not strictly necessary, but some time
is needed to at least get to grips with a new way of working.</li>
<li>Nix typically requires root privileges for the initial installation and you
may not have this on all the machines you work on.<sup class=footnote-ref><a href=#fn1 id=fnref1>[1]</a></sup> There are <a href=https://nixos.wiki/wiki/Nix_Installation_Guide#Installing_without_root_permissions>workarounds
for root-less Nix installs</a> but these may not work on
your system (e.g. if user namespaces are disabled, or if your home directory
is on a networked file system).</li>
<li>Your exact configuration may not be reproducible in Home Manager as <a href=https://nix-community.github.io/home-manager/index.html#sec-guidelines-valuable-options>by
design</a> it does not always support every possible
configuration flag. I have to manage Lua-based Neovim configuration in a more
‘manual’ way, for example.</li>
<li><a href=https://fishshell.com/>Fish shell</a> does not have first-class support in Nix.</li>
</ul>
<p>All that said, I had a lot of fun! 🛠 I’m looking forward to reading more of
other people’s experiences with Nix.</p>
<p>As ever, my configuration is <a href=https://github.com/alexpearce/dotfiles>available on GitHub</a>.</p>
<h3 id=learning-more>Learning more <a class="header-anchor sf-hidden" href=#learning-more>🔗</a></h3>
<p>Unlike <a href=https://alexpearce.me/2016/02/managing-dotfiles-with-stow/>using Stow</a>, using Home Manager requires getting to grips
with a new language and considerably more complex infrastructure. The following
resources helped me along the way.</p>
<ul>
<li><a href=https://nixcloud.io/tour/>A tour of Nix</a> for learning the Nix Expression Language.</li>
<li>The <a href="https://www.youtube.com/watch?v=NYyImy-lqaA&amp;list=PLRGI9KQ3_HP_OFRG6R-p4iFgMSK1t5BHs">Nixology</a> playlist.</li>
<li>The NixOS <a href=https://www.reddit.com/r/NixOS>reddit</a> and <a href=https://discourse.nixos.org/>Discourse</a> community discussions.</li>
</ul>
<hr>
<h2 id=updates>Updates <a class="header-anchor sf-hidden" href=#updates>🔗</a></h2>
<p>There was a bit of churn around Nix installation on macOS mid-2021. This post
was updated in November 2021 to move away from temporary fixes to more stable
installers. Some Home Manager workarounds are no longer needed and so were
removed.</p>
<hr class=footnotes-sep>
<section class=footnotes>
<ol class=footnotes-list>
<li id=fn1 class=footnote-item><p>I used to build programs on such machines myself and install them into
<code>~/usr</code>. By building and installing Stow I could then manage my dotfiles in a
similar way as on my personal machine. <a href=#fnref1 class=footnote-backref>↩︎</a></p>
</li>
</ol>
</section>
 </div>
 <footer>
 <a class=top href=#>back to top ↑</a>
 </footer>
 
 <div id=comments>
 
<div class=utterances style=height:438px>
 <iframe class=utterances-frame title=Comments scrolling=no loading=lazy sandbox="allow-popups allow-top-navigation allow-top-navigation-by-user-activation" srcdoc="<!DOCTYPE html> <html lang=en><meta charset=utf-8><title>utterances</title><meta name=description content=&quot;A lightweight commenting system using GitHub issues.&quot;><meta http-equiv=X-UA-Compatible content=&quot;IE=edge&quot;><meta name=viewport content=&quot;width=device-width, initial-scale=1&quot;><style>html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;font-family:sans-serif}body{margin:0}header,main{display:block}summary{display:list-item}a{background-color:initial}a:active,a:hover{outline-width:0}img{border-style:none}svg:not(:root){overflow:hidden}button,textarea{font:inherit;margin:0}button{overflow:visible}button{text-transform:none}[type=submit],html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}textarea{overflow:auto}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}*{box-sizing:border-box}button,textarea{font-family:inherit}body{color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:14px;line-height:1.5}a{color:#0366d6;text-decoration:none}a:hover{text-decoration:underline}strong{font-weight:600}button{border-radius:0;cursor:pointer}details summary{cursor:pointer}details:not([open])>:not(summary){display:none!important}h1{margin-bottom:0;margin-top:0}h1{font-weight:600}.octicon{vertical-align:text-bottom}.box-shadow-large{box-shadow:0 8px 24px #959da533!important}.btn{appearance:none;border:1px solid;border-radius:6px;cursor:pointer;display:inline-block;font-size:14px;font-weight:500;line-height:20px;padding:5px 16px;position:relative;user-select:none;vertical-align:middle;white-space:nowrap}.btn:hover{text-decoration:none}.btn.disabled,.btn:disabled,.btn[aria-disabled=true]{cursor:default}.btn.disabled .octicon,.btn:disabled .octicon,.btn[aria-disabled=true] .octicon{color:inherit}.btn .octicon{margin-right:4px;vertical-align:text-bottom}.btn .octicon:only-child{margin-right:0}.btn{background-color:#fafbfc;border-color:#1b1f2326;color:#24292e;transition:background-color .2s cubic-bezier(.3,0,.5,1)}.btn.hover,.btn:hover,[open]>.btn{background-color:#f3f4f6;transition-duration:.1s}.btn.selected,.btn:active,.btn[aria-selected=true]{background-color:#edeff2;box-shadow:inset 0 1px 0 #e1e4e833;transition:none}.btn.disabled,.btn:disabled,.btn[aria-disabled=true]{background-color:#fafbfc;border-color:#1b1f2326;color:#959da5}.btn.focus,.btn:focus{box-shadow:0 0 0 3px #0366d64d;outline:1px dotted #0000;outline-offset:2px}.btn-primary{background-color:#2ea44f;border-color:#1b1f2326;box-shadow:0 1px 0 #1b1f231a,inset 0 1px 0 #ffffff08;color:#fff}.btn-primary.hover,.btn-primary:hover,[open]>.btn-primary{background-color:#2c974b}.btn-primary.selected,.btn-primary:active,.btn-primary[aria-selected=true]{background-color:#2a8f47;box-shadow:inset 0 1px 0 #14462033}.btn-primary.disabled,.btn-primary:disabled,.btn-primary[aria-disabled=true]{background-color:#94d3a2;border-color:#1b1f231a;box-shadow:0 1px 0 #1b1f231a,inset 0 1px 0 #ffffff08;color:#fffc}.btn-primary.focus,.btn-primary:focus{box-shadow:0 0 0 3px #2ea44f66}.btn-primary .octicon{color:#fffc}.BtnGroup{vertical-align:middle}.BtnGroup:after,.BtnGroup:before{content:&quot;&quot;;display:table}.BtnGroup:after{clear:both}.BtnGroup-item{border-right-width:0;float:left;position:relative}.BtnGroup-item:first-child{border-bottom-left-radius:6px;border-top-left-radius:6px}.BtnGroup-item:last-child{border-bottom-right-radius:6px;border-right-width:1px;border-top-right-radius:6px}.BtnGroup-item.selected,.BtnGroup-item:active,.BtnGroup-item:focus,.BtnGroup-item:hover,.BtnGroup-item[aria-selected=true]{border-right-width:1px}.BtnGroup-item.selected+.BtnGroup-item,.BtnGroup-item.selected+.BtnGroup-parent .BtnGroup-item,.BtnGroup-item:active+.BtnGroup-item,.BtnGroup-item:active+.BtnGroup-parent .BtnGroup-item,.BtnGroup-item:focus+.BtnGroup-item,.BtnGroup-item:focus+.BtnGroup-parent .BtnGroup-item,.BtnGroup-item:hover+.BtnGroup-item,.BtnGroup-item:hover+.BtnGroup-parent .BtnGroup-item,.BtnGroup-item[aria-selected=true]+.BtnGroup-item,.BtnGroup-item[aria-selected=true]+.BtnGroup-parent .BtnGroup-item{border-left-width:0}.BtnGroup-item:active,.BtnGroup-item:focus,.BtnGroup-parent:active,.BtnGroup-parent:focus{z-index:1}.markdown-body{word-wrap:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;line-height:1.5}.markdown-body:after,.markdown-body:before{content:&quot;&quot;;display:table}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body p{margin-bottom:16px;margin-top:0}.tabnav{margin-top:0}.tabnav-tabs{display:flex;margin-bottom:-1px;overflow:auto}.tabnav-tab{background-color:initial;border:1px solid #0000;border-bottom:0;color:#24292e;display:inline-block;flex-shrink:0;font-size:14px;line-height:23px;padding:8px 16px;text-decoration:none}.tabnav-tab[aria-selected=true]{background-color:#fff;border-color:#e1e4e8;border-radius:6px 6px 0 0}.tabnav-tab:focus,.tabnav-tab:hover{color:#586069;text-decoration:none}.tabnav-tab:active{color:#6a737d}.form-control{background-position:right 8px center;background-repeat:no-repeat;box-shadow:inset 0 1px 0 #e1e4e833;outline:none;vertical-align:middle}.form-control.focus,.form-control:focus,.form-select.focus,.form-select:focus{border-color:#0366d6;box-shadow:0 0 0 3px #0366d64d;outline:none}.form-control[disabled]{background-color:#f3f4f6;color:#959da5}@supports (-webkit-touch-callout:none){.form-control,.form-select{font-size:16px}@media (min-width:768px){.form-control,.form-select{font-size:14px}}}textarea.form-control{line-height:1.5;padding-bottom:8px;padding-top:8px}::placeholder{color:#6a737d;opacity:1}.Popover{position:absolute;z-index:100}.Popover-message{margin-left:auto;margin-right:auto}.Popover-message:after,.Popover-message:before{content:&quot;&quot;;display:inline-block;left:50%;position:absolute}.Popover-message:before{border:8px solid;border-color:#0000 #0000 #1b1f2326;margin-left:-9px;top:-16px}.Popover-message:after{border:7px solid;border-color:#0000 #0000 #fff;margin-left:-8px;top:-14px}.Popover-message--top-right{margin-right:0;right:-9px}.Popover-message--bottom-right:after,.Popover-message--bottom-right:before,.Popover-message--top-right:after,.Popover-message--top-right:before{left:auto;margin-left:0}.Popover-message--bottom-right:before,.Popover-message--top-right:before{right:20px}.Popover-message--bottom-right:after,.Popover-message--top-right:after{right:21px}.text-link{color:#586069}.octicon{fill:currentColor;display:inline-block}.v-align-bottom{vertical-align:bottom!important}.markdown-body-scrollable{max-height:450px;overflow-x:hidden;overflow-y:auto}.markdown-body-scrollable{-webkit-overflow-scrolling:touch}.details-popover{position:relative}.details-popover>summary{list-style-type:none}.details-popover>summary::-webkit-details-marker{display:none}.timeline{margin:16px 0;padding:0 4px}.timeline-header{color:#586069;font-size:14px;margin:0;padding-left:16px}@media screen and (min-width:544px){.timeline-header{padding-left:60px}}.timeline-header em{font-weight:400}.timeline-comment{align-items:flex-start;display:flex;margin:16px 0}.timeline-comment .avatar{background-color:initial;display:none}.timeline-comment .avatar>img{border-radius:6px}.timeline-comment .comment{background-color:#fff;border:1px solid #e1e4e8;border-radius:6px;flex-basis:0;flex-grow:1;min-width:0;position:relative}.timeline-comment .comment-header{align-items:center;background-color:#f6f8fa;border-bottom:1px solid #e1e4e8;border-top-left-radius:6px;border-top-right-radius:6px;color:#586069;display:flex;justify-content:space-between}.timeline-comment .comment-meta{padding:10px 16px}.timeline-comment .comment-actions{align-items:center;display:flex}.timeline-comment .new-comment-header{background-color:#f6f8fa;border-bottom:1px solid #e1e4e8;border-top-left-radius:6px;border-top-right-radius:6px;margin-bottom:0;padding:8px 8px 0}.timeline-comment .markdown-body{font-size:14px;padding:16px}.timeline-comment .comment-body{padding:8px}.timeline-comment .comment-body textarea{appearance:none;display:block;max-height:550px;resize:vertical}.timeline-comment .comment-body .markdown-body,.timeline-comment .comment-body textarea{border:1px solid #e1e4e8;border-radius:6px;min-height:90px;padding:8px;width:100%}.timeline-comment .comment-body textarea:focus{box-shadow:0 0 0 .2em #0366d64d}.timeline-comment .comment-body textarea:disabled{background-color:#f6f8fa}.timeline-comment .comment-footer{border-top:1px solid #e1e4e8;display:flex}.timeline-comment .comment-footer:not(:hover) .reactions-popover:not([open]),.timeline-comment .comment-footer[reaction-count=&quot;0&quot;]{height:0;opacity:0;overflow:hidden}.timeline-comment .comment-footer:not(:hover) .reactions-popover:not([open]) summary{opacity:0}.timeline-comment .new-comment-footer{align-items:center;display:flex;justify-content:space-between;padding:0 8px 8px}.timeline-comment .new-comment-footer .markdown-info{font-size:12px;margin-right:4px}.timeline-comment .reactions-popover{display:none}@media screen and (min-width:544px){.timeline-comment .avatar{display:block;margin-right:16px}.timeline-comment .comment:after,.timeline-comment .comment:before{border-color:#0000;border-style:solid solid outset;content:&quot; &quot;;display:block;height:0;left:-16px;pointer-events:none;position:absolute;right:100%;top:11px;width:0}.timeline-comment .comment:after{border-right-color:#f6f8fa;border-width:7px;margin-left:2px;margin-top:1px}.timeline-comment .comment:before{border-right-color:#d1d5da;border-width:8px}.timeline-comment .reactions-popover{display:inline-block}}.reaction-list{border-right:1px solid #e1e4e8;display:flex;flex-wrap:nowrap;margin-bottom:-1px;margin-left:-1px;margin-top:-1px;overflow-x:hidden;overflow-y:visible}.reaction-list>.reaction-button:last-child{border-right:none!important}.reaction-list>.reaction-button{border-radius:0!important;font-weight:400;padding:8px 16px}.reaction-list>.reaction-button:after{content:attr(reaction-count);display:inline-block;margin-left:2px}.reactions-popover summary{color:#586069;margin:-1px 0;padding:8px 16px;transition:opacity .3s ease-in-out;white-space:nowrap}.reactions-popover summary:hover{color:#0366d6}.reactions-popover .Popover{margin-top:8px}.reactions-popover .Popover-message{background-color:#fff;border:1px solid #e1e4e8;border-radius:6px;display:flex;flex-wrap:wrap;position:relative;width:150px}.reaction-button{box-shadow:none}.reaction-button:focus-visible{box-shadow:none;outline:1px dotted #000;outline-offset:-1px}body,html{background-color:initial}body{overflow:hidden;padding-bottom:20px}.form-control{font-size:14px}textarea[disabled]{cursor:not-allowed}.sf-hidden{display:none!important}</style><meta http-equiv=content-security-policy content=&quot;default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:;&quot;><body><main class=timeline>
 <h1 class=timeline-header>
 <a class=text-link target=_blank href=https://github.com/alexpearce/home/issues/40>1 Comment</a>
 <em>
 - powered by
 <a class=text-link href=https://utteranc.es/ target=_blank>utteranc.es</a>
 </em>
 </h1><article class=timeline-comment>
 <a class=avatar href=https://github.com/shawnkoh target=_blank tabindex=-1>
 <img alt=@shawnkoh src=data:image/jpeg;base64,/9j/2wCEAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDIBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAFgAWAMBIgACEQEDEQH/xAGiAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgsQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+gEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoLEQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/AOvzKSf3I/76FJ++z/qVx/v06E3ZvJUkijCBVIYH6/4VcEZ9BX0EZ3R4DjYo4uP+eUf/AH2f8KAtx/diH/Aj/hV8R0vlU+YVihsn5z5f603bcZ+9EB9Ca0fKHpR5YHanzBYzzFIf+Wp/BaDCzDG9+fTAqPVPEGj6Lj7ffQwsf4c5b8hWPH480C5nkjg1OAsuNquSgb15bAzUOtBO1yvZTaukbRtWPV5P++qZ9gB6tJ/38b/GrttNHdQJLGysGAPBqbZV8yIsZ4sYx6/ixNL9ij/u1f2e1Gz2p8wrEcMofV548rgImDnqeeK0PKPpWYn2C11i4fcgxGjAKo6ktk1PN4hhhKlVQKPU5JrgVVxR3eyUmWpQkDASsEJ55qW3udODYmbIPccYrGfV7a8YT+Q0zZAIVwBj15qaG40y7JbDBASP3fqOoqZVHJf5FxpKL/zNqWOyc5guo/oTXm3j7xpLodw+m2iqW8kPJODnbnoBj6dffiu6jfSIfveYWYfdYV5+vh6DWPi4ZLpPN0yMrKkR5BITjP4jNc1avKFN6s6KVCE6myPPV8F+L/FU32r+z5ljf5leUlFA7YB7fhVLVPh7rekW5luEiIH3tr5xX1bqDgWRG4Inr0ryHxokDQSF9SSMucqpbrXkqvPmS6HrRoQcW2cV8NvFlzouuQ6LfuRaXMgUM54jJ6EH0zj9a+hDpcgXOVr5bvYBLB9oiZS8Dhsj619VG4lFqjo4YsoOMV6lHETS5Uzy62Hp3uyubLZExYEntioPJ9jVyOWSTiXcAfQU/wAqL/brpjXa+I5ZUIv4TzCCT+1dRMX2k27mAYaMkg43HrWFqFxcQoV80lxVrSdUtLbUFCxySjYFKhwD3z396yZ5YpbuRItypg/u2IOB35riqQnLRHbTnGO5N9rlh0yF/tBRmDbixzk+1bHgm+8+wfDjak5X7x68Hv8AWsXYktpFbrFkgs44ByDj/CiF2sGhitjHAXkDtwMnn8hSpqdN3HUcZo2fEGsNp/iAvJKBGiOojUhnYk9cdvxre8BTSXupfbHZXSSMqMsNw57jrjg1wb2VlLrFzJdzld8rEjrjJ/X8K9I8LQ6XpcMeLvO35oggI9Rg/mawxTnKNjfDckZamV8SrXUjPaw2dqrz3Eu1WS5kMh/4DgKB+NcZ8SdAl0bVLRVk3mS1Rm3nOGxg/qK9s1bdLJDiSOFVYNJK3B257GvFfiRq95f+Iyl5NYNHGCkRtZt4C5798/WuOk/eO6cXynM2yO9pLGxBBQjp7V6/4T8bPNocJ1BHaX5v3iJgMuTjge1eYaLZT6lMtpap5k8vyovTJxWrH4E8ShzmO7Vf7sbkAfQYrqjVcXo18zH2ManxJ/I9fj8Sae3P2gqfRgak/wCEisP+ftf1rx0eCPFInXAvCm7nMh6Vd/4QvxD/AM87v/vs1p9ZfkT9Sh/e+9Dop4oZBIscYIP/ADzX/CpGuEDh/lyy/wBwdMn2qTT77SdNvZ3hvEaOUY/eQ7hg845HHOOlRT3NnMqomo2yquDuMByf/rVt7Zdjg9myUajtwVkKsBwQADQJoZJRLJh3ByCyg1nXMtlJM7JcQoGxg7Wx7nGKS1exiuGeS6idflwDu/vDPb0zS9suw/ZvubSG3nfLomSQWwo5yazLfWLe21NlMQCI7KRuHQHHetCfVdEjQqhhHT5lDZP4YrirgRSXc8iuR5juy5OMZOaFNPoP2bPYLXV7TXtJe7iWSWyt5TBKJUDEFQDkqM5HI5rzDxvqkN1rIWLU0ubZB8qJGFSP2BHWubsvE2r+HLiZ9NvWiWQ/OowyN9Qcj8awNU1iXUbuS5YIkkjbm8sYBP0riWHam2tjuWJtDl6m6fEt1o0q3el3BgukOY5AoP14II6Zr3z4dePYvFvhgyXbD+1ICUuY40/75YAdAR+oNfKhcscsST71c0zVL/SLsXWnXk1rOOjxOVP0OOo9q6FCysjncuZ3Z9f2elN5cUkmWDIN2XHORzVz+yrb+4f++6+etI+NGtW8EdvqCrNsAAlQYOPcdPyrW/4XW/8Acb/vmhwJTMaSOGNNxIx0xmq/nwKCdw57Dmuwl8J6fL98OcnP36kj8KadEPkVl4x1rLmNLM4proOAsUTM3QZGKjl8/gymOJAeR3ruo/DFoh+V5PxIrkfGlpDpt3bQRMx3oXbP1x/SnF3dhMxpr478W4x/tGqMzu+SzkmkEqMzKgzt4J7CopX5rcgry+aQQGUj0YVTa3kJ/wBXEffmrrHNNoEU/srsMMIwP9kVDLbtHyORWjTJDigDMDGl3D0qeREc5BANR+T/ALQoA+ix8S/C5ySLckDPMGKcnxG8KzHLtZjP/TMivAD978KjTrWPsIl+0Z9FN498IcKptd5HJOcV5Z8RtZsNU16O507YbeO3VfkzgnLE9frXJfxj6U28/wBR/wAA/rThTUXdA5NoLCcGKRCed5P1zUrmqNh98/h/Krr1qQM3UhYU31oPSgBxIxVaaTFT9qqT0AVmOTmkyfWk7GkoA//Z width=44 height=44>
 </a>
 <div class=comment>
 <header class=comment-header>
 <span class=comment-meta>
 <a class=text-link href=https://github.com/shawnkoh target=_blank><strong>shawnkoh</strong></a>
 commented
 <a class=text-link href=https://github.com/alexpearce/home/issues/40#issuecomment-975403240 target=_blank>on Nov 22, 2021</a>
 </span>
 <div class=comment-actions>
 
 
 <details class=&quot;details-overlay details-popover reactions-popover&quot;>
 <summary aria-label=&quot;Reactions Menu&quot;><svg class=octicon style=margin-right:3px viewBox=&quot;0 0 7 16&quot; version=1.1 width=7 height=16 aria-hidden=true><path fill-rule=evenodd d=&quot;M4 4H3v3H0v1h3v3h1V8h3V7H4V4z&quot;></path></svg><svg class=octicon viewBox=&quot;0 0 16 16&quot; version=1.1 width=16 height=16 aria-hidden=true><path fill-rule=evenodd d=&quot;M8 0C3.58 0 0 3.58 0 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm4.81 12.81a6.72 6.72 0 0 1-2.17 1.45c-.83.36-1.72.53-2.64.53-.92 0-1.81-.17-2.64-.53-.81-.34-1.55-.83-2.17-1.45a6.773 6.773 0 0 1-1.45-2.17A6.59 6.59 0 0 1 1.21 8c0-.92.17-1.81.53-2.64.34-.81.83-1.55 1.45-2.17.62-.62 1.36-1.11 2.17-1.45A6.59 6.59 0 0 1 8 1.21c.92 0 1.81.17 2.64.53.81.34 1.55.83 2.17 1.45.62.62 1.11 1.36 1.45 2.17.36.83.53 1.72.53 2.64 0 .92-.17 1.81-.53 2.64-.34.81-.83 1.55-1.45 2.17zM4 6.8v-.59c0-.66.53-1.19 1.2-1.19h.59c.66 0 1.19.53 1.19 1.19v.59c0 .67-.53 1.2-1.19 1.2H5.2C4.53 8 4 7.47 4 6.8zm5 0v-.59c0-.66.53-1.19 1.2-1.19h.59c.66 0 1.19.53 1.19 1.19v.59c0 .67-.53 1.2-1.19 1.2h-.59C9.53 8 9 7.47 9 6.8zm4 3.2c-.72 1.88-2.91 3-5 3s-4.28-1.13-5-3c-.14-.39.23-1 .66-1h8.59c.41 0 .89.61.75 1z&quot;></path></svg></summary>
 <div class=Popover style=right:6px>
 <div class=&quot;Popover-message Popover-message--top-right box-shadow-large&quot; style=padding:16px>
 <span><a href=&quot;https://api.utteranc.es/authorize?redirect_uri=https%3A%2F%2Falexpearce.me%2F2021%2F07%2Fmanaging-dotfiles-with-nix%2F&quot; target=_top>Sign in</a> to add your reaction.</span>
 </div>
 </div>
 </details>
 </div>
 </header>
 <div class=&quot;markdown-body markdown-body-scrollable&quot;>
 <p dir=auto>Thanks for writing this! Saved me a ton of headache trying to get iTerm2 and fish to play nicely :)</p>
 </div>
 <div class=comment-footer reaction-count=1 reaction-url=https://api.github.com/repos/alexpearce/home/issues/comments/975403240/reactions>
 <form class=&quot;reaction-list BtnGroup&quot; action=javascript:>
 
 <button reaction type=submit action=javascript: formaction=https://api.github.com/repos/alexpearce/home/issues/comments/975403240/reactions class=&quot;btn BtnGroup-item reaction-button sf-hidden&quot; value=+1 aria-label=&quot;Toggle Thumbs Up reaction&quot; reaction-count=0 disabled>
 👍
 </button>
 <button reaction type=submit action=javascript: formaction=https://api.github.com/repos/alexpearce/home/issues/comments/975403240/reactions class=&quot;btn BtnGroup-item reaction-button sf-hidden&quot; value=-1 aria-label=&quot;Toggle Thumbs Down reaction&quot; reaction-count=0 disabled>
 👎
 </button>
 <button reaction type=submit action=javascript: formaction=https://api.github.com/repos/alexpearce/home/issues/comments/975403240/reactions class=&quot;btn BtnGroup-item reaction-button sf-hidden&quot; value=laugh aria-label=&quot;Toggle Laugh reaction&quot; reaction-count=0 disabled>
 ️😂
 </button>
 <button reaction type=submit action=javascript: formaction=https://api.github.com/repos/alexpearce/home/issues/comments/975403240/reactions class=&quot;btn BtnGroup-item reaction-button&quot; value=hooray aria-label=&quot;Toggle Hooray reaction&quot; reaction-count=1 disabled>
 ️🎉
 </button>
 <button reaction type=submit action=javascript: formaction=https://api.github.com/repos/alexpearce/home/issues/comments/975403240/reactions class=&quot;btn BtnGroup-item reaction-button sf-hidden&quot; value=confused aria-label=&quot;Toggle Confused reaction&quot; reaction-count=0 disabled>
 😕
 </button>
 <button reaction type=submit action=javascript: formaction=https://api.github.com/repos/alexpearce/home/issues/comments/975403240/reactions class=&quot;btn BtnGroup-item reaction-button sf-hidden&quot; value=heart aria-label=&quot;Toggle Heart reaction&quot; reaction-count=0 disabled>
 ❤️
 </button>
 <button reaction type=submit action=javascript: formaction=https://api.github.com/repos/alexpearce/home/issues/comments/975403240/reactions class=&quot;btn BtnGroup-item reaction-button sf-hidden&quot; value=rocket aria-label=&quot;Toggle Rocket reaction&quot; reaction-count=0 disabled>
 🚀
 </button>
 <button reaction type=submit action=javascript: formaction=https://api.github.com/repos/alexpearce/home/issues/comments/975403240/reactions class=&quot;btn BtnGroup-item reaction-button sf-hidden&quot; value=eyes aria-label=&quot;Toggle Eyes reaction&quot; reaction-count=0 disabled>
 👀
 </button>
 </form>
 
 <details class=&quot;details-overlay details-popover reactions-popover&quot;>
 <summary aria-label=&quot;Reactions Menu&quot;><svg class=octicon style=margin-right:3px viewBox=&quot;0 0 7 16&quot; version=1.1 width=7 height=16 aria-hidden=true><path fill-rule=evenodd d=&quot;M4 4H3v3H0v1h3v3h1V8h3V7H4V4z&quot;></path></svg><svg class=octicon viewBox=&quot;0 0 16 16&quot; version=1.1 width=16 height=16 aria-hidden=true><path fill-rule=evenodd d=&quot;M8 0C3.58 0 0 3.58 0 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm4.81 12.81a6.72 6.72 0 0 1-2.17 1.45c-.83.36-1.72.53-2.64.53-.92 0-1.81-.17-2.64-.53-.81-.34-1.55-.83-2.17-1.45a6.773 6.773 0 0 1-1.45-2.17A6.59 6.59 0 0 1 1.21 8c0-.92.17-1.81.53-2.64.34-.81.83-1.55 1.45-2.17.62-.62 1.36-1.11 2.17-1.45A6.59 6.59 0 0 1 8 1.21c.92 0 1.81.17 2.64.53.81.34 1.55.83 2.17 1.45.62.62 1.11 1.36 1.45 2.17.36.83.53 1.72.53 2.64 0 .92-.17 1.81-.53 2.64-.34.81-.83 1.55-1.45 2.17zM4 6.8v-.59c0-.66.53-1.19 1.2-1.19h.59c.66 0 1.19.53 1.19 1.19v.59c0 .67-.53 1.2-1.19 1.2H5.2C4.53 8 4 7.47 4 6.8zm5 0v-.59c0-.66.53-1.19 1.2-1.19h.59c.66 0 1.19.53 1.19 1.19v.59c0 .67-.53 1.2-1.19 1.2h-.59C9.53 8 9 7.47 9 6.8zm4 3.2c-.72 1.88-2.91 3-5 3s-4.28-1.13-5-3c-.14-.39.23-1 .66-1h8.59c.41 0 .89.61.75 1z&quot;></path></svg></summary>
 <div class=Popover style=left:50%;transform:translateX(-50%)>
 <div class=&quot;Popover-message box-shadow-large&quot; style=padding:16px>
 <span><a href=&quot;https://api.utteranc.es/authorize?redirect_uri=https%3A%2F%2Falexpearce.me%2F2021%2F07%2Fmanaging-dotfiles-with-nix%2F&quot; target=_top>Sign in</a> to add your reaction.</span>
 </div>
 </div>
 </details>
 </div>
 </div></article><article class=timeline-comment>
 <a class=avatar target=_blank tabindex=-1>
 <img alt=@anonymous src=&quot;data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNCAxNiIgdmVyc2lvbj0iMS4xIj48cGF0aCBmaWxsPSJyZ2IoMTc5LDE3OSwxNzkpIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik04IDEwLjVMOSAxNEg1bDEtMy41TDUuMjUgOWgzLjVMOCAxMC41ek0xMCA2SDRMMiA3aDEwbC0yLTF6TTkgMkw3IDMgNSAyIDQgNWg2TDkgMnptNC4wMyA3Ljc1TDEwIDlsMSAyLTIgM2gzLjIyYy40NSAwIC44Ni0uMzEuOTctLjc1bC41Ni0yLjI4Yy4xNC0uNTMtLjE5LTEuMDgtLjcyLTEuMjJ6TTQgOWwtMy4wMy43NWMtLjUzLjE0LS44Ni42OS0uNzIgMS4yMmwuNTYgMi4yOGMuMTEuNDQuNTIuNzUuOTcuNzVINWwtMi0zIDEtMnoiPjwvcGF0aD48L3N2Zz4=&quot; width=44 height=44>
 </a>
 <form class=comment accept-charset=UTF-8 action=javascript:>
 <header class=&quot;new-comment-header tabnav&quot;>
 <div class=tabnav-tabs role=tablist>
 <button type=button class=&quot;tabnav-tab tab-write&quot; role=tab aria-selected=true>
 Write
 </button>
 <button type=button class=&quot;tabnav-tab tab-preview&quot; role=tab>
 Preview
 </button>
 </div>
 </header>
 <div class=comment-body>
 <textarea class=form-control placeholder=&quot;Sign in to comment&quot; aria-label=comment disabled></textarea>
 <div class=markdown-body style=display:none>
 Nothing to preview
 </div>
 </div>
 <footer class=new-comment-footer>
 <a class=&quot;text-link markdown-info&quot; tabindex=-1 target=_blank href=https://guides.github.com/features/mastering-markdown/>
 <svg class=&quot;octicon v-align-bottom&quot; viewBox=&quot;0 0 16 16&quot; version=1.1 width=16 height=16 aria-hidden=true>
 <path fill-rule=evenodd d=&quot;M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15
                13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4
                8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z&quot;>
 </path>
 </svg>
 Styling with Markdown is supported
 </a>
 <button class=&quot;btn btn-primary sf-hidden&quot; type=submit disabled hidden>Comment</button>
 <a class=&quot;btn btn-primary&quot; href=&quot;https://api.utteranc.es/authorize?redirect_uri=https%3A%2F%2Falexpearce.me%2F2021%2F07%2Fmanaging-dotfiles-with-nix%2F&quot; target=_top>
 <svg class=octicon aria-hidden=true xmlns=http://www.w3.org/2000/svg viewBox=&quot;0 0 16 16&quot; width=16 height=16><path fill-rule=evenodd d=&quot;M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z&quot;></path></svg>
 Sign in with GitHub
 </a>
 </footer>
 </form></article></main>"></iframe>
 </div>
<noscript class=sf-hidden>Comments disabled as JavaScript is not available.</noscript>
 </div>
 
</article>
 </main>
 
 
<script>document.currentScript.remove();!function(){"use strict";(t=>{const n="singlefile-infobar",e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABAAgMAAADXB5lNAAABhmlDQ1BJQ0MgcHJvZmlsZQAAKJF9kj1Iw0AYht+mSkUrDnYQcchQnSyIijqWKhbBQmkrtOpgcukfNGlIUlwcBdeCgz+LVQcXZ10dXAVB8AfEydFJ0UVK/C4ptIjx4LiH9+59+e67A4RGhalm1wSgapaRisfEbG5VDLyiDwEAvZiVmKkn0osZeI6ve/j4ehfhWd7n/hz9St5kgE8kjjLdsIg3iGc2LZ3zPnGIlSSF+Jx43KACiR+5Lrv8xrnosMAzQ0YmNU8cIhaLHSx3MCsZKvE0cVhRNcoXsi4rnLc4q5Uaa9XJbxjMaytprtMcQRxLSCAJETJqKKMCCxFaNVJMpGg/5uEfdvxJcsnkKoORYwFVqJAcP/gb/O6tWZiadJOCMaD7xbY/RoHALtCs2/b3sW03TwD/M3Cltf3VBjD3SXq9rYWPgIFt4OK6rcl7wOUOMPSkS4bkSH6aQqEAvJ/RM+WAwVv6EGtu31r7OH0AMtSr5Rvg4BAYK1L2use9ezr79u+ZVv9+AFlNcp0UUpiqAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5AsHAB8H+DhhoQAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAJUExURQAAAICHi4qKioTuJAkAAAABdFJOUwBA5thmAAAAAWJLR0QCZgt8ZAAAAJJJREFUOI3t070NRCEMA2CnYAOyDyPwpHj/Va7hJ3FzV7zy3ET5JIwoAF6Jk4wzAJAkzxAYG9YRTgB+24wBgKmfrGAKTcEfAY4KRlRoIeBTgKOCERVaCPgU4Khge2GqKOBTgKOCERVaAEC/4PNcnyoSWHpjqkhwKxbcig0Q6AorXYF/+A6eIYD1lVbwG/jdA6/kA2THRAURVubcAAAAAElFTkSuQmCC",o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABAAgMAAADXB5lNAAABhmlDQ1BJQ0MgcHJvZmlsZQAAKJF9kj1Iw0AYht+mSkUrDnYQcchQnSyIijqWKhbBQmkrtOpgcukfNGlIUlwcBdeCgz+LVQcXZ10dXAVB8AfEydFJ0UVK/C4ptIjx4LiH9+59+e67A4RGhalm1wSgapaRisfEbG5VDLyiDwEAvZiVmKkn0osZeI6ve/j4ehfhWd7n/hz9St5kgE8kjjLdsIg3iGc2LZ3zPnGIlSSF+Jx43KACiR+5Lrv8xrnosMAzQ0YmNU8cIhaLHSx3MCsZKvE0cVhRNcoXsi4rnLc4q5Uaa9XJbxjMaytprtMcQRxLSCAJETJqKKMCCxFaNVJMpGg/5uEfdvxJcsnkKoORYwFVqJAcP/gb/O6tWZiadJOCMaD7xbY/RoHALtCs2/b3sW03TwD/M3Cltf3VBjD3SXq9rYWPgIFt4OK6rcl7wOUOMPSkS4bkSH6aQqEAvJ/RM+WAwVv6EGtu31r7OH0AMtSr5Rvg4BAYK1L2use9ezr79u+ZVv9+AFlNcp0UUpiqAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5AsHAB8VC4EQ6QAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAJUExURQAAAICHi4qKioTuJAkAAAABdFJOUwBA5thmAAAAAWJLR0QCZgt8ZAAAAJtJREFUOI3NkrsBgCAMRLFwBPdxBArcfxXFkO8rbKWAAJfHJ9faf9vuYX/749T5NmShm3bEwbe2SxeuM4+2oxDL1cDoKtVUjRy+tH78Cv2CS+wIiQNC1AEhk4AQeUTMWUJMfUJMSEJMSEY8kIx4IONroaYAimNxsXp1PA7PxwfVL8QnowwoVC0lig07wDDVUjAdbAnjwtow/z/bDW7eI4M2KruJAAAAAElFTkSuQmCC",i="SingleFile",A="single-file-ui-element",r="\n\t.infobar {\n\t\tbackground-color: #737373;\n\t\tcolor: white;\n\t\tdisplay: flex;\n\t\tposition: fixed;\n\t\ttop: 16px;\n\t\tright: 16px;\n\t\theight: auto;\n\t\twidth: auto;\n\t\tmin-height: 24px;\n\t\tmin-width: 24px;\n\t\tbackground-position: center;\n\t\tbackground-repeat: no-repeat;\n\t\tz-index: 2147483647;\n\t\tmargin: 0 0 0 16px;\n\t\tbackground-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABABAMAAABYR2ztAAABhmlDQ1BJQ0MgcHJvZmlsZQAAKJF9kj1Iw0AYht+mSkUrDnYQcchQnSyIijqWKhbBQmkrtOpgcukfNGlIUlwcBdeCgz+LVQcXZ10dXAVB8AfEydFJ0UVK/C4ptIjx4LiH9+59+e67A4RGhalm1wSgapaRisfEbG5VDLyiDwEAvZiVmKkn0osZeI6ve/j4ehfhWd7n/hz9St5kgE8kjjLdsIg3iGc2LZ3zPnGIlSSF+Jx43KACiR+5Lrv8xrnosMAzQ0YmNU8cIhaLHSx3MCsZKvE0cVhRNcoXsi4rnLc4q5Uaa9XJbxjMaytprtMcQRxLSCAJETJqKKMCCxFaNVJMpGg/5uEfdvxJcsnkKoORYwFVqJAcP/gb/O6tWZiadJOCMaD7xbY/RoHALtCs2/b3sW03TwD/M3Cltf3VBjD3SXq9rYWPgIFt4OK6rcl7wOUOMPSkS4bkSH6aQqEAvJ/RM+WAwVv6EGtu31r7OH0AMtSr5Rvg4BAYK1L2use9ezr79u+ZVv9+AFlNcp0UUpiqAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5AsHADIRLMaOHwAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAPUExURQAAAIqKioyNjY2OjvDw8L2y1DEAAAABdFJOUwBA5thmAAAAAWJLR0QB/wIt3gAAAGNJREFUSMdjYCAJsLi4OBCQx6/CBQwIGIDPCBcXAkYQUsACU+AwlBVQHg6Eg5pgZBGOboIJZugDFwRwoJECJCUOhJI1wZwzqmBUwagCuipgIqTABG9h7YIKaKGAURAFEF/6AQAO4HqSoDP8bgAAAABJRU5ErkJggg==);\n\t\tborder-radius: 16px;\n\t\tuser-select: none;\n\t\t-moz-user-select: none;\n\t\topacity: .7;\n\t\tcursor: pointer;\n\t\tpadding-left: 0;\n\t\tpadding-right: 0;\n\t\tpadding-top: 0;\n\t\tpadding-bottom: 0;\n\t\tborder: 2px solid #eee;\n\t\tbackground-size: 70% 70%;\n\t\ttransition: all 250ms;\n\t\tfont-size: 13px;\n\t}\n\t.infobar:hover {\n\t\topacity: 1;\n\t}\n\t.infobar-open {\n\t\topacity: 1;\n\t\tbackground-color: #f9f9f9;\n\t\tcursor: auto;\n\t\tcolor: #2d2d2d;\n\t\tpadding-top: 2px;\n\t\tpadding-bottom: 2px;\n\t\tborder: 2px solid #878787;\n\t\tbackground-image: none;\n\t\tborder-radius: 8px;\n\t\tuser-select: initial;\n\t\t-moz-user-select: initial;\n\t}\n\t.infobar-close-button {\n\t\tdisplay: none;\n\t\topacity: .7;\n\t\tpadding-top: 4px;\n\t\tpadding-left: 8px;\n\t\tpadding-right: 8px;\n\t\tcursor: pointer;\n\t\ttransition: opacity 250ms;\n\t\theight: 16px;\n\t}\n\t.infobar-close-button:hover {\n\t\topacity: 1;\n\t}\n\t.infobar-content {\n\t\tdisplay: none;\n\t\tfont-family: Arial;\n\t\tfont-size: 14px;\n\t\tline-height: 22px;\n\t\tword-break: break-word;\n\t\twhite-space: pre-wrap;\n\t\tposition: relative;\n\t\ttop: 1px;\n\t\ttext-align: left;\n\t}\n\t.infobar-link {\n\t\tdisplay: none;\n\t\tpadding-left: 8px;\n\t\tpadding-right: 8px;\n\t\tline-height: 11px;\n\t\tcursor: pointer;\n\t\tuser-select: none;\n\t\toutline: 0;\n\t}\n\t.infobar-link-icon {\n\t\tpadding-top: 4px;\n\t\tpadding-left: 2px;\n\t\tcursor: pointer;\n\t\topacity: .7;\n\t\ttransition: opacity 250ms;\n\t\theight: 16px;\n\t}\n\t.infobar-link-icon:hover {\n\t\topacity: 1;\n\t}\n\t.infobar-open .infobar-close-button, .infobar-open .infobar-content, .infobar-open .infobar-link {\n\t\tdisplay: inline-block;\n\t}";let a=!0;const c=t.browser;async function s(){const t=document.evaluate("//comment()",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);let s=t&&t.singleNodeValue;if(s&&((p=s).nodeType==Node.COMMENT_NODE&&p.textContent.includes(i))){const t=s.textContent.split("\n"),[,,i,p,...g]=t;if(i&&p){let t;t=c&&c.runtime&&c.runtime.sendMessage?await c.runtime.sendMessage({method:"tabs.getOptions",url:i}):{displayInfobar:!0},t.displayInfobar&&await async function(t,i,c){let s=document.querySelector(n);if(!s){if(t=t.split("url: ")[1],i=i.split("saved date: ")[1],c&&c.length>1){let t=c[0].split("info: ")[1].trim();for(let n=1;n<c.length-1;n++)t+="\n"+c[n].trim();c=t.trim()}else c=i;s=d(n,document.body),s.className=A;const p=await async function(t){if(t.attachShadow)return t.attachShadow({mode:"open"});{a=!1;const n=d("iframe",t);return n.style.setProperty("background-color","transparent","important"),n.style.setProperty("position","fixed","important"),n.style.setProperty("top",0,"important"),n.style.setProperty("right",0,"important"),n.style.setProperty("width","44px","important"),n.style.setProperty("height","48px","important"),n.style.setProperty("z-index",2147483647,"important"),new Promise((t=>{n.contentDocument.body.style.setProperty("margin",0),n.onload=()=>t(n.contentDocument.body)}))}}(s),g=document.createElement("style");g.textContent=r,p.appendChild(g);const u=document.createElement("div");u.classList.add("infobar"),p.appendChild(u);const h=document.createElement("img");h.classList.add("infobar-close-button"),u.appendChild(h),h.src=o,h.onclick=t=>{0===t.button&&s.remove()};const m=document.createElement("span");u.appendChild(m),m.classList.add("infobar-content"),m.textContent=c;const b=document.createElement("a");b.classList.add("infobar-link"),u.appendChild(b),b.target="_blank",b.rel="noopener noreferrer",b.title="Open source URL: "+t,b.href=t;const f=document.createElement("img");f.classList.add("infobar-link-icon"),b.appendChild(f),f.src=e,l(u),document.addEventListener("click",(t=>{if(0===t.button){let n=t.target;for(;n&&n!=s;)n=n.parentElement;n!=s&&l(u)}}))}}(i,p,g)}}var p}function l(t){if(t.classList.remove("infobar-open"),t.onclick=e=>{if(0===e.button)return function(t){a||document.querySelector(n).childNodes[0].contentWindow.getSelection().removeAllRanges();if(t.classList.add("infobar-open"),t.onclick=null,t.onmouseout=null,!a){const e=document.querySelector(n).childNodes[0];e.style.setProperty("width","100vw","important"),e.style.setProperty("height","100vh","important"),e.style.setProperty("width",t.getBoundingClientRect().width+33+"px","important"),e.style.setProperty("height",t.getBoundingClientRect().height+21+"px","important")}}(t),!1},!a){const t=document.querySelector(n).childNodes[0];t.style.setProperty("width","44px","important"),t.style.setProperty("height","48px","important")}}function d(t,n){const e=document.createElement(t);return n.appendChild(e),Array.from(getComputedStyle(e)).forEach((t=>e.style.setProperty(t,"initial","important"))),e}t.window==t.top&&("loading"==document.readyState?document.addEventListener("DOMContentLoaded",s,!1):s())})("object"==typeof globalThis?globalThis:window)}();</script>