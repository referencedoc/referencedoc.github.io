<!DOCTYPE html> <html class="client-js vector-animations-ready" lang=en dir=ltr style><!--
 Page saved with SingleFile 
 url: https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF 
 saved date: Thu Apr 28 2022 22:43:30 GMT+0530 (India Standard Time)
--><meta charset=utf-8>
<title>PCI passthrough via OVMF - ArchWiki</title>
<style>:root{--sf-img-8: url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMyIgaGVpZ2h0PSIxMyI+Cgk8cGF0aCBmaWxsPSIjMzZiIiBkPSJNNS4wMDIgMS4wMWg3djdsLTItMi0zIDJ2LTFsMy0yLjI1IDEgMVYyLjAxaC0zLjc1bDEgMS0yLjI1IDNoLTFsMi0zeiIvPgoJPHBhdGggZmlsbD0iIzM2YiIgZD0iTTcuMDAyIDMuMDFoLTV2OGg4di01aC0xdjRoLTZ2LTZoNHoiLz4KCTxwYXRoIGZpbGw9IiMxNWE1ZWEiIGQ9Ik00LjA4MiA1LjUxYzAtLjYyMS42MjEtLjYyMS42MjEtLjYyMSAxLjg2NC42MjEgMy4xMDcgMS44NjQgMy43MjggMy43MjggMCAwIDAgLjYyMS0uNjIuNjIxLTEuMjQ1LTEuODY0LTEuODY2LTIuNDg1LTMuNzMtMy43Mjh6Ii8+Cjwvc3ZnPgo=");--sf-img-13: url("data:image/png;base64,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");--sf-img-14: url("data:image/png;base64,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");--sf-img-15: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwEAYAAAAHkiXEAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAAAwAAAAMADO7oxXAAAInklEQVR42u1bW2wUVRj+Z2Z3Zy/d7W4pFVIXW1I1tOCFbSGYoEGeSAit3HwixUuMxMT4wqNP+kYsPjak6gPQh0IBExVjIELp0qZ2FXrRFGshqQoK3Uu33e5lZtaH39+zO2XZ2+zOGvolmz9z5sx//vP95/znugArWMHjDC7Ti2PHjh376KPGRp43mSyWL7+UpHg8Hm9pSSaTyWSS5/U2vNLBcRzHcYpiMJhMJtPkpKLE40tL7e1Hjx49+uGHt29TPkMmBYIgilZrX197e3v7vn0bNzY2ut3r1nH/Qu/qVT4SCVmWZZ4fGfnpJ59v48aRkaGhwcG+Pnzb1kb5DJkVxGKx2ObNDQ1I/L17oVAoBCDLiqIoelev8uF02mw2G0Bz84YNLS0c5/VeuXL58ubN6nwZHaAONfgMsH37oUMnTpTO8DfeeO01jwfgzTf37vV4tNf/+efnzvl8AF98cf68z1e6eoyN9fd/8AEAz2PEyBS6KyaWl5p4Aumn8vSG7g4oF/FqVIojdHMAEVBu4ivNDkOuGbWa+VBMNJtNJoNBO73Fguwh+xQFx7xika1+ZesBgsDzHAfgdDocZjPAt996vb/+CnDx4rVrt26Vy4rloPLJHrKP7C018ugBhc3/BcFg4HkAp7OqymzGClosAC4XyuHhsbHZWQCXq7raagXYtu35593u0ld8aOjmzdlZVn5NDZZP9SQZDC4sRKMAsixJ+Uy/iatk8tG85eyAfGEwGAyCgMSLIiPe6bTb0RHp6VNTMzN//83eb9iwfv3q1drb9csvMzP377PyqCEwkjD00DPJYHBhIRYDkCRJkmUNecqWId9WbzQajUg8EW23E/GiyCpcXY3pLhfmq65G+ddfc3MLCwA1NRgK1qyprbXbi6/ovXsPHoTDTD85Xt3ieR5DD7Vb9h7Tg8FwOBoFSCQSiVwckY0/zXrAO+/s39/WBlBT43RarQDnzl26NDnJHJFKPDkmPR17hMuFxMdiWMFoNB6XJDZI5gv6nvSRY3FxxAgnqpYTzyQAwFtv7d3b2grg9weDkQjAiRNnz/7wQ+G8FT0LevfdAwfa2gA6O9vbUxfaDofNJooAV6+Ojt6+nd4TzGZGBDnE5aL3zFGiCGCxFEY8gb6nnsbzWBcmqeWzeqb+CB0dr77a3AywY0dbW2MjSyf3dXefOZPqCDYGaOQA1gaI+IMHt2xZTjxhx44tW9avB3A4sGVPTExPY8ylHpA+JqjT7XZ0oFagkMfzPI/kU20o5GA6vaGQs327x/PUUwAeT3Nzff1yvZ2dHR24fsDvurv7+kZGMvNWsANIyZEjr7++dStAZ+eePS++mP271lY0nIi+e/f+/XB4+RhA0z+73WrVkng1qGdmCjXUoltamprq6gCamtzuVauy6z18GBuierao2RhAig4fzo14NZ5+GitSXY3T0Xg8FpMk1uKrqqxWk6l0xKvhcKCjU0MSAMDatbW1VVUAdXUul82Wv17ipwQhSBtQxRKJREKScNZUTIwvFuR4UTQaeb789pR8IZYJJpPJZDSWr6Llt4dC26O3NHTfDX3cUfbNuMcFuY4BKz1AZ+g2BjwuyMbbSg/QGStjQIlQ8WNAIqHttu7/1Z6yjwEPHgQCi4sAS0vxuCyzrYhyr4QJCwuRSDwOEAjgNrPFYjIJAkBtbWEr4XTGNFwHEPmnTn399c2byw8sssmZmdlZvx/g55/xICQYnJ+PRFAuLSERsVj+eguVVB6VT/aQfWRvvnqJHzVvRTuA0NV18uTgIMDJk199deNG9vw3bkxN3b0LMDDw44937gD4/Vhhvz8UQonPgcD8fDQKMD+/uBiL5WtV7iD9VF4me8hesj8biA/iJ1cUPAh3dZ065fWy9EOHdu9+4QX2fmDA57tzB+C774aHp6fZbijdsMN7BwB0BEjpySRLB2AHNcUiFMIjxUCAHB4OU8unBkDp0Sh77u/Hg6VwGL9/+WWPp6HhYcQjH2q+SnYeQPjkEyyYCKQTsd7eixfHx9lRJBlC561M0tU9ipksHQBAFDEmm82iWMheTTQaiyUSAH4/Eh4KEcHLZWrPoKNHckR3d3//6CjA/DyGLjoR6+o6ffr69fx5y9sB2WIZGWI2i6LBgAcxZjO2c0VJdQAblNJlag6AurpVq2w2AIulMOIJ9L0o4lm134+xnoimnsB6wMN7AoWmjz/u6blyBR0rScXzpvnGKxkmy7K8tISzAEYrgKJgiKFnJjH92WcbGmprAerrV692OLSzi/RRrP/tNxxkMxFNPUAdorSerpZsIUaGzs1hi2MtP/3aBz1v27Zpk9sN8NxzTU1PPKFdBdUg/YEAOuKbbwYHp6aYI9SEU+iSpELvBT06Xx6zoMLWAWT43Fx6C5ubC4UiEYCtW5H4V15pbcXD7tTDwtJJKo/KJ3uYfSjzJT5fvvJeBxQKWZZlRcEQEIkA7Nr10kvPPAOwb9/OnS0t5Zv/qyWVT/aQfWRvsaiYu6EEWcZYX667l7mC7CH7ygXdNuOOH+/tvX4dY2QyCfD22x0dra3lqzihp+fChdFRgE8/7e0dGtJOr+brgFKdB1DFOY7jeB4dUY57+j09Fy74fNoTr8b/5jzg+PHTp71eRkypQPqpPL2RoQcYjfQ/V3xmfy6bnDxz5v339Ta7cFAPK3VPo5Yvy7Isy+x/w/iW+FQUlQPohc3G84IgCBMTf/zx55+//75p05NP1te73ZU0bFY2FAX/zjs+PjExNpZMCoIgCML4OL6lje5wWOUANkkbGPj++8HB995DRZ99hgumpqaVf8rnBtbiOY7jpqeHh73ekZEjR+jtf/ke/jntP1ZVpUurFaXFkp6PFFbSVatygEIKSdodisdRRiIoFxfTZThM+bOEFCLWbEZJxNPZFV3iox6h5yVDPUCTTCKeHJFIoFQ7gp4ZNI7pgqA3Jfqg8O25fwAhdAiqcg3jQgAAAABJRU5ErkJggg==");--sf-img-16: url("data:image/png;base64,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")}.mw-ui-button{display:inline-block;-moz-box-sizing:border-box;box-sizing:border-box;border:1px solid #a2a9b1;border-radius:2px;cursor:pointer;vertical-align:middle;font-family:inherit;font-size:1em;line-height:1.28571429em;text-align:center;-webkit-appearance:none}.mw-ui-button:not(.mw-ui-icon-element){min-height:32px;min-width:4em;max-width:28.75em;margin:0;padding:5px 12px}.mw-ui-button:not(:disabled){-webkit-transition:background-color 100ms,color 100ms,border-color 100ms,box-shadow 100ms;transition:background-color 100ms,color 100ms,border-color 100ms,box-shadow 100ms}.mw-ui-button:not(:disabled):visited{color:#202122}.mw-ui-button:not(:disabled):hover{background-color:#ffffff;color:#404244;border-color:#a2a9b1}.mw-ui-button:not(:disabled):focus{color:#202122;border-color:#3366cc;box-shadow:inset 0 0 0 1px #3366cc,inset 0 0 0 2px #ffffff;outline-width:0}.mw-ui-button:not(:disabled):active,.mw-ui-button:not(:disabled).is-on{background-color:#c8ccd1;color:#000000;border-color:#72777d;box-shadow:none}.mw-ui-button:disabled{background-color:#c8ccd1;color:#ffffff;border-color:#c8ccd1;cursor:default}.mw-ui-button.mw-ui-icon-element:not(.mw-ui-icon-with-label-desktop){color:transparent!important}.mw-ui-button.mw-ui-icon-element:not(.mw-ui-icon-with-label-desktop) span{display:block;position:absolute!important;clip:rect(1px,1px,1px,1px);width:1px;height:1px;margin:-1px;border:0;padding:0;overflow:hidden}@media all and (max-width:1000px){.mw-ui-button.mw-ui-icon-element span{display:block;position:absolute!important;clip:rect(1px,1px,1px,1px);width:1px;height:1px;margin:-1px;border:0;padding:0;overflow:hidden}}.mw-ui-button.mw-ui-quiet{background-color:transparent;color:#202122;border-color:transparent;font-weight:bold}.mw-ui-button.mw-ui-quiet:not(.mw-ui-icon-element),.mw-ui-button.mw-ui-quiet.mw-ui-progressive:not(.mw-ui-icon-element),.mw-ui-button.mw-ui-quiet.mw-ui-destructive:not(.mw-ui-icon-element){min-height:32px}input[type='checkbox']:hover+.mw-ui-button.mw-ui-quiet,input[type='checkbox']:hover+.mw-ui-button.mw-ui-quiet.mw-ui-progressive,input[type='checkbox']:hover+.mw-ui-button.mw-ui-quiet.mw-ui-destructive,.mw-ui-button.mw-ui-quiet:hover,.mw-ui-button.mw-ui-quiet.mw-ui-progressive:hover,.mw-ui-button.mw-ui-quiet.mw-ui-destructive:hover{background-color:rgba(0,24,73,0.02745098);color:#202122;border-color:transparent}input[type='checkbox']:focus+.mw-ui-button.mw-ui-quiet,input[type='checkbox']:focus+.mw-ui-button.mw-ui-quiet.mw-ui-progressive,input[type='checkbox']:focus+.mw-ui-button.mw-ui-quiet.mw-ui-destructive,.mw-ui-button.mw-ui-quiet:focus,.mw-ui-button.mw-ui-quiet.mw-ui-progressive:focus,.mw-ui-button.mw-ui-quiet.mw-ui-destructive:focus{color:#202122;border-color:#3366cc;box-shadow:inset 0 0 0 1px #3366cc,inset 0 0 0 2px #ffffff}input[type='checkbox']:active+.mw-ui-button.mw-ui-quiet,input[type='checkbox']:active+.mw-ui-button.mw-ui-quiet.mw-ui-progressive,input[type='checkbox']:active+.mw-ui-button.mw-ui-quiet.mw-ui-destructive,.mw-ui-button.mw-ui-quiet:active,.mw-ui-button.mw-ui-quiet.mw-ui-progressive:active,.mw-ui-button.mw-ui-quiet.mw-ui-destructive:active{background-color:rgba(0,36,73,0.08235294);color:#000000;border-color:#72777d;box-shadow:none}.mw-ui-button.mw-ui-quiet:disabled,.mw-ui-button.mw-ui-quiet.mw-ui-progressive:disabled,.mw-ui-button.mw-ui-quiet.mw-ui-destructive:disabled,.mw-ui-button.mw-ui-quiet:disabled:hover,.mw-ui-button.mw-ui-quiet.mw-ui-progressive:disabled:hover,.mw-ui-button.mw-ui-quiet.mw-ui-destructive:disabled:hover,.mw-ui-button.mw-ui-quiet:disabled:active,.mw-ui-button.mw-ui-quiet.mw-ui-progressive:disabled:active,.mw-ui-button.mw-ui-quiet.mw-ui-destructive:disabled:active{background-color:transparent;color:#72777d;border-color:transparent}a.mw-ui-button{text-decoration:none}a.mw-ui-button:hover,a.mw-ui-button:focus{text-decoration:none}.mw-ui-icon{font-size:initial;position:relative;display:inline-block;box-sizing:content-box!important;width:1.25em;height:1.25em;min-width:1.25em;min-height:1.25em;flex-basis:1.25em;vertical-align:middle;line-height:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;-moz-appearance:none;-webkit-appearance:none;background-color:transparent;margin:0;padding:0}.mw-ui-icon:not(.mw-ui-button){border:0}.mw-ui-icon:before{content:'';display:block;width:100%;height:100%;min-width:1.25em;min-height:1.25em;background-repeat:no-repeat;background-size:1.25em 1.25em;background-position:center}.mw-ui-icon-element{border-radius:2px;padding:0.75em;-webkit-transition:background-color 100ms;transition:background-color 100ms}.mw-ui-icon-element:focus,.mw-ui-icon-element:active,.mw-ui-icon-element:visited{color:transparent}.mw-ui-icon-element:active{background-color:rgba(0,0,0,0.03)}@media (hover:hover){.mw-ui-icon-element:not(.disabled):hover{background-color:rgba(0,0,0,0.03)}}.mw-ui-icon-before{width:auto;max-width:100%}.mw-ui-icon-before:before{display:inline-block;font-size:initial;width:auto;min-width:1.25em;min-height:1.25em;margin-right:8px;vertical-align:middle}.mw-ui-icon-before span{vertical-align:middle}.mw-ui-icon-wikimedia-ellipsis:before{background-image:url(data:text/plain;base64,SW1hZ2UgZ2VuZXJhdGlvbiBmYWlsZWQ=);background-image:linear-gradient(transparent,transparent),url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDIwIDIwIj48dGl0bGU+ZWxsaXBzaXM8L3RpdGxlPjxnIGZpbGw9IiMwMDAiPjxjaXJjbGUgY3g9IjEwIiBjeT0iMTAiIHI9IjIiLz48Y2lyY2xlIGN4PSIzIiBjeT0iMTAiIHI9IjIiLz48Y2lyY2xlIGN4PSIxNyIgY3k9IjEwIiByPSIyIi8+PC9nPjwvc3ZnPgo=)}.mw-ui-icon-wikimedia-logIn:before{background-image:url(data:text/plain;base64,SW1hZ2UgZ2VuZXJhdGlvbiBmYWlsZWQ=);background-image:linear-gradient(transparent,transparent),url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDIwIDIwIj48dGl0bGU+bG9nIGluPC90aXRsZT48ZyBmaWxsPSIjMDAwIj48cGF0aCBkPSJNMSAxMXY2YzAgMS4xLjkgMiAyIDJoMTRjMS4xIDAgMi0uOSAyLTJWM2MwLTEuMS0uOS0yLTItMkgzYy0xLjEgMC0yIC45LTIgMnY2aDhWNWw0Ljc1IDVMOSAxNXYtNEgxeiIvPjwvZz48L3N2Zz4K)}body{margin:0}main{display:block}@supports (text-decoration:underline dotted){abbr[title]{border-bottom:0;text-decoration:underline dotted}}pre{font-family:monospace,monospace}sup{line-height:1}img{border:0}input{margin:0}.toctogglecheckbox:checked~ul{display:none}@media screen{html,body{height:100%}:focus{outline-color:#3366cc}html{font-size:100%}html,body{font-family:sans-serif}ul{list-style-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1IiBoZWlnaHQ9IjEzIj4KCTxjaXJjbGUgY3g9IjIuNSIgY3k9IjkiIHI9IjIuNSIgZmlsbD0iIzIwMjEyMiIvPgo8L3N2Zz4K)}pre{line-height:1.3}.mw-jump-link:not(:focus){display:block;position:absolute!important;clip:rect(1px,1px,1px,1px);width:1px;height:1px;margin:-1px;border:0;padding:0;overflow:hidden}.mw-body h1,.mw-body-content h2{margin-bottom:0.25em;padding:0;font-family:'Linux Libertine','Georgia','Times',serif;line-height:1.3}.mw-body h1:lang(ja),.mw-body-content h1:lang(ja),.mw-body-content h2:lang(ja),.mw-body h1:lang(he),.mw-body-content h1:lang(he),.mw-body-content h2:lang(he),.mw-body h1:lang(ko),.mw-body-content h1:lang(ko),.mw-body-content h2:lang(ko){font-family:sans-serif}.mw-body h1:lang(my),.mw-body-content h1:lang(my),.mw-body-content h2:lang(my){line-height:normal}.mw-body h1{font-size:1.8em}.vector-body{font-size:calc(1em * 0.875);line-height:1.6}.vector-body h2{margin-top:1em;font-size:1.5em}.vector-body h3,.vector-body h4,.vector-body h5,.vector-body h6{margin-top:0.3em;margin-bottom:0;padding-bottom:0;line-height:1.6}.vector-body h3{font-size:1.2em}.vector-body h3,.vector-body h4{font-weight:bold}.vector-body h4,.vector-body h5,.vector-body h6{font-size:100%}.vector-body .toc h2{font-family:sans-serif;font-size:100%}.vector-body p{margin:0.5em 0}.mw-parser-output .external{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiI+Cgk8cGF0aCBmaWxsPSIjZmZmIiBzdHJva2U9IiMzNmMiIGQ9Ik0xLjUgNC41MThoNS45ODJWMTAuNUgxLjV6Ii8+Cgk8cGF0aCBmaWxsPSIjMzZjIiBkPSJNNS43NjUgMUgxMXY1LjM5TDkuNDI3IDcuOTM3bC0xLjMxLTEuMzFMNS4zOTMgOS4zNWwtMi42OS0yLjY4OCAyLjgxLTIuODA4TDQuMiAyLjU0NHoiLz4KCTxwYXRoIGZpbGw9IiNmZmYiIGQ9Im05Ljk5NSAyLjAwNC4wMjIgNC44ODVMOC4yIDUuMDcgNS4zMiA3Ljk1IDQuMDkgNi43MjNsMi44ODItMi44OC0xLjg1LTEuODUyeiIvPgo8L3N2Zz4K);background-position:center right;background-repeat:no-repeat;padding-right:13px}.mw-body .mw-indicators{font-size:0.875em;line-height:1.6;position:relative}#siteNotice{font-size:0.8em}.mw-portlet ul{list-style:none none;margin:0}.vector-menu-tabs{background-position:left bottom;float:left;height:2.5em;padding-left:1px}.vector-menu-tabs ul{float:left;height:100%;list-style:none none;margin:0;padding:0}.vector-menu-tabs li{background-image:linear-gradient(to top,#77c1f6 0,#e8f2f8 1px,#ffffff 100%);background-position:left bottom;background-repeat:repeat-x;float:left;display:block;height:100%;margin:0;padding:0;line-height:1.125em;white-space:nowrap}.vector-menu-tabs li a{background-position:right bottom;color:#0645ad;-moz-box-sizing:border-box;box-sizing:border-box;display:block;float:left;height:3.07692308em;position:relative;padding-top:1.25em;padding-left:8px;padding-right:8px;font-size:0.8125em;cursor:pointer}.vector-menu-tabs .selected{background:#ffffff}.vector-menu-tabs .selected a,.vector-menu-tabs .selected a:visited{color:#202122;text-decoration:none}@-webkit-keyframes rotate{from{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes rotate{from{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.vector-menu-dropdown{direction:ltr;float:left;cursor:pointer;position:relative;line-height:1.125em}.vector-menu-dropdown h3{color:#54595d;position:relative;display:block;-moz-box-sizing:border-box;box-sizing:border-box}.vector-menu-dropdown h3:after{content:'';background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiIgdmlld0JveD0iMCAwIDEyIDEyIj4KCTxwYXRoIGZpbGw9IiMyMDIxMjIiIGQ9Im0xMS4wNSAzLjk5Ni0uOTY1LTEuMDUzLTQuMDM1IDMuODYtMy45NDctMy44NkwxLjA1IDMuOTk2bDUgNSA1LTUiLz4KPC9zdmc+Cg==);background-position:100% 50%;background-repeat:no-repeat;position:absolute;top:0.76923077em;right:8px;bottom:0;width:1.23076923em;opacity:0.84}.vector-menu-dropdown h3:hover,.vector-menu-dropdown h3:focus{color:#202122}.vector-menu-dropdown h3:hover:after,.vector-menu-dropdown h3:focus:after{opacity:1}.vector-menu-dropdown .vector-menu-content{background-color:#ffffff;list-style:none none;min-width:100%;position:absolute;top:2.5em;left:-1px;margin:0;border:1px solid #a2a9b1;border-top-width:0;padding:0;box-shadow:0 1px 1px 0 rgba(0,0,0,0.1);text-align:left;opacity:0;visibility:hidden;-webkit-transition:opacity 100ms;transition:opacity 100ms;z-index:3}.vector-menu-dropdown .vector-menu-checkbox-expanded,.vector-menu-dropdown .vector-menu-checkbox-collapsed{position:absolute!important;clip:rect(1px,1px,1px,1px);width:1px;height:1px;margin:-1px;border:0;padding:0;overflow:hidden;display:none}.vector-menu-dropdown .vector-menu-checkbox:checked+.vector-menu-heading .vector-menu-checkbox-expanded,.vector-menu-dropdown .vector-menu-checkbox:not(:checked)+.vector-menu-heading .vector-menu-checkbox-collapsed{display:inline}.vector-menu-dropdown .vector-menu-checkbox:checked~.vector-menu-content{opacity:1;visibility:visible}.vector-menu-dropdown ul{list-style:none}.vector-menu-tabs,.vector-menu-tabs a{background-image:linear-gradient(to bottom,rgba(167,215,249,0) 0,#a7d7f9 100%);background-repeat:no-repeat;background-size:1px 100%}.vector-menu-checkbox{cursor:pointer;position:absolute;top:0;left:0;z-index:1;opacity:0;width:100%;height:100%;margin:0;padding:0;display:none}:not(:checked)>.vector-menu-checkbox{display:block}.vector-menu-portal{margin:0 0.6em 0 0.7em;padding:0.25em 0;direction:ltr}.vector-menu-portal h3{display:block;background-image:linear-gradient(to right,rgba(200,204,209,0) 0,#c8ccd1 33%,#c8ccd1 66%,rgba(200,204,209,0) 100%);background-position:center bottom;background-repeat:no-repeat;background-size:100% 1px;color:#54595d;margin:0.5em 0 0 0.66666667em;border:0;padding:0.25em 0;font-size:0.75em;font-weight:normal;cursor:default}.vector-menu-portal .vector-menu-content{margin-left:0.5em;padding-top:0}.vector-menu-portal .vector-menu-content ul{list-style:none none;margin:0;padding-top:0.3em}.vector-menu-portal .vector-menu-content li{margin:0;padding:0.25em 0;font-size:0.75em;line-height:1.125em;word-wrap:break-word}.vector-menu-portal .vector-menu-content li a{color:#0645ad}.vector-menu-portal .vector-menu-content li a:visited{color:#0b0080}#p-search h3{display:block;position:absolute!important;clip:rect(1px,1px,1px,1px);width:1px;height:1px;margin:-1px;border:0;padding:0;overflow:hidden}#simpleSearch{position:relative;height:100%}#searchInput{background-color:rgba(255,255,255,0.5);color:#000000;width:100%;height:2.15384615em;-moz-box-sizing:border-box;box-sizing:border-box;border:1px solid #a2a9b1;border-radius:2px;padding:5px 2.15384615em 5px 0.4em;box-shadow:inset 0 0 0 1px transparent;font-family:inherit;font-size:0.8125em;direction:ltr;-webkit-transition:border-color 250ms,box-shadow 250ms;transition:border-color 250ms,box-shadow 250ms;-webkit-appearance:none;-moz-appearance:textfield}#simpleSearch:hover #searchInput{border-color:#72777d}#searchInput:focus,#simpleSearch:hover #searchInput:focus{outline:0;border-color:#3366cc;box-shadow:inset 0 0 0 1px #3366cc}#searchInput::-webkit-input-placeholder{color:#72777d;opacity:1}#searchInput::placeholder{color:#72777d;opacity:1}#searchInput::-webkit-search-decoration,#searchInput::-webkit-search-cancel-button,#searchInput::-webkit-search-results-button,#searchInput::-webkit-search-results-decoration{display:none}#searchButton,#mw-searchButton{background-color:transparent;position:absolute;top:1px;bottom:1px;right:1px;min-width:28px;width:2.15384615em;border:0;padding:0;cursor:pointer;font-size:0.8125em;direction:ltr;text-indent:-99999px;white-space:nowrap;overflow:hidden;z-index:1}#searchButton{background:no-repeat center / 1.23076923em url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDIwIDIwIj4KCTx0aXRsZT4KCQlzZWFyY2gKCTwvdGl0bGU+Cgk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMi4yIDEzLjZhNyA3IDAgMSAxIDEuNC0xLjRsNS40IDUuNC0xLjQgMS40LTUuNC01LjR6TTEzIDhBNSA1IDAgMSAxIDMgOGE1IDUgMCAwIDEgMTAgMHoiLz4KPC9zdmc+Cg==);opacity:0.67}.vector-search-box-collapses>div{display:none}.mw-footer{direction:ltr}.mw-footer ul{list-style:none none;margin:0;padding:0}.mw-footer li{color:#202122;margin:0;padding:0.5em 0;font-size:0.75em}#footer-info li{line-height:1.4}#footer-places li{float:left;margin-right:1em;line-height:2}}@media screen and (min-width:1000px){.vector-search-box-collapses>div{display:block}}@media screen{body{background-color:#f8f9fa;color:#202122;overflow-y:scroll}.mw-body{direction:ltr}.mw-body{border-top:1px solid #a7d7f9;margin-top:-1px;padding:1.25em 0.5em 1.5em}.mw-body .firstHeading{overflow:visible}.mw-header{min-height:3.125em;margin:0.625em 0 0.3125em;padding:0.125em 0;display:-ms-flexbox;display:flex;flex-wrap:nowrap;align-items:center;position:relative;z-index:4}#p-search{float:left;margin:0 0 0 2.85714286em;z-index:3;flex-grow:1}#p-search>div>#searchform{-moz-box-sizing:border-box;box-sizing:border-box;margin-left:0}.mw-body,#left-navigation,.mw-footer{margin-left:0}.mw-indicators{z-index:1}.vector-body{position:relative;z-index:0}#mw-navigation h2{position:absolute;top:-9999px}.mw-article-toolbar-container{max-width:60em;margin-left:auto;margin-right:auto}.mw-article-toolbar-container:after{clear:both;content:'';display:block}#left-navigation{float:left}#right-navigation{float:right}#right-navigation .vector-menu-content{left:auto;right:-1px}#mw-sidebar-button{float:left;margin-left:-0.75em;margin-right:0.75em}#mw-panel{background-image:linear-gradient(to bottom,#ffffff 0%,#f8f9fa 10%,#f8f9fa 90%,#ffffff 100%);position:absolute;left:-1.875em;width:11em;-moz-box-sizing:border-box;box-sizing:border-box;padding:8px 0 40px 0.8125em;z-index:1}#p-namespaces{background-image:none;padding-left:0}.mw-footer{border-top:1px solid #a2a9b1;padding:0.75em}.mw-page-container{max-width:103.125em;min-height:100%;margin-left:auto;margin-right:auto;padding:0.05px 0.9375em;background-color:#ffffff}.skin--responsive .mw-page-container{min-width:auto}.mw-page-container-inner{position:relative}.mw-workspace-container{max-width:90em;margin-left:auto;margin-right:auto;position:relative}.mw-workspace-container.mw-footer-container{position:static}.mw-content-container{max-width:60em;margin-left:auto;margin-right:auto}.mw-footer-container{padding-top:50px;padding-bottom:82px}#mw-sidebar-checkbox:not(:checked)~.mw-workspace-container .mw-sidebar{-webkit-transform:translateX(-6.5625em);-ms-transform:translateX(-6.5625em);transform:translateX(-6.5625em)}@keyframes search-loader-progress-bar{0%{background-size:0 2px;background-position:-10% 0}30%{background-size:30% 2px;background-position:-10% 0}70%{background-size:30% 2px;background-position:110% 0}100%{background-size:0 2px;background-position:110% 0}}#p-search{font-size:calc(1em * 0.875)}#searchInput,#searchButton,#mw-searchButton{font-size:inherit}#searchInput{height:2.28571429em}#searchButton,#mw-searchButton{background-size:1.42857143em auto}.client-js .skin-vector-search-vue #searchInput{padding-left:2.57142857em;padding-right:8px}.client-js .skin-vector-search-vue #searchButton,.client-js .skin-vector-search-vue #mw-searchButton{pointer-events:none;right:auto;top:0;bottom:0;left:1px;width:2.57142857em}.client-js .skin-vector-search-vue .p-search--show-thumbnail #searchInput:focus,.client-js .skin-vector-search-vue .vector-search-box-show-thumbnail #searchInput:focus{position:relative;padding-left:calc(2.57142857em + 24px);width:calc(100% + 24px);left:calc(-1 * 24px)}.client-js .skin-vector-search-vue .p-search--show-thumbnail #searchInput:focus~#searchButton,.client-js .skin-vector-search-vue .vector-search-box-show-thumbnail #searchInput:focus~#searchButton,.client-js .skin-vector-search-vue .p-search--show-thumbnail #searchInput:focus~#mw-searchButton,.client-js .skin-vector-search-vue .vector-search-box-show-thumbnail #searchInput:focus~#mw-searchButton{left:-11px}#mw-panel{font-size:inherit}#mw-panel nav:first-child{background-image:none}#mw-panel nav:first-child h3{display:none}#mw-panel nav:first-child .vector-menu-content{margin-left:0.5em}.mw-checkbox-hack-button{display:inline-block;cursor:pointer}#mw-sidebar-button:before{opacity:0.67;background-image:url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2220%22 height=%2220%22 viewBox=%220 0 20 20%22%3E %3Ctitle%3E chevron %3C/title%3E %3Cpath d=%22m9 2 1.3 1.3L3.7 10l6.6 6.7L9 18l-8-8 8-8zm8.5 0L19 3.3 12.2 10l6.7 6.7-1.4 1.3-8-8 8-8z%22/%3E %3C/svg%3E")}#mw-sidebar-checkbox:not(:checked)~.mw-header #mw-sidebar-button:before{background-image:url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2220%22 height=%2220%22 viewBox=%220 0 20 20%22%3E %3Ctitle%3E menu %3C/title%3E %3Cpath d=%22M1 3v2h18V3zm0 8h18V9H1zm0 6h18v-2H1z%22/%3E %3C/svg%3E")}#mw-sidebar-button:hover:before{opacity:1}#mw-sidebar-checkbox:not(:checked)~.mw-workspace-container .mw-sidebar{visibility:hidden;opacity:0;-webkit-transform:translateX(-100%);-ms-transform:translateX(-100%);transform:translateX(-100%)}.vector-animations-ready .mw-sidebar{-webkit-transition:transform 100ms ease-out,opacity 100ms ease-out,visibility 100ms ease-out;transition:transform 100ms ease-out,opacity 100ms ease-out,visibility 100ms ease-out}.vector-animations-ready #mw-sidebar-button{-webkit-transition:background-color 100ms,border-color 100ms,box-shadow 100ms;transition:background-color 100ms,border-color 100ms,box-shadow 100ms}.vector-user-links{display:flex;align-items:center;position:relative;justify-content:flex-end;flex-shrink:1}.vector-user-links .vector-user-menu-more{font-size:0.875em}.vector-user-links .vector-user-menu-more .vector-menu-content-list{display:flex;align-items:center}.vector-user-links .vector-user-menu-more .vector-menu-content-list li{margin:0;white-space:nowrap}.vector-user-links .vector-user-menu-more .vector-menu-content-list li a{color:#202122;text-decoration:none}.vector-user-links .vector-user-menu-more .vector-menu-content-list li.user-links-collapsible-item{display:none}.vector-user-links .vector-user-menu-more .mw-ui-button{display:flex;align-items:center}.vector-user-links .vector-user-menu.emptyPortlet{display:block}.vector-user-links .vector-user-menu .vector-menu-heading.mw-ui-icon>span{color:transparent}.vector-user-links .vector-user-menu .vector-menu-content{min-width:200px;max-width:21.875em;top:100%;left:unset;right:0;border-top-width:1px;border-radius:2px;box-shadow:0 2px 2px 0 rgba(0,0,0,0.25)}.vector-user-links .vector-user-menu .vector-menu-content-item{min-height:2em;display:flex;align-items:center;padding:0 12px;color:#202122;text-decoration:none}.vector-user-links .vector-user-menu .vector-menu-content-item span{font-size:0.875em;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:initial}.vector-user-links .vector-user-menu li>a:hover,.vector-user-links .vector-user-menu .vector-menu-content-item:hover,.vector-user-links .vector-user-menu .mw-list-item>a:hover{background-color:#f6f6f6}.vector-user-links .vector-user-menu .vector-menu-content-item-login{border-bottom:1px solid #a2a9b1}.vector-user-links .vector-user-menu .vector-user-menu-anon-editor{padding:4px 12px;color:#54595d;font-size:0.875em}.vector-user-links .vector-user-menu .vector-user-menu-anon-editor p{margin:0}.vector-user-links .vector-user-menu .vector-user-menu-anon-editor a:before{content:'(';color:#54595d}.vector-user-links .vector-user-menu .vector-user-menu-anon-editor a:after{content:')';color:#54595d}.vector-user-links .vector-user-menu-logged-out h3:before{height:100%}.vector-user-links .vector-user-menu-logged-out h3:after{content:none}}@media screen and (min-width:106.875em){.mw-page-container{border-left:1px solid #f8f9fa;border-right:1px solid #f8f9fa}}@media screen and (max-width:86.75em){.mw-checkbox-hack-checkbox:checked~.mw-workspace-container .mw-content-container,.mw-checkbox-hack-checkbox:checked~.mw-workspace-container .mw-article-toolbar-container{margin-left:11.5em}.vector-animations-ready .mw-sidebar{-webkit-transition:none;transition:none}}@media screen and (min-width:93.75em){#mw-panel{background:#ffffff;border-right:1px solid #f8f9fa}}@media screen and (min-width:1000px){#p-search{margin:0 12px 0 2.85714286em;width:20vw;max-width:100%;min-width:25em;flex-basis:10.71428571em;flex-grow:1}#p-search>div>#searchform{max-width:35.71428571em}.mw-page-container{padding-left:1.875em;padding-right:1.875em}}@media screen and (max-width:720px){.mw-checkbox-hack-checkbox:checked~.mw-workspace-container #mw-panel{width:100%;position:relative;left:0}.mw-checkbox-hack-checkbox:checked~.mw-workspace-container .mw-content-container,.mw-checkbox-hack-checkbox:checked~.mw-workspace-container .mw-article-toolbar-container{margin-left:0!important}}@media screen and (max-width:720px){.vector-animations-ready .mw-sidebar{transition:none}}@media screen and (min-width:720px){.vector-user-links .vector-user-menu-more .vector-menu-content-list li.user-links-collapsible-item{display:block}}@media screen{.mw-parser-output a.extiw:visited,.mw-parser-output a.external:visited{color:#663366}.mw-parser-output a.extiw:active,.mw-parser-output a.external:active{color:#bb6633}.plainlinks a.external{background:none!important;padding:0!important}.mw-parser-output a.external{background-image:var(--sf-img-8);background-position:center right;background-repeat:no-repeat;padding-right:13px}.mw-parser-output a.external[href$='.pdf'],.mw-parser-output a.external[href*='.pdf#']{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMyIgaGVpZ2h0PSIxMyI+Cgk8cGF0aCBmaWxsPSIjMTVhNWVhIiBkPSJNNy41IDJ2M0gxMGwxLTFIOC41VjF6Ii8+Cgk8cGF0aCBmaWxsPSIjMzZiIiBkPSJNMyAxdjEwaDhWNEw4LjUgMXptMSAxaDRsMiAyLjVWMTBINHoiLz4KPC9zdmc+Cg==);background-position:center right;background-repeat:no-repeat;padding-right:13px}.mw-parser-output a.extiw,.mw-parser-output a.extiw:active{color:#36b}.mw-parser-output a.external{color:#36b}.mw-body-content:after{clear:both;content:'';display:block}.mw-body-content a.external.free{word-wrap:break-word}#siteNotice{position:relative;text-align:center;margin:0}#contentSub,#contentSub2{font-size:84%;line-height:1.2em;margin:0 0 1.4em 1em;color:#54595d;width:auto}.emptyPortlet{display:none}.mw-indicators{float:right}#catlinks{text-align:left}.catlinks{border:1px solid #a2a9b1;background-color:#f8f9fa;padding:5px;margin-top:1em;clear:both}.catlinks ul{display:inline;margin:0;padding:0;list-style:none}.catlinks li{display:inline-block;line-height:1.25em;border-left:1px solid #a2a9b1;margin:0.125em 0;padding:0 0.5em}.catlinks li:first-child{padding-left:0.25em;border-left:0}a{text-decoration:none;color:#0645ad;background:none}a:not([href]){cursor:pointer}a:visited{color:#0b0080}a:active{color:#faa700}a:hover,a:focus{text-decoration:underline}a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}img{border:0;vertical-align:middle}h1,h2,h3,h4,h5,h6{color:#000;margin:0;padding-top:0.5em;padding-bottom:0.17em;overflow:hidden}h1,h2{margin-bottom:0.6em;border-bottom:1px solid #a2a9b1}h3,h4,h5{margin-bottom:0.3em}h1{font-size:188%;font-weight:normal}h2{font-size:150%;font-weight:normal}h3{font-size:128%}h4{font-size:116%}h5{font-size:108%}h6{font-size:100%}p{margin:0.4em 0 0.5em 0}p img{margin:0}ul{margin:0.3em 0 0 1.6em;padding:0}ol{list-style-image:none}li{margin-bottom:0.1em}pre,code{font-family:monospace,monospace}pre,code{background-color:#f8f9fa;color:#000;border:1px solid #eaecf0}code{border-radius:2px;padding:1px 4px}pre{padding:1em;white-space:pre-wrap;overflow-x:hidden;word-wrap:break-word}form{border:0;margin:0}@counter-style meetei{system:numeric;symbols:'\ABF0' '\ABF1' '\ABF2' '\ABF3' '\ABF4' '\ABF5' '\ABF6' '\ABF7' '\ABF8' '\ABF9';suffix:') '}@counter-style santali{system:numeric;symbols:'\1C50' '\1C51' '\1C52' '\1C53' '\1C54' '\1C55' '\1C56' '\1C57' '\1C58' '\1C59'}ol:lang(azb) li,ol:lang(bcc) li,ol:lang(bgn) li,ol:lang(bqi) li,ol:lang(fa) li,ol:lang(glk) li,ol:lang(kk-arab) li,ol:lang(lrc) li,ol:lang(luz) li,ol:lang(mzn) li{list-style-type:persian}ol:lang(ckb) li,ol:lang(sdh) li{list-style-type:arabic-indic}ol:lang(hi) li,ol:lang(mai) li,ol:lang(mr) li,ol:lang(ne) li{list-style-type:devanagari}ol:lang(as) li,ol:lang(bn) li{list-style-type:bengali}ol:lang(mni) li{list-style-type:meetei}ol:lang(or) li{list-style-type:oriya}ol:lang(sat) li{list-style-type:santali}.mw-content-ltr ul{margin:0.3em 0 0 1.6em;padding:0}.mw-content-ltr ol{margin:0.3em 0 0 3.2em;padding:0}h1:lang(anp),h1:lang(as),h1:lang(bh),h1:lang(bho),h1:lang(bn),h1:lang(gu),h1:lang(hi),h1:lang(kn),h1:lang(ks),h1:lang(ml),h1:lang(mr),h1:lang(my),h1:lang(mai),h1:lang(ne),h1:lang(new),h1:lang(or),h1:lang(pa),h1:lang(pi),h1:lang(sa),h1:lang(ta),h1:lang(te){line-height:1.6em!important}h2:lang(anp),h3:lang(anp),h4:lang(anp),h5:lang(anp),h6:lang(anp),h2:lang(as),h3:lang(as),h4:lang(as),h5:lang(as),h6:lang(as),h2:lang(bho),h3:lang(bho),h4:lang(bho),h5:lang(bho),h6:lang(bho),h2:lang(bh),h3:lang(bh),h4:lang(bh),h5:lang(bh),h6:lang(bh),h2:lang(bn),h3:lang(bn),h4:lang(bn),h5:lang(bn),h6:lang(bn),h2:lang(gu),h3:lang(gu),h4:lang(gu),h5:lang(gu),h6:lang(gu),h2:lang(hi),h3:lang(hi),h4:lang(hi),h5:lang(hi),h6:lang(hi),h2:lang(kn),h3:lang(kn),h4:lang(kn),h5:lang(kn),h6:lang(kn),h2:lang(ks),h3:lang(ks),h4:lang(ks),h5:lang(ks),h6:lang(ks),h2:lang(ml),h3:lang(ml),h4:lang(ml),h5:lang(ml),h6:lang(ml),h2:lang(mr),h3:lang(mr),h4:lang(mr),h5:lang(mr),h6:lang(mr),h2:lang(my),h3:lang(my),h4:lang(my),h5:lang(my),h6:lang(my),h2:lang(mai),h3:lang(mai),h4:lang(mai),h5:lang(mai),h6:lang(mai),h2:lang(ne),h3:lang(ne),h4:lang(ne),h5:lang(ne),h6:lang(ne),h2:lang(new),h3:lang(new),h4:lang(new),h5:lang(new),h6:lang(new),h2:lang(or),h3:lang(or),h4:lang(or),h5:lang(or),h6:lang(or),h2:lang(pa),h3:lang(pa),h4:lang(pa),h5:lang(pa),h6:lang(pa),h2:lang(pi),h3:lang(pi),h4:lang(pi),h5:lang(pi),h6:lang(pi),h2:lang(sa),h3:lang(sa),h4:lang(sa),h5:lang(sa),h6:lang(sa),h2:lang(ta),h3:lang(ta),h4:lang(ta),h5:lang(ta),h6:lang(ta),h2:lang(te),h3:lang(te),h4:lang(te),h5:lang(te),h6:lang(te){line-height:1.4em}h2:lang(th){line-height:1.6}.toc{border:1px solid #a2a9b1;background-color:#f8f9fa;font-size:95%}.toc{display:table;padding:7px}.toc h2{display:inline;border:0;padding:0;font-size:100%;font-weight:bold}.toc .toctitle{text-align:center}.toc ul{list-style:none;margin:0.3em 0;padding:0}.tocnumber,.toctext{display:table-cell;text-decoration:inherit}.tocnumber{color:#202122}.mw-content-ltr .tocnumber{padding-left:0;padding-right:0.5em}.toctogglecheckbox{display:inline!important;position:absolute;opacity:0;z-index:-1}.toctogglespan{font-size:94%}.toctogglespan:before{content:' ['}.toctogglespan:after{content:']'}.toctogglelabel{cursor:pointer;color:#0645ad}.toctogglelabel:hover{text-decoration:underline}.toctogglecheckbox:focus+.toctitle .toctogglelabel{text-decoration:underline;outline:dotted 1px;outline:auto -webkit-focus-ring-color}.toctogglecheckbox:checked+.toctitle .toctogglelabel:after{content:'show'}.toctogglecheckbox:not(:checked)+.toctitle .toctogglelabel:after{content:'hide'}.toc .toctitle{direction:ltr}.mw-content-ltr .toc ul{text-align:left}.mw-content-ltr .toc ul ul{margin:0 0 0 2em}}#archnavbar{height:40px!important;padding:10px 15px!important;background:#333!important;border-bottom:5px #08c solid!important}#archnavbarlogo{float:left!important;margin:0!important;padding:0!important;height:40px!important;width:190px!important}html>body #archnavbarlogo{background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEiIHdpZHRoPSI2MDAiIGhlaWdodD0iMTI2Ij48cGF0aCBkPSJNMTU5LjU2OCAzNC40MjdjLTguODktLjAxNC0xNi4yNjcgMS44MDktMTkuMTIgMi44MDNsLTIuOTM3IDE1Ljg1N2MtLjAwNy4wNTggMTQuNjE3LTMuOSAyMS4wNTktMy42NjcgMTAuNjY1LjM4MyAxMS42NDYgNC4wNzYgMTEuNDYgOS4wNi4xODIuMjkyLTIuNzUyLTQuNTAzLTExLjk3OS00LjY2NC0xMS42NC0uMi0yOC4wNjkgNC4xMjItMjguMDQ2IDIxLjY5Mi0uMzE0IDE5Ljc2NSAxNC43NjQgMjUuNTc5IDI1LjAzMiAyNS42ODYgOS4yMzItLjE2OCAxMy41NjMtMy40OTYgMTUuOTM0LTUuMjggMy4xMTUtMy4yNTcgNi42NzktNi41MzIgMTAuMDc4LTEwLjQ2Mi0zLjIxNiA1Ljg0NC02LjAwNSA5Ljg4NC04LjkwNyAxMi45Nzd2Mi42MTFsMTQuMDMzLTIuMzYxLjA5Ni0zOC4xNDRjLS4xNDMtNS4zOTkgMy4wOTYtMjYuMDU3LTI2LjcwMy0yNi4xMDh6bS0yLjAxNiAzMy4yMWM1LjgxNy4wOCAxMi40ODggMi45NDggMTIuNDk3IDkuODQ5LjAzIDYuMjc3LTcuODYzIDkuNjUxLTEyLjk5NiA5LjU5OC01LjEzNS0uMDUzLTExLjk0OS00LjAzNi0xMS45NzktMTAuMTU1LjA5OS01LjQ3IDYuNDI2LTkuNDMyIDEyLjQ3OC05LjI5MXptMzcuOTcyLTI5LjY4NWwtLjA5NSA2My4xNjYgMTYuMzQ4LTMuMTUuMDI3LTM1LjgxNGMuMDA0LTUuMzMzIDcuNjItMTEuNTY0IDE3LjE3OC0xMS40NjQgMi4wMjgtMy42NyA1Ljg0LTEzLjA1IDYuNzctMTUuMTgzLTIxLjM1MS0uMDUxLTIxLjYyMyA2LjEzNy0yNS4zMzYgOS4xOC0uMDQtNS44MDYtLjAxMy05LjI5Mi0uMDEzLTkuMjkybC0xNC44NzkgMi41NTd6bTkyLjAwMiA4LjI5MmMtLjE1OC0uMDc0LTguNTI2LTkuNzg4LTI1LjM1LTkuODY0LTE1Ljc1OC0uMjYyLTMzLjQzMyA1Ljg0Ny0zMy43MTYgMzIuMjcuMTM4IDIzLjIzMiAxNi45NzkgMzIuMzExIDMzLjgwNSAzMi40ODggMTguMDA3LjE4NyAyNS4xNzItMTEuMjYgMjUuNjAyLTExLjU0My0yLjE0OS0xLjg2My0xMC4xOTYtOS44MzctMTAuMTk2LTkuODM3cy01LjAyNyA3LjE1Ny0xNC43NzkgNy4yNDhjLTkuNzU1LjA5My0xOC4yMzQtNy41NC0xOC4zNTQtMTguMTg5LS4xMjUtMTAuNjUgNy43OTUtMTYuNDE5IDE4LjQyNy0xNi44ODUgOS4yMDUtLjAwMiAxNC41MTYgNS45NDMgMTQuNTE2IDUuOTQzem0yMC42MDYtMzAuMzk5bC0xNS40MzQgMy42MjguMTE1IDgyLjI3NyAxNS4yMDQtMi43NDUuMTcyLTM4LjcyYy4wMzMtNC4wNiA1Ljg3NC0xMC4yOTUgMTUuNjI2LTEwLjA5NyA5LjMyNS4wOTcgMTEuNDEgNi4yMTUgMTEuMzg0IDYuOTg4bC4yNjkgNDQuODI0IDE0Ljk5My0yLjY1LjA1Ny00Ny41M2MuMDk5LTQuNTc0LTEwLjAxOC0xNC4yMzMtMjYuMjgtMTQuMzAyLTcuNzI5LjAxMi0xMi4wMDkgMS43NjItMTQuMTg3IDMuMDUyLTMuNzI2IDIuODc5LTcuOTg1IDUuNjM3LTEyLjE3IDkuMTU3IDMuODY5LTQuOTcgNy4xMTctOC40MDcgMTAuMjktMTAuOTYxbC0uMDQtMjIuOTIxeiIgZmlsbD0iI2ZmZiIgZmlsbC1ydWxlPSJldmVub2RkIi8+PHBhdGggZD0iTTM2MC4xMzYgMTcuMjE4bDYuOTYyLTEuNzQyLjMzIDgyLjk1LTcuMDc0IDEuMjA0em0xOC45MjggMjQuNzU3bDYuMTAxLTIuNzE2LjA1MiA1OS40NzgtNS44OTIgMS4yMTd6bS0xLjQ1LTIxLjQ0OGw0LjkyLTQuMDE1IDQuMDg2IDQuNTQ3LTQuOTIxIDQuMTIxem0xOS4wMjQgMjAuMzY1bDYuOTYyLTEuNDIxLjAzMyAxMi40MzRjLjAwMS41MzQgMy44MjMtMTMuODkgMjIuMjU4LTEzLjU3IDE3LjkuMSAyMC44MjcgMTMuOTU3IDIwLjczIDE3LjA2NGwuMjIxIDQzLjcyNS02LjEwMiAxLjMyNC0uMDM1LTQzLjE4OWMuMDctMS4yNjEtMi43OS0xMS45MjctMTUuNDM5LTExLjk2Ni0xMi42NDYtLjAzNy0yMS40MDkgOS4xODYtMjEuMzkzIDE1LjA3OGwuMSAzOC4wNDctNy4wNyAxLjg0N3ptMTEwLjk1NCA1OC41NDZsLTYuOTYyIDEuNDItLjAzMy0xMi40MzNjLS4wMDEtLjUzNC0zLjgyNSAxMy44OS0yMi4yNTggMTMuNTctMTcuOS0uMS0yMC44MjctMTMuOTU3LTIwLjczLTE3LjA2NGwtLjIyMS00My43MjUgNy4zOTctMS40OTQuMTE0IDQzLjE5Yy4wMDMgMS4xOCAxLjQxNiAxMi4wOTYgMTQuMDY1IDEyLjEzNSAxMi42NDYuMDM3IDIxLjUwNi03LjYxNiAyMS41NjktMTkuMTM5bC0uMDktMzQuMDc2IDYuODg1LTEuNzU3em0xMy42NDUtNTkuMDM3bC00Ljg4MiAzLjgyIDE4LjcxNyAyNC40OTQtMTkuOTYzIDI4LjMgNS4xNzkgMy44NDMgMTguNzY2LTI2LjI4IDE5LjM2OCAyNi45MDIgNC43OTEtMy44Mi0yMC43NTctMjguNzY1IDE2LjU2LTIzLjI2Mi01LjA5Mi00LjMwNS0xNS4wODUgMjEuNTI1ek02MS44OCAxLjc3OGMtNS4zODUgMTMuMjAzLTguNjMzIDIxLjgzOS0xNC42MjkgMzQuNjQ5IDMuNjc2IDMuODk2IDguMTg4IDguNDM0IDE1LjUxNiAxMy41NTktNy44NzgtMy4yNDItMTMuMjUyLTYuNDk3LTE3LjI2Ny05Ljg3NC03LjY3MyAxNi4wMTEtMTkuNjk1IDM4LjgxOC00NC4wOSA4Mi42NSAxOS4xNzQtMTEuMDY4IDM0LjAzNy0xNy44OTMgNDcuODg5LTIwLjQ5N2EzNS4xMDMgMzUuMTAzIDAgMCAxLS45MS04LjIxM2wuMDIzLS42MTRjLjMwNC0xMi4yODQgNi42OTQtMjEuNzMgMTQuMjY0LTIxLjA5IDcuNTcuNjQyIDEzLjQ1NCAxMS4xMjYgMTMuMTUgMjMuNDEtLjA1OCAyLjMxMi0uMzE5IDQuNTM2LS43NzQgNi41OTggMTMuNzAxIDIuNjggMjguNDA1IDkuNDg3IDQ3LjMyIDIwLjQwNy0zLjczLTYuODY2LTcuMDU5LTEzLjA1Ni0xMC4yMzgtMTguOTUtNS4wMDctMy44ODItMTAuMjMtOC45MzMtMjAuODg0LTE0LjQwMiA3LjMyMyAxLjkwMyAxMi41NjYgNC4wOTkgMTYuNjUzIDYuNTUyQzc1LjU4IDM1Ljc4NiA3Mi45NjMgMjcuNzkgNjEuODggMS43Nzh6IiBmaWxsPSIjMTc5M2QxIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48cGF0aCBkPSJNNTc2Ljc3MSA5My4yNjVWODAuNjAzaC00Ljczdi0xLjY5NWgxMS4zOHYxLjY5NWgtNC43NXYxMi42NjJoLTEuOW04LjYyOSAwVjc4LjkwOGgyLjg1OWwzLjM5OCAxMC4xNjZjLjMxNC45NDcuNTQyIDEuNjU1LjY4NiAyLjEyNS4xNjMtLjUyMi40MTgtMS4yOS43NjQtMi4zMDFsMy40MzctOS45OWgyLjU1NnYxNC4zNTdoLTEuODMxVjgxLjI1bC00LjE3MiAxMi4wMTZoLTEuNzE0bC00LjE1Mi0xMi4yMjJ2MTIuMjIyaC0xLjgzMiIgZm9udC13ZWlnaHQ9IjQwMCIgZm9udC1zaXplPSI4LjQ0MSIgZm9udC1mYW1pbHk9IkRlamFWdSBTYW5zIE1vbm8iIGZpbGw9ImdyYXkiLz48L3N2Zz4=) no-repeat!important;background-size:190px 40px!important}#archnavbarlogo p{margin:0!important;padding:0!important;text-indent:-9999px!important}#archnavbarlogo a{display:block!important;height:40px!important;width:190px!important}#archnavbar ul{display:inline!important;float:right!important;list-style:none!important;margin:0!important;padding:0!important}#archnavbar ul li{float:left!important;font-size:14px!important;font-family:sans-serif!important;line-height:45px!important;padding-right:15px!important;padding-left:15px!important}#archnavbar ul#archnavbarlist li a{color:#999;font-weight:bold!important;text-decoration:none!important}#archnavbar ul li a:hover{color:white!important;text-decoration:underline!important}#archnavbar ul li.anb-selected a{color:white!important}@media (max-width:600px){#anb-wiki{display:none}}@media (max-width:680px){html>body #archnavbarlogo{width:40px!important;margin-right:5px!important;background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjEyMDAiIHZlcnNpb249IjEiPjxwYXRoIGQ9Ik02MDAgMGMtNTMuNDE2IDEzMC45NjItODUuNjcxIDIxNi43NC0xNDUuMTQzIDM0My44MSAzNi40NjQgMzguNjUxIDgxLjIyIDgzLjQ0OSAxNTMuOTA1IDEzNC4yODUtNzguMTQ1LTMyLjE1Ni0xMzEuNDAzLTY0LjIxMy0xNzEuMjM4LTk3LjcxNEMzNjEuNDEgNTM5LjIgMjQxLjk4OSA3NjUuMTk0IDAgMTIwMGMxOTAuMTYxLTEwOS43ODQgMzM3LjY2NS0xNzcuMzk3IDQ3NS4wNDgtMjAzLjIzOC01Ljg5NS0yNS4zNjctOS4xOC01Mi44OTYtOC45NTMtODEuNTI0bC4xOS01LjkwNUM0NjkuMzA1IDc4Ny40OCA1MzIuNzIgNjkzLjYzOCA2MDcuODEgNzAwYzc1LjA4OSA2LjM2MiAxMzMuNDk0IDExMC41MjggMTMwLjQ3NiAyMzIuMzgxLS41NjggMjIuOTE2LTMuMTA1IDQ0Ljg4NS03LjYyIDY1LjMzM0M4NjYuNTI4IDEwMjQuMzI1IDEwMTIuNDYyIDEwOTEuNzMgMTIwMCAxMjAwYy0zNi45OTUtNjguMTExLTcwLjE4LTEyOS4zMzUtMTAxLjcxNC0xODcuODEtNDkuNjcyLTM4LjQ5OS0xMDEuMzY1LTg4LjYxMy0yMDcuMDQ4LTE0Mi44NTcgNzIuNjQgMTguODc1IDEyNC43OTMgNDAuNjEyIDE2NS4zMzMgNjQuOTUzQzczNS45NTIgMzM3LjM0OCA3MDkuOTQ4IDI1OC4wMTYgNjAwIDB6IiBmaWxsPSIjMTc5M2QxIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=) no-repeat!important;background-size:40px 40px!important}#archnavbar ul{display:flex!important;justify-content:space-between;flex-wrap:nowrap;overflow:hidden;float:none!important}#archnavbar ul li{padding:0!important;float:none!important}}@media (max-width:845px){#anb-home{display:none}html>body #archnavbarlogo{padding-right:15px!important}#archnavbar{padding-left:5px!important;padding-right:5px!important}#archnavbar ul li{padding-left:5px!important;padding-right:5px!important}}body{background:#f6f9fc}#content{background:#ffffff;border:1px solid #cccccc}#content h1,#content h2,#content h3,#content h4,#content h5,#content pre,#content code{color:#222222}#content ul{list-style-image:none}#content pre:not([class*="CodeMirror"]){border:1px solid #bbccdd;overflow:auto;word-break:break-all;white-space:pre-wrap!important}#content pre:not([class*="CodeMirror"]),#content code{background-color:#ebf1f5;font-family:monospace,monospace}#content code{display:inline-block;padding:0 0.3em;border-width:0;border-radius:0}#footer{color:#333333}#toc{background-color:#f9faff;border:1px solid #d7dfe3}#bodyContent>div.mw-content-ltr a{font-weight:bold}#bodyContent #toc a{font-weight:normal}#content a:not(.new),header.mw-header li:not(.new) a:not(.new),#mw-navigation li:not(.new) a:not(.new),#mw-panel li:not(.new) a:not(.new),#column-one li:not(.new) a:not(.new),#footer a:not(.new){text-decoration:none;color:#0077bb!important}#content a:not(.new):hover,header.mw-header li:not(.new) a:not(.new):hover,#mw-navigation li:not(.new) a:not(.new):hover,#mw-panel li:not(.new) a:not(.new):hover,#column-one li:not(.new) a:not(.new):hover,#footer a:not(.new):hover{text-decoration:underline;background-color:transparent;color:#999999!important}#content a:active,header.mw-header li:not(.new) a:active,#mw-navigation li:not(.new) a:active,#mw-panel li:not(.new) a:active,#column-one li:not(.new) a:active,#footer a:active,#content a:focus,header.mw-header li:not(.new) a:focus,#mw-navigation li:not(.new) a:focus,#mw-panel li:not(.new) a:focus,#column-one li:not(.new) a:focus,#footer a:focus,#content a:active:hover,header.mw-header li:not(.new) a:active:hover,#mw-navigation li:not(.new) a:active:hover,#mw-panel li:not(.new) a:active:hover,#column-one li:not(.new) a:active:hover,#footer a:active:hover,#content a:focus:hover,header.mw-header li:not(.new) a:focus:hover,#mw-navigation li:not(.new) a:focus:hover,#mw-panel li:not(.new) a:focus:hover,#column-one li:not(.new) a:focus:hover,#footer a:focus:hover{color:#ee9900!important}#content a:not(.new):visited,#mw-panel li:not(.new) a:not(.new):visited,#p-navigation li:not(.new) a:not(.new):visited,#p-tb li:not(.new) a:not(.new):visited{color:#666666!important}.mw-body-content a.external,.mw-body-content a.extiw{background:var(--sf-img-8) center right no-repeat;padding-right:13px}.mw-body h1,.mw-body-content h2{font-family:sans-serif}nav.vector-menu-tabs{padding-left:0}nav.vector-menu-tabs ul,nav.vector-menu-tabs ul li{background:none}nav.vector-menu-tabs li.selected{border:1px solid #cccccc;border-bottom-color:#ffffff;background-color:#ffffff}nav.vector-menu-tabs li.selected a{background:none!important}nav.vector-menu-tabs ul li{border:1px}body.skin-vector.skin--responsive nav.vector-menu-tabs li.selected{margin-top:-1px;border-bottom:none}body.skin-vector.skin--responsive li:not(:first-child).selected{margin-left:-1px}body.skin-vector.skin--responsive div.mw-page-container{background-color:#f6f9fc}body.skin-vector.skin--responsive div#mw-panel{background-image:none}</style>
<meta name=ResourceLoaderDynamicStyles content>
<style>pre{white-space:pre}#bodyContent a.external[href^="https://wiki.archlinux.org"]{background:none;padding-right:0}span.archwiki-template-pkg,span.archwiki-template-man{font-family:monospace,monospace}div.archwiki-template-box{padding:5px;border:thin solid black;margin:0.5em 0;overflow:hidden}div.archwiki-template-box.archwiki-template-box-note{background-color:#ddf;border-color:#bbd}div.archwiki-template-box.archwiki-template-box-warning{background-color:#fdd;border-color:#dbb}div.archwiki-template-box.archwiki-template-box-tip{background-color:#dfd;border-color:#bdb}div.archwiki-template-message{position:relative;overflow:hidden;min-height:4.6em;margin-bottom:1em;background-color:#f9faff;border:1px solid #d7dfe3;padding:0 100px;text-align:center}div.archwiki-template-message>p>a{display:block;position:absolute;top:5px}div.archwiki-template-message>p>a:first-of-type{left:26px}div.archwiki-template-message>p>a:last-of-type{right:26px}div.archwiki-template-message>div{font-size:90%}div.archwiki-template-meta-related-articles-start{float:right;clear:right;width:25%;margin:0 0 0.5em 0.5em}div.archwiki-template-meta-related-articles-start>p{background:#333;color:white;padding:0.2em;border-bottom:5px #08c solid;margin:0;text-align:center;font-weight:bold}div.archwiki-template-meta-related-articles-start>ul{list-style-type:none;margin:0;padding:0.3em}div.archwiki-template-meta-related-articles-start>ul>li{padding:0.4em 0;line-height:1}</style>
<meta name=generator content="MediaWiki 1.37.2">
<meta name=referrer content=no-referrer-when-downgrade>
<meta name=format-detection content="telephone=no">
<meta name=viewport content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel=search type=application/opensearchdescription+xml href=https://wiki.archlinux.org/opensearch_desc.php title="ArchWiki (en)">
<link rel=EditURI type=application/rsd+xml href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel=license href=http://www.gnu.org/copyleft/fdl.html>
<link rel=alternate type=application/atom+xml title="ArchWiki Atom feed" href="https://wiki.archlinux.org/index.php?title=Special:RecentChanges&amp;feed=atom">
<link rel="shortcut icon" href=data:image/vnd.microsoft.icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABvElEQVQ4jY2TP4gTQRTGfzM7ybp35mBX8LY4GxM5OI4UiqDWtoKIjWhl4QmmEQwIhzZaa3GLlYWgjViI+AcUrrASUYTbQ0UxepwpFj1EDCSXuLNj4QYSLxP8mnm8972P3wyMMMZgUxjF+ycLUjUW5l/YPMq6/VfnHCEmAGuAsBHsurG6QwiaRUeq2cCdfXy88nmUT9qSJ4tywVNyGxjVSbPzNp81wFNyt6cknpJ00uzk2Wfr/n8HHLrz4ajriFeuEsuekvS08Zu/eoujvFveYN+t98XAUw1jmEmN+ZEZfG2M8BzZKhVl+f6x8vexBIGn6hMFOeMqgTEEXZ2J39qwqbNSR5tLYwnmbr6b2hO4axvt1P/a6tHTw3SuI1pTrlNZPT33bSTBps7qb5K23/jZ7S8/AO72511tShud9MJIgjCKdwINYHs+e5TUqkfy2W3gVN5vA+WkVk3+Jbg8sAzwcKB+mp8G+ALUh64QRnEZOMOwPg3Ub/vEgAvcGwoArgKFvF4DrgEfBwKawHVgHagAy2EUnwAQ00sre4HXwBPgSlKrvmSMwig+CCwCh4F5Mb20chF4ntSq1h83JujAH3Eom+H9uAq8AAAAAElFTkSuQmCC><style>.sf-hidden{display:none!important}</style><link rel=canonical href=https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:;"></head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-PCI_passthrough_via_OVMF rootpage-PCI_passthrough_via_OVMF skin-vector action-view skin--responsive skin-vector-search-vue" data-new-gr-c-s-check-loaded=14.1058.0 data-gr-ext-installed><div id=archnavbar class=noprint>
 <div id=archnavbarlogo>
 <p><a id=logo href=https://www.archlinux.org/></a></p>
 </div>
 <div id=archnavbarmenu>
 <ul id=archnavbarlist>
 <li id=anb-home><a href=https://www.archlinux.org/>Home</a></li> <li id=anb-packages><a href=https://www.archlinux.org/packages/>Packages</a></li> <li id=anb-forums><a href=https://bbs.archlinux.org/>Forums</a></li> <li id=anb-wiki class=anb-selected><a href=https://wiki.archlinux.org/>Wiki</a></li> <li id=anb-bugs><a href=https://bugs.archlinux.org/>Bugs</a></li> <li id=anb-security><a href=https://security.archlinux.org/>Security</a></li> <li id=anb-aur><a href=https://aur.archlinux.org/>AUR</a></li> <li id=anb-download><a href=https://www.archlinux.org/download/>Download</a></li> </ul>
 </div>
</div>
<div class=mw-page-container>
 <a class=mw-jump-link href=#content>Jump to content</a>
 <div class=mw-page-container-inner>
<input type=checkbox id=mw-sidebar-checkbox class="mw-checkbox-hack-checkbox sf-hidden">
<header class=mw-header>
 <label id=mw-sidebar-button class="mw-checkbox-hack-button mw-ui-icon mw-ui-button mw-ui-quiet mw-ui-icon-element" for=mw-sidebar-checkbox role=button aria-controls=mw-panel data-event-name=ui.sidebar tabindex=0 title="Main menu" aria-expanded=false>
 Toggle sidebar
 </label>
 <a href=https://wiki.archlinux.org/title/Main_page class="mw-logo sf-hidden">
 
 </a>
 <div id=p-search role=search class="vector-search-box vector-search-box-collapses vector-search-box-show-thumbnail">
 <div>
 <h3>
 <label for=searchInput>Search</label>
 </h3>
 <form action=/index.php id=searchform>
 <div id=simpleSearch data-search-loc=header-moved>
 <input type=search name=search placeholder="Search ArchWiki" autocapitalize=sentences accesskey=f id=searchInput autocomplete=off value>
 
 <input type=submit name=fulltext value=Search title="Search the pages for this text" id=mw-searchButton class="searchButton mw-fallbackSearchButton">
 <input type=submit name=go value=Go title="Go to a page with this exact name if it exists" id=searchButton class=searchButton>
 </div>
 </form>
 </div>
 <a href=https://wiki.archlinux.org/title/Special:Search class="mw-ui-button mw-ui-quiet mw-ui-icon mw-ui-icon-element mw-ui-icon-wikimedia-search search-toggle sf-hidden">
 
 
 </a>
 
</div>
 <div class=vector-user-links>
 <nav id=p-personal-more class="mw-portlet mw-portlet-personal-more vector-menu vector-user-menu-more" aria-labelledby=p-personal-more-label role=navigation>
 <h3 id=p-personal-more-label class="vector-menu-heading sf-hidden"> 
 </h3>
 <div class=vector-menu-content>
 
 <ul class=vector-menu-content-list>
 <li id=p-createaccount class=user-links-collapsible-item>
 <a href="https://wiki.archlinux.org/index.php?title=Special:CreateAccount&amp;returnto=PCI+passthrough+via+OVMF" icon=userAvatar class="mw-ui-button mw-ui-quiet" title="You are encouraged to create an account and log in; however, it is not mandatory"><span>Create account</span></a>
 </li>
</ul>
 
 </div>
</nav>
 <nav id=p-personal class="mw-portlet mw-portlet-personal emptyPortlet vector-user-menu vector-user-menu-logged-out vector-menu vector-menu-dropdown" aria-labelledby=p-personal-label role=navigation title="More options">
 <input type=checkbox id=p-personal-checkbox role=button aria-haspopup=true data-event-name=ui.dropdown-p-personal class=vector-menu-checkbox aria-labelledby=p-personal-label>
 <h3 id=p-personal-label class="vector-menu-heading mw-ui-button mw-ui-quiet mw-ui-icon mw-ui-icon-element mw-ui-icon-wikimedia-ellipsis"> <span>Personal tools</span>
 <span class=vector-menu-checkbox-expanded>expanded</span>
 <span class=vector-menu-checkbox-collapsed>collapsed</span>
 </h3>
 <div class=vector-menu-content>
 <div class=vector-user-menu-create-account><a href="https://wiki.archlinux.org/index.php?title=Special:CreateAccount&amp;returnto=PCI+passthrough+via+OVMF" icon=userAvatar class="user-links-collapsible-item vector-menu-content-item mw-ui-icon mw-ui-icon-before mw-ui-icon-wikimedia-userAvatar sf-hidden" title="You are encouraged to create an account and log in; however, it is not mandatory"></a></div>
<div class=vector-user-menu-login><a href="https://wiki.archlinux.org/index.php?title=Special:UserLogin&amp;returnto=PCI+passthrough+via+OVMF" icon=logIn class="vector-menu-content-item vector-menu-content-item-login mw-ui-icon mw-ui-icon-before mw-ui-icon-wikimedia-logIn" title="You are encouraged to log in; however, it is not mandatory [alt-shift-o]" accesskey=o><span>Log in</span></a></div>
<div class=vector-user-menu-anon-editor>
 <p>
 Pages for logged out editors <a href=https://wiki.archlinux.org/title/Help:Introduction aria-label="Learn more about editing"><span>learn more</span></a>
 </p>
</div>
 <ul class=vector-menu-content-list></ul>
 
 </div>
</nav>
</div>
</header>
<div class=mw-workspace-container>
 <div id=mw-navigation>
 <h2>Navigation menu</h2>
 
<div id=mw-panel class=mw-sidebar>
 <nav id=p-navigation class="mw-portlet mw-portlet-navigation vector-menu vector-menu-portal portal" aria-labelledby=p-navigation-label role=navigation>
 <h3 id=p-navigation-label class="vector-menu-heading sf-hidden"> 
 </h3>
 <div class=vector-menu-content>
 
 <ul class=vector-menu-content-list><li id=n-mainpage-description class=mw-list-item><a href=https://wiki.archlinux.org/title/Main_page title="Visit the main page [alt-shift-z]" accesskey=z><span>Main page</span></a><li id=n-Table-of-contents class=mw-list-item><a href=https://wiki.archlinux.org/title/Table_of_contents><span>Table of contents</span></a><li id=n-portal class=mw-list-item><a href=https://wiki.archlinux.org/title/Getting_involved title="Various ways Archers can contribute to the community"><span>Getting involved</span></a><li id=n-currentevents class=mw-list-item><a href=https://wiki.archlinux.org/title/ArchWiki:News title="The latest lowdown on the wiki"><span>Wiki news</span></a><li id=n-randompage class=mw-list-item><a href=https://wiki.archlinux.org/title/Special:Random title="Load a random page [alt-shift-x]" accesskey=x><span>Random page</span></a></ul>
 
 </div>
</nav>
 <nav id=p-Interaction class="mw-portlet mw-portlet-Interaction vector-menu vector-menu-portal portal" aria-labelledby=p-Interaction-label role=navigation>
 <h3 id=p-Interaction-label class=vector-menu-heading> <span>Interaction</span>
 </h3>
 <div class=vector-menu-content>
 
 <ul class=vector-menu-content-list><li id=n-help class=mw-list-item><a href=https://wiki.archlinux.org/title/Category:Help title="Wiki navigation, reading, and editing help"><span>Help</span></a><li id=n-Contributing class=mw-list-item><a href=https://wiki.archlinux.org/title/ArchWiki:Contributing><span>Contributing</span></a><li id=n-recentchanges class=mw-list-item><a href=https://wiki.archlinux.org/title/Special:RecentChanges title="A list of recent changes in the wiki [alt-shift-r]" accesskey=r><span>Recent changes</span></a><li id=n-Recent-talks class=mw-list-item><a href="https://wiki.archlinux.org/index.php?title=Special:RecentChanges&amp;namespace=all-discussions" rel=nofollow><span>Recent talks</span></a><li id=n-newpages class=mw-list-item><a href=https://wiki.archlinux.org/title/Special:NewPages><span>New pages</span></a><li id=n-Statistics class=mw-list-item><a href=https://wiki.archlinux.org/title/ArchWiki:Statistics><span>Statistics</span></a><li id=n-Requests class=mw-list-item><a href=https://wiki.archlinux.org/title/ArchWiki_talk:Requests><span>Requests</span></a></ul>
 
 </div>
</nav>
<nav id=p-tb class="mw-portlet mw-portlet-tb vector-menu vector-menu-portal portal" aria-labelledby=p-tb-label role=navigation>
 <h3 id=p-tb-label class=vector-menu-heading> <span>Tools</span>
 </h3>
 <div class=vector-menu-content>
 
 <ul class=vector-menu-content-list><li id=t-whatlinkshere class=mw-list-item><a href=https://wiki.archlinux.org/title/Special:WhatLinksHere/PCI_passthrough_via_OVMF title="A list of all wiki pages that link here [alt-shift-j]" accesskey=j><span>What links here</span></a><li id=t-recentchangeslinked class=mw-list-item><a href=https://wiki.archlinux.org/title/Special:RecentChangesLinked/PCI_passthrough_via_OVMF rel=nofollow title="Recent changes in pages linked from this page [alt-shift-k]" accesskey=k><span>Related changes</span></a><li id=t-specialpages class=mw-list-item><a href=https://wiki.archlinux.org/title/Special:SpecialPages title="A list of all special pages [alt-shift-q]" accesskey=q><span>Special pages</span></a><li id=t-print class=mw-list-item><a href=https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF rel=alternate title="Printable version of this page [alt-shift-p]" accesskey=p><span>Printable version</span></a><li id=t-permalink class=mw-list-item><a href="https://wiki.archlinux.org/index.php?title=PCI_passthrough_via_OVMF&amp;oldid=724650" title="Permanent link to this revision of the page"><span>Permanent link</span></a><li id=t-info class=mw-list-item><a href="https://wiki.archlinux.org/index.php?title=PCI_passthrough_via_OVMF&amp;action=info" title="More information about this page"><span>Page information</span></a></ul>
 
 </div>
</nav>
 <nav id=p-lang class="mw-portlet mw-portlet-lang vector-menu vector-menu-portal portal" aria-labelledby=p-lang-label role=navigation>
 <h3 id=p-lang-label class=vector-menu-heading> <span>In other languages</span>
 </h3>
 <div class=vector-menu-content>
 
 <ul class=vector-menu-content-list><li class="interlanguage-link interwiki-ja mw-list-item"><a href=https://wiki.archlinux.jp/index.php/OVMF_%E3%81%AB%E3%82%88%E3%82%8B_PCI_%E3%83%91%E3%82%B9%E3%82%B9%E3%83%AB%E3%83%BC title="OVMF  PCI   " lang=ja hreflang=ja class=interlanguage-link-target><span></span></a><li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href=https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87) title="PCI passthrough via OVMF  " lang=zh-Hans hreflang=zh-Hans class=interlanguage-link-target><span></span></a></ul>
 
 </div>
</nav>
</div>
 <div id=mw-head>
 <div class=mw-article-toolbar-container>
 <div id=left-navigation>
 <nav id=p-namespaces class="mw-portlet mw-portlet-namespaces vector-menu vector-menu-tabs" aria-labelledby=p-namespaces-label role=navigation>
 <h3 id=p-namespaces-label class="vector-menu-heading sf-hidden"> 
 </h3>
 <div class=vector-menu-content>
 
 <ul class=vector-menu-content-list><li id=ca-nstab-main class="selected mw-list-item"><a href=https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF title="View the content page [alt-shift-c]" accesskey=c><span>Page</span></a><li id=ca-talk class=mw-list-item><a href=https://wiki.archlinux.org/title/Talk:PCI_passthrough_via_OVMF rel=discussion title="Discussion about the content page [alt-shift-t]" accesskey=t><span>Discussion</span></a></ul>
 
 </div>
</nav>
 <nav id=p-variants class="mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown-noicon vector-menu vector-menu-dropdown sf-hidden" aria-labelledby=p-variants-label role=navigation>
 
 
 
</nav>
 </div>
 <div id=right-navigation>
 <nav id=p-views class="mw-portlet mw-portlet-views vector-menu vector-menu-tabs" aria-labelledby=p-views-label role=navigation>
 <h3 id=p-views-label class="vector-menu-heading sf-hidden"> 
 </h3>
 <div class=vector-menu-content>
 
 <ul class=vector-menu-content-list><li id=ca-view class="selected mw-list-item collapsible"><a href=https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF><span>Read</span></a><li id=ca-viewsource class="mw-list-item collapsible"><a href="https://wiki.archlinux.org/index.php?title=PCI_passthrough_via_OVMF&amp;action=edit" title="This page is protected.
You can view its source [alt-shift-e]" accesskey=e><span>View source</span></a><li id=ca-history class="mw-list-item collapsible"><a href="https://wiki.archlinux.org/index.php?title=PCI_passthrough_via_OVMF&amp;action=history" title="Past revisions of this page [alt-shift-h]" accesskey=h><span>View history</span></a></ul>
 
 </div>
</nav>
 <nav id=p-cactions class="mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown-noicon vector-menu vector-menu-dropdown sf-hidden" aria-labelledby=p-cactions-label role=navigation title="More options">
 
 
 
</nav>
 </div>
 </div>
 </div>
 </div>
 <div class=mw-content-container>
<main id=content class=mw-body role=main>
 <a id=top></a>
 <div id=siteNotice></div>
 <div class=mw-indicators>
 </div>
 <h1 id=firstHeading class=firstHeading>PCI passthrough via OVMF</h1>
 <div id=bodyContent class=vector-body>
 <div id=siteSub class="noprint sf-hidden">From ArchWiki</div>
 <div id=contentSub></div>
 <div id=contentSub2></div>
 
 <div id=mw-content-text class="mw-body-content mw-content-ltr" lang=en dir=ltr><div class=mw-parser-output><div class=archwiki-template-meta-related-articles-start><p>Related articles<ul>
<li><a href=https://wiki.archlinux.org/title/Intel_GVT-g title="Intel GVT-g">Intel GVT-g</a></li>
<li><a href=https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF/Examples title="PCI passthrough via OVMF/Examples">PCI passthrough via OVMF/Examples</a></li>
</ul></div>
<p>The Open Virtual Machine Firmware (<a rel=nofollow class="external text" href=https://github.com/tianocore/tianocore.github.io/wiki/OVMF>OVMF</a>) is a project to enable UEFI support for virtual machines. Starting with Linux 3.9 and recent versions of <a href=https://wiki.archlinux.org/title/QEMU title=QEMU>QEMU</a>, it is now possible to passthrough a graphics card, offering the virtual machine native graphics performance which is useful for graphic-intensive tasks.
<p>Provided you have a desktop computer with a spare GPU you can dedicate to the host (be it an integrated GPU or an old OEM card, the brands do not even need to match) and that your hardware supports it (see <a href=#Prerequisites>#Prerequisites</a>), it is possible to have a virtual machine of any OS with its own dedicated GPU and near-native performance. For more information on techniques see the background <a rel=nofollow class="external text" href=https://www.linux-kvm.org/images/b/b3/01x09b-VFIOandYou-small.pdf>presentation (pdf)</a>.
</p>
<div id=toc class=toc role=navigation aria-labelledby=mw-toc-heading><input type=checkbox role=button id=toctogglecheckbox class=toctogglecheckbox style=display:none><div class=toctitle lang=en dir=ltr><h2 id=mw-toc-heading>Contents</h2><span class=toctogglespan><label class=toctogglelabel for=toctogglecheckbox></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href=#Prerequisites><span class=tocnumber>1</span> <span class=toctext>Prerequisites</span></a></li>
<li class="toclevel-1 tocsection-2"><a href=#Setting_up_IOMMU><span class=tocnumber>2</span> <span class=toctext>Setting up IOMMU</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href=#Enabling_IOMMU><span class=tocnumber>2.1</span> <span class=toctext>Enabling IOMMU</span></a></li>
<li class="toclevel-2 tocsection-4"><a href=#Ensuring_that_the_groups_are_valid><span class=tocnumber>2.2</span> <span class=toctext>Ensuring that the groups are valid</span></a></li>
<li class="toclevel-2 tocsection-5"><a href=#Gotchas><span class=tocnumber>2.3</span> <span class=toctext>Gotchas</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href=#Plugging_your_guest_GPU_in_an_unisolated_CPU-based_PCIe_slot><span class=tocnumber>2.3.1</span> <span class=toctext>Plugging your guest GPU in an unisolated CPU-based PCIe slot</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href=#Isolating_the_GPU><span class=tocnumber>3</span> <span class=toctext>Isolating the GPU</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href=#Binding_vfio-pci_via_device_ID><span class=tocnumber>3.1</span> <span class=toctext>Binding vfio-pci via device ID</span></a></li>
<li class="toclevel-2 tocsection-9"><a href=#Loading_vfio-pci_early><span class=tocnumber>3.2</span> <span class=toctext>Loading vfio-pci early</span></a>
<ul>
<li class="toclevel-3 tocsection-10"><a href=#mkinitcpio><span class=tocnumber>3.2.1</span> <span class=toctext>mkinitcpio</span></a></li>
<li class="toclevel-3 tocsection-11"><a href=#booster><span class=tocnumber>3.2.2</span> <span class=toctext>booster</span></a></li>
<li class="toclevel-3 tocsection-12"><a href=#dracut><span class=tocnumber>3.2.3</span> <span class=toctext>dracut</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-13"><a href=#Verifying_that_the_configuration_worked><span class=tocnumber>3.3</span> <span class=toctext>Verifying that the configuration worked</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14"><a href=#Setting_up_an_OVMF-based_guest_virtual_machine><span class=tocnumber>4</span> <span class=toctext>Setting up an OVMF-based guest virtual machine</span></a>
<ul>
<li class="toclevel-2 tocsection-15"><a href=#Configuring_libvirt><span class=tocnumber>4.1</span> <span class=toctext>Configuring libvirt</span></a></li>
<li class="toclevel-2 tocsection-16"><a href=#Setting_up_the_guest_OS><span class=tocnumber>4.2</span> <span class=toctext>Setting up the guest OS</span></a></li>
<li class="toclevel-2 tocsection-17"><a href=#Attaching_the_PCI_devices><span class=tocnumber>4.3</span> <span class=toctext>Attaching the PCI devices</span></a></li>
<li class="toclevel-2 tocsection-18"><a href=#Video_card_driver_virtualisation_detection><span class=tocnumber>4.4</span> <span class=toctext>Video card driver virtualisation detection</span></a></li>
<li class="toclevel-2 tocsection-19"><a href=#Passing_keyboard/mouse_via_Evdev><span class=tocnumber>4.5</span> <span class=toctext>Passing keyboard/mouse via Evdev</span></a></li>
<li class="toclevel-2 tocsection-20"><a href=#Gotchas_2><span class=tocnumber>4.6</span> <span class=toctext>Gotchas</span></a>
<ul>
<li class="toclevel-3 tocsection-21"><a href=#Using_a_non-EFI_image_on_an_OVMF-based_virtual_machine><span class=tocnumber>4.6.1</span> <span class=toctext>Using a non-EFI image on an OVMF-based virtual machine</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-22"><a href=#Performance_tuning><span class=tocnumber>5</span> <span class=toctext>Performance tuning</span></a>
<ul>
<li class="toclevel-2 tocsection-23"><a href=#CPU_pinning><span class=tocnumber>5.1</span> <span class=toctext>CPU pinning</span></a>
<ul>
<li class="toclevel-3 tocsection-24"><a href=#CPU_topology><span class=tocnumber>5.1.1</span> <span class=toctext>CPU topology</span></a></li>
<li class="toclevel-3 tocsection-25"><a href=#XML_examples><span class=tocnumber>5.1.2</span> <span class=toctext>XML examples</span></a>
<ul>
<li class="toclevel-4 tocsection-26"><a href=#4c/1t_CPU_w/o_Hyperthreading_Example><span class=tocnumber>5.1.2.1</span> <span class=toctext>4c/1t CPU w/o Hyperthreading Example</span></a></li>
<li class="toclevel-4 tocsection-27"><a href=#4c/2t_Intel/AMD_CPU_example_(after_ComboPI_AGESA_bios_update)><span class=tocnumber>5.1.2.2</span> <span class=toctext>4c/2t Intel/AMD CPU example (after ComboPI AGESA bios update)</span></a></li>
<li class="toclevel-4 tocsection-28"><a href=#4c/2t_AMD_CPU_example_(Before_ComboPi_AGESA_bios_update)><span class=tocnumber>5.1.2.3</span> <span class=toctext>4c/2t AMD CPU example (Before ComboPi AGESA bios update)</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-29"><a href=#Huge_memory_pages><span class=tocnumber>5.2</span> <span class=toctext>Huge memory pages</span></a>
<ul>
<li class="toclevel-3 tocsection-30"><a href=#Transparent_huge_pages><span class=tocnumber>5.2.1</span> <span class=toctext>Transparent huge pages</span></a></li>
<li class="toclevel-3 tocsection-31"><a href=#Static_huge_pages><span class=tocnumber>5.2.2</span> <span class=toctext>Static huge pages</span></a></li>
<li class="toclevel-3 tocsection-32"><a href=#Dynamic_huge_pages><span class=tocnumber>5.2.3</span> <span class=toctext>Dynamic huge pages</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-33"><a href=#CPU_frequency_governor><span class=tocnumber>5.3</span> <span class=toctext>CPU frequency governor</span></a></li>
<li class="toclevel-2 tocsection-34"><a href=#Isolating_pinned_CPUs><span class=tocnumber>5.4</span> <span class=toctext>Isolating pinned CPUs</span></a>
<ul>
<li class="toclevel-3 tocsection-35"><a href=#With_isolcpus_kernel_parameter><span class=tocnumber>5.4.1</span> <span class=toctext>With isolcpus kernel parameter</span></a></li>
<li class="toclevel-3 tocsection-36"><a href=#Dynamically_isolating_CPUs><span class=tocnumber>5.4.2</span> <span class=toctext>Dynamically isolating CPUs</span></a>
<ul>
<li class="toclevel-4 tocsection-37"><a href=#Example_with_systemd><span class=tocnumber>5.4.2.1</span> <span class=toctext>Example with systemd</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-38"><a href=#Improving_performance_on_AMD_CPUs><span class=tocnumber>5.5</span> <span class=toctext>Improving performance on AMD CPUs</span></a></li>
<li class="toclevel-2 tocsection-39"><a href=#Virtio_disk><span class=tocnumber>5.6</span> <span class=toctext>Virtio disk</span></a>
<ul>
<li class="toclevel-3 tocsection-40"><a href=#Drivers><span class=tocnumber>5.6.1</span> <span class=toctext>Drivers</span></a></li>
<li class="toclevel-3 tocsection-41"><a href=#Considerations><span class=tocnumber>5.6.2</span> <span class=toctext>Considerations</span></a></li>
<li class="toclevel-3 tocsection-42"><a href=#IO_threads><span class=tocnumber>5.6.3</span> <span class=toctext>IO threads</span></a></li>
<li class="toclevel-3 tocsection-43"><a href=#Examples_with_libvirt><span class=tocnumber>5.6.4</span> <span class=toctext>Examples with libvirt</span></a></li>
<li class="toclevel-3 tocsection-44"><a href=#Example_with_virt-manager><span class=tocnumber>5.6.5</span> <span class=toctext>Example with virt-manager</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-45"><a href=#Virtio_network><span class=tocnumber>5.7</span> <span class=toctext>Virtio network</span></a></li>
<li class="toclevel-2 tocsection-46"><a href=#Further_tuning><span class=tocnumber>5.8</span> <span class=toctext>Further tuning</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-47"><a href=#Special_procedures><span class=tocnumber>6</span> <span class=toctext>Special procedures</span></a>
<ul>
<li class="toclevel-2 tocsection-48"><a href=#Using_identical_guest_and_host_GPUs><span class=tocnumber>6.1</span> <span class=toctext>Using identical guest and host GPUs</span></a>
<ul>
<li class="toclevel-3 tocsection-49"><a href=#Script_variants><span class=tocnumber>6.1.1</span> <span class=toctext>Script variants</span></a>
<ul>
<li class="toclevel-4 tocsection-50"><a href=#Passthrough_all_GPUs_but_the_boot_GPU><span class=tocnumber>6.1.1.1</span> <span class=toctext>Passthrough all GPUs but the boot GPU</span></a></li>
<li class="toclevel-4 tocsection-51"><a href=#Passthrough_selected_GPU><span class=tocnumber>6.1.1.2</span> <span class=toctext>Passthrough selected GPU</span></a></li>
<li class="toclevel-4 tocsection-52"><a href=#Passthrough_IOMMU_Group_based_of_GPU><span class=tocnumber>6.1.1.3</span> <span class=toctext>Passthrough IOMMU Group based of GPU</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-53"><a href=#Script_installation><span class=tocnumber>6.1.2</span> <span class=toctext>Script installation</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-54"><a href=#Passing_the_boot_GPU_to_the_guest><span class=tocnumber>6.2</span> <span class=toctext>Passing the boot GPU to the guest</span></a></li>
<li class="toclevel-2 tocsection-55"><a href=#Using_Looking_Glass_to_stream_guest_screen_to_the_host><span class=tocnumber>6.3</span> <span class=toctext>Using Looking Glass to stream guest screen to the host</span></a>
<ul>
<li class="toclevel-3 tocsection-56"><a href=#Adding_IVSHMEM_Device_to_virtual_machines><span class=tocnumber>6.3.1</span> <span class=toctext>Adding IVSHMEM Device to virtual machines</span></a></li>
<li class="toclevel-3 tocsection-57"><a href=#Installing_the_IVSHMEM_Host_to_Windows_guest><span class=tocnumber>6.3.2</span> <span class=toctext>Installing the IVSHMEM Host to Windows guest</span></a></li>
<li class="toclevel-3 tocsection-58"><a href=#Setting_up_the_null_video_device><span class=tocnumber>6.3.3</span> <span class=toctext>Setting up the null video device</span></a></li>
<li class="toclevel-3 tocsection-59"><a href=#Getting_a_client><span class=tocnumber>6.3.4</span> <span class=toctext>Getting a client</span></a></li>
<li class="toclevel-3 tocsection-60"><a href=#Additional_information><span class=tocnumber>6.3.5</span> <span class=toctext>Additional information</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-61"><a href=#Swap_peripherals_to_and_from_the_Host><span class=tocnumber>6.4</span> <span class=toctext>Swap peripherals to and from the Host</span></a></li>
<li class="toclevel-2 tocsection-62"><a href=#Bypassing_the_IOMMU_groups_(ACS_override_patch)><span class=tocnumber>6.5</span> <span class=toctext>Bypassing the IOMMU groups (ACS override patch)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-63"><a href=#Plain_QEMU_without_libvirt><span class=tocnumber>7</span> <span class=toctext>Plain QEMU without libvirt</span></a></li>
<li class="toclevel-1 tocsection-64"><a href=#Passing_through_other_devices><span class=tocnumber>8</span> <span class=toctext>Passing through other devices</span></a>
<ul>
<li class="toclevel-2 tocsection-65"><a href=#USB_controller><span class=tocnumber>8.1</span> <span class=toctext>USB controller</span></a></li>
<li class="toclevel-2 tocsection-66"><a href=#Passing_audio_from_virtual_machine_to_host_via_PulseAudio><span class=tocnumber>8.2</span> <span class=toctext>Passing audio from virtual machine to host via PulseAudio</span></a></li>
<li class="toclevel-2 tocsection-67"><a href=#Passing_audio_from_virtual_machine_to_host_via_JACK_and_PipeWire><span class=tocnumber>8.3</span> <span class=toctext>Passing audio from virtual machine to host via JACK and PipeWire</span></a></li>
<li class="toclevel-2 tocsection-68"><a href=#Passing_audio_from_virtual_machine_to_host_via_Scream><span class=tocnumber>8.4</span> <span class=toctext>Passing audio from virtual machine to host via Scream</span></a>
<ul>
<li class="toclevel-3 tocsection-69"><a href=#Using_Scream_with_a_bridged_network><span class=tocnumber>8.4.1</span> <span class=toctext>Using Scream with a bridged network</span></a></li>
<li class="toclevel-3 tocsection-70"><a href=#Adding_the_IVSHMEM_device_to_use_Scream_with_IVSHMEM><span class=tocnumber>8.4.2</span> <span class=toctext>Adding the IVSHMEM device to use Scream with IVSHMEM</span></a>
<ul>
<li class="toclevel-4 tocsection-71"><a href=#Configuring_the_Windows_guest_for_IVSHMEM><span class=tocnumber>8.4.2.1</span> <span class=toctext>Configuring the Windows guest for IVSHMEM</span></a>
<ul>
<li class="toclevel-5 tocsection-72"><a href=#Configuring_the_host><span class=tocnumber>8.4.2.1.1</span> <span class=toctext>Configuring the host</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-73"><a href=#Physical_disk/partition><span class=tocnumber>8.5</span> <span class=toctext>Physical disk/partition</span></a></li>
<li class="toclevel-2 tocsection-74"><a href=#Gotchas_3><span class=tocnumber>8.6</span> <span class=toctext>Gotchas</span></a>
<ul>
<li class="toclevel-3 tocsection-75"><a href=#Passing_through_a_device_that_does_not_support_resetting><span class=tocnumber>8.6.1</span> <span class=toctext>Passing through a device that does not support resetting</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-76"><a href=#Complete_setups_and_examples><span class=tocnumber>9</span> <span class=toctext>Complete setups and examples</span></a></li>
<li class="toclevel-1 tocsection-77"><a href=#Troubleshooting><span class=tocnumber>10</span> <span class=toctext>Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-78"><a href=#QEMU_4.0:_Unable_to_load_graphics_drivers/BSOD/Graphics_stutter_after_driver_install_using_Q35><span class=tocnumber>10.1</span> <span class=toctext>QEMU 4.0: Unable to load graphics drivers/BSOD/Graphics stutter after driver install using Q35</span></a></li>
<li class="toclevel-2 tocsection-79"><a href="#QEMU_5.0:_host-passthrough_with_kernel_version_5.5_to_5.8.1_when_using_Zen_2_processors:_Windows_10_BSOD_loop_'KERNEL_SECURITY_CHECK_FAILURE'"><span class=tocnumber>10.2</span> <span class=toctext>QEMU 5.0: host-passthrough with kernel version 5.5 to 5.8.1 when using Zen 2 processors: Windows 10 BSOD loop 'KERNEL SECURITY CHECK FAILURE'</span></a></li>
<li class="toclevel-2 tocsection-80"><a href=#%22Error_43:_Driver_failed_to_load%22_with_mobile_(Optimus/max-q)_nvidia_GPUs><span class=tocnumber>10.3</span> <span class=toctext>"Error 43: Driver failed to load" with mobile (Optimus/max-q) nvidia GPUs</span></a></li>
<li class="toclevel-2 tocsection-81"><a href=#%22BAR_3:_cannot_reserve_[mem]%22_error_in_dmesg_after_starting_virtual_machine><span class=tocnumber>10.4</span> <span class=toctext>"BAR 3: cannot reserve [mem]" error in dmesg after starting virtual machine</span></a></li>
<li class="toclevel-2 tocsection-82"><a href=#UEFI_(OVMF)_compatibility_in_VBIOS><span class=tocnumber>10.5</span> <span class=toctext>UEFI (OVMF) compatibility in VBIOS</span></a></li>
<li class="toclevel-2 tocsection-83"><a href=#Slowed_down_audio_pumped_through_HDMI_on_the_video_card><span class=tocnumber>10.6</span> <span class=toctext>Slowed down audio pumped through HDMI on the video card</span></a></li>
<li class="toclevel-2 tocsection-84"><a href=#No_HDMI_audio_output_on_host_when_intel_iommu_is_enabled><span class=tocnumber>10.7</span> <span class=toctext>No HDMI audio output on host when intel_iommu is enabled</span></a></li>
<li class="toclevel-2 tocsection-85"><a href=#X_does_not_start_after_enabling_vfio_pci><span class=tocnumber>10.8</span> <span class=toctext>X does not start after enabling vfio_pci</span></a></li>
<li class="toclevel-2 tocsection-86"><a href=#Chromium_ignores_integrated_graphics_for_acceleration><span class=tocnumber>10.9</span> <span class=toctext>Chromium ignores integrated graphics for acceleration</span></a></li>
<li class="toclevel-2 tocsection-87"><a href=#Virtual_machine_only_uses_one_core><span class=tocnumber>10.10</span> <span class=toctext>Virtual machine only uses one core</span></a></li>
<li class="toclevel-2 tocsection-88"><a href=#Passthrough_seems_to_work_but_no_output_is_displayed><span class=tocnumber>10.11</span> <span class=toctext>Passthrough seems to work but no output is displayed</span></a></li>
<li class="toclevel-2 tocsection-89"><a href=#Host_lockup_after_virtual_machine_shutdown><span class=tocnumber>10.12</span> <span class=toctext>Host lockup after virtual machine shutdown</span></a></li>
<li class="toclevel-2 tocsection-90"><a href=#Host_lockup_if_guest_is_left_running_during_sleep><span class=tocnumber>10.13</span> <span class=toctext>Host lockup if guest is left running during sleep</span></a></li>
<li class="toclevel-2 tocsection-91"><a href=#Cannot_boot_after_upgrading_ovmf><span class=tocnumber>10.14</span> <span class=toctext>Cannot boot after upgrading ovmf</span></a></li>
<li class="toclevel-2 tocsection-92"><a href=#Bluescreen_at_boot_since_Windows_10_1803><span class=tocnumber>10.15</span> <span class=toctext>Bluescreen at boot since Windows 10 1803</span></a></li>
<li class="toclevel-2 tocsection-93"><a href=#AMD_Ryzen_/_BIOS_updates_(AGESA)_yields_%22Error:_internal_error:_Unknown_PCI_header_type_%E2%80%98127%E2%80%99%22><span class=tocnumber>10.16</span> <span class=toctext>AMD Ryzen / BIOS updates (AGESA) yields "Error: internal error: Unknown PCI header type 127"</span></a></li>
<li class="toclevel-2 tocsection-94"><a href=#AMD_GPU_not_resetting_properly_yielding_%22Error:_internal_error:_Unknown_PCI_header_type_%E2%80%98127%E2%80%99%22_(Separate_issue_from_the_one_above)><span class=tocnumber>10.17</span> <span class=toctext>AMD GPU not resetting properly yielding "Error: internal error: Unknown PCI header type 127" (Separate issue from the one above)</span></a></li>
<li class="toclevel-2 tocsection-95"><a href=#Host_crashes_when_hotplugging_Nvidia_card_with_USB><span class=tocnumber>10.18</span> <span class=toctext>Host crashes when hotplugging Nvidia card with USB</span></a></li>
<li class="toclevel-2 tocsection-96"><a href=#Host_unable_to_boot_and_stuck_in_black_screen_after_enabling_vfio><span class=tocnumber>10.19</span> <span class=toctext>Host unable to boot and stuck in black screen after enabling vfio</span></a></li>
<li class="toclevel-2 tocsection-97"><a href=#AER_errors_when_passing_through_PCIe_USB_hub><span class=tocnumber>10.20</span> <span class=toctext>AER errors when passing through PCIe USB hub</span></a></li>
<li class="toclevel-2 tocsection-98"><a href=#Reserved_Memory_Region_Reporting_(RMRR)_Conflict><span class=tocnumber>10.21</span> <span class=toctext>Reserved Memory Region Reporting (RMRR) Conflict</span></a></li>
<li class="toclevel-2 tocsection-99"><a href=#Too-low_frequency_limit_for_AMD_GPU_passed-through_to_virtual_machine><span class=tocnumber>10.22</span> <span class=toctext>Too-low frequency limit for AMD GPU passed-through to virtual machine</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-100"><a href=#See_also><span class=tocnumber>11</span> <span class=toctext>See also</span></a></li>
</ul>
</div>
<h2><span class=mw-headline id=Prerequisites>Prerequisites</span></h2>
<p>A VGA Passthrough relies on a number of technologies that are not ubiquitous as of today and might not be available on your hardware. You will not be able to do this on your machine unless the following requirements are met&nbsp;:
</p>
<ul><li>Your CPU must support hardware virtualization (for kvm) and IOMMU (for the passthrough itself)
<ul><li><a rel=nofollow class="external text" href="https://ark.intel.com/Search/FeatureFilter?productType=873&amp;0_VTD=True">List of compatible Intel CPUs (Intel VT-x and Intel VT-d)</a></li>
<li>All AMD CPUs from the Bulldozer generation and up (including Zen) should be compatible.
<ul><li>CPUs from the K10 generation (2007) do not have an IOMMU, so you <b>need</b> to have a motherboard with a <a rel=nofollow class="external text" href="https://support.amd.com/TechDocs/43403.pdf#page=18">890FX</a> or <a rel=nofollow class="external text" href="https://support.amd.com/TechDocs/48691.pdf#page=21">990FX</a> chipset to make it work, as those have their own IOMMU.</ul></ul></li>
<li>Your motherboard must also support IOMMU
<ul><li>Both the chipset and the BIOS must support it. It is not always easy to tell at a glance whether or not this is the case, but there is a fairly comprehensive list on the matter on the <a rel=nofollow class="external text" href=https://wiki.xen.org/wiki/VTd_HowTo>Xen wiki</a> as well as <a href=https://en.wikipedia.org/wiki/List_of_IOMMU-supporting_hardware class=extiw title="wikipedia:List of IOMMU-supporting hardware">Wikipedia:List of IOMMU-supporting hardware</a>.</ul></li>
<li>Your guest GPU ROM must support UEFI.
<ul><li>If you can find <a rel=nofollow class="external text" href=https://www.techpowerup.com/vgabios/>any ROM in this list</a> that applies to your specific GPU and is said to support UEFI, you are generally in the clear. All GPUs from 2012 and later should support this, as Microsoft made UEFI a requirement for devices to be marketed as compatible with Windows 8.</ul></ul>
<p>You will probably want to have a spare monitor or one with multiple input ports connected to different GPUs (the passthrough GPU will not display anything if there is no screen plugged in and using a VNC or Spice connection will not help your performance), as well as a mouse and a keyboard you can pass to your virtual machine. If anything goes wrong, you will at least have a way to control your host machine this way.
</p>
<h2><span class=mw-headline id=Setting_up_IOMMU>Setting up IOMMU</span></h2>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> 
<ul><li>IOMMU is a generic name for Intel VT-d and AMD-Vi.</li>
<li>VT-d stands for <i>Intel Virtualization Technology for Directed I/O</i> and should not be confused with VT-x <i>Intel Virtualization Technology</i>. VT-x allows one hardware platform to function as multiple virtual platforms while VT-d improves security and reliability of the systems and also improves performance of I/O devices in virtualized environments.</ul>
</div>
<p>Using IOMMU opens to features like PCI passthrough and memory protection from faulty or malicious devices, see <a href=https://en.wikipedia.org/wiki/Input-output_memory_management_unit#Advantages class=extiw title="wikipedia:Input-output memory management unit">Wikipedia:Input-output memory management unit#Advantages</a> and <a rel=nofollow class="external text" href=https://www.quora.com/Memory-Management-computer-programming/Could-you-explain-IOMMU-in-plain-English>Memory Management (computer programming): Could you explain IOMMU in plain English?</a>.
</p>
<h3><span class=mw-headline id=Enabling_IOMMU>Enabling IOMMU</span></h3>
<p>Ensure that AMD-Vi/Intel VT-d is supported by the CPU and enabled in the BIOS settings. Both normally show up alongside other CPU features (meaning they could be in an overclocking-related menu) either with their actual names ("VT-d" or "AMD-Vi") or in more ambiguous terms such as "Virtualization technology", which may or may not be explained in the manual.
<p>Manually enable IOMMU support by setting the correct <a href=https://wiki.archlinux.org/title/Kernel_parameter class=mw-redirect title="Kernel parameter">kernel parameter</a> depending on the type of CPU in use:
</p>
<ul><li>For Intel CPUs (VT-d) set <code>intel_iommu=on</code>. Since the kernel config option CONFIG_INTEL_IOMMU_DEFAULT_ON is not set in <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span>.</li>
<li>For AMD CPUs (AMD-Vi), it is on if kernel detects IOMMU hardware support from BIOS.</ul>
<p>You should also append the <code>iommu=pt</code> parameter. This will prevent Linux from touching devices which cannot be passed through.
<p>After rebooting, check <a href=https://wiki.archlinux.org/title/Dmesg class=mw-redirect title=Dmesg>dmesg</a> to confirm that IOMMU has been correctly enabled:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em># dmesg | grep -i -e DMAR -e IOMMU</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>[    0.000000] ACPI: DMAR 0x00000000BDCB1CB0 0000B8 (v01 INTEL  BDW      00000001 INTL 00000001)
[    0.000000] Intel-IOMMU: enabled
[    0.028879] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c0000020660462 ecap f0101a
[    0.028883] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap d2008c20660462 ecap f010da
[    0.028950] IOAPIC id 8 under DRHD base  0xfed91000 IOMMU 1
[    0.536212] DMAR: No ATSR found
[    0.536229] IOMMU 0 0xfed90000: using Queued invalidation
[    0.536230] IOMMU 1 0xfed91000: using Queued invalidation
[    0.536231] IOMMU: Setting RMRR:
[    0.536241] IOMMU: Setting identity map for device 0000:00:02.0 [0xbf000000 - 0xcf1fffff]
[    0.537490] IOMMU: Setting identity map for device 0000:00:14.0 [0xbdea8000 - 0xbdeb6fff]
[    0.537512] IOMMU: Setting identity map for device 0000:00:1a.0 [0xbdea8000 - 0xbdeb6fff]
[    0.537530] IOMMU: Setting identity map for device 0000:00:1d.0 [0xbdea8000 - 0xbdeb6fff]
[    0.537543] IOMMU: Prepare 0-16MiB unity mapping for LPC
[    0.537549] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff]
[    2.182790] [drm] DMAR active, disabling use of stolen memory
</pre>
<h3><span class=mw-headline id=Ensuring_that_the_groups_are_valid>Ensuring that the groups are valid</span></h3>
<p>The following script should allow you to see how your various PCI devices are mapped to IOMMU groups. If it does not return anything, you either have not enabled IOMMU support properly or your hardware does not support it.
</p>
<pre>#!/bin/bash
shopt -s nullglob
for g in $(find /sys/kernel/iommu_groups/* -maxdepth 0 -type d | sort -V); do
    echo "IOMMU Group ${g##*/}:"
    for d in $g/devices/*; do
        echo -e "\t$(lspci -nns ${d##*/})"
    done;
done;
</pre>
<p>Example output:
</p>
<pre>IOMMU Group 1:
	00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor PCI Express Root Port [8086:0151] (rev 09)
IOMMU Group 2:
	00:14.0 USB controller: Intel Corporation 7 Series/C210 Series Chipset Family USB xHCI Host Controller [8086:0e31] (rev 04)
IOMMU Group 4:
	00:1a.0 USB controller: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #2 [8086:0e2d] (rev 04)
IOMMU Group 10:
	00:1d.0 USB controller: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #1 [8086:0e26] (rev 04)
IOMMU Group 13:
	06:00.0 VGA compatible controller: NVIDIA Corporation GM204 [GeForce GTX 970] [10de:13c2] (rev a1)
	06:00.1 Audio device: NVIDIA Corporation GM204 High Definition Audio Controller [10de:0fbb] (rev a1)
</pre>
<p>An IOMMU group is the smallest set of physical devices that can be passed to a virtual machine. For instance, in the example above, both the GPU in 06:00.0 and its audio controller in 6:00.1 belong to IOMMU group 13 and can only be passed together. The frontal USB controller, however, has its own group (group 2) which is separate from both the USB expansion controller (group 10) and the rear USB controller (group 4), meaning that <a href=#USB_controller>any of them could be passed to a virtual machine without affecting the others</a>.
</p>
<h3><span class=mw-headline id=Gotchas>Gotchas</span></h3>
<h4><span class=mw-headline id=Plugging_your_guest_GPU_in_an_unisolated_CPU-based_PCIe_slot>Plugging your guest GPU in an unisolated CPU-based PCIe slot</span></h4>
<p>Not all PCI-E slots are the same. Most motherboards have PCIe slots provided by both the CPU and the PCH. Depending on your CPU, it is possible that your processor-based PCIe slot does not support isolation properly, in which case the PCI slot itself will appear to be grouped with the device that is connected to it.
</p>
<pre>IOMMU Group 1:
	 00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor PCI Express Root Port (rev 09)
	 01:00.0 VGA compatible controller: NVIDIA Corporation GM107 [GeForce GTX 750] (rev a2)
	 01:00.1 Audio device: NVIDIA Corporation Device 0fbc (rev a1)
</pre>
<p>This is fine so long as only your guest GPU is included in here, such as above. Depending on what is plugged in to your other PCIe slots and whether they are allocated to your CPU or your PCH, you may find yourself with additional devices within the same group, which would force you to pass those as well. If you are ok with passing everything that is in there to your virtual machine, you are free to continue. Otherwise, you will either need to try and plug your GPU in your other PCIe slots (if you have any) and see if those provide isolation from the rest or to install the ACS override patch, which comes with its own drawbacks. See <a href=#Bypassing_the_IOMMU_groups_(ACS_override_patch)>#Bypassing the IOMMU groups (ACS override patch)</a> for more information.
</p>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> If they are grouped with other devices in this manner, pci root ports and bridges should neither be bound to vfio at boot, nor be added to the virtual machine.</div>
<h2><span class=mw-headline id=Isolating_the_GPU>Isolating the GPU</span></h2>
<p>In order to assign a device to a virtual machine, this device and all those sharing the same IOMMU group must have their driver replaced by a stub driver or a VFIO driver in order to prevent the host machine from interacting with them. In the case of most devices, this can be done on the fly right before the virtual machine starts.
<p>However, due to their size and complexity, GPU drivers do not tend to support dynamic rebinding very well, so you cannot just have some GPU you use on the host be transparently passed to a virtual machine without having both drivers conflict with each other. Because of this, it is generally advised to bind those placeholder drivers manually before starting the virtual machine, in order to stop other drivers from attempting to claim it.
<p>The following section details how to configure a GPU so those placeholder drivers are bound early during the boot process, which makes said device inactive until a virtual machine claims it or the driver is switched back. This is the preferred method, considering it has less caveats than switching drivers once the system is fully online.
</p>
<div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning:</strong> Once you reboot after this procedure, whatever GPU you have configured will no longer be usable on the host until you reverse the manipulation. Make sure the GPU you intend to use on the host is properly configured before doing this - your motherboard should be set to display using the host GPU.</div>
<p>Starting with Linux 4.1, the kernel includes vfio-pci. This is a VFIO driver, meaning it fulfills the same role as pci-stub did, but it can also control devices to an extent, such as by switching them into their D3 state when they are not in use.
</p>
<h3><span class=mw-headline id=Binding_vfio-pci_via_device_ID>Binding vfio-pci via device ID</span></h3>
<p>Vfio-pci normally targets PCI devices by ID, meaning you only need to specify the IDs of the devices you intend to passthrough. For the following IOMMU group, you would want to bind vfio-pci with <code>10de:13c2</code> and <code>10de:0fbb</code>, which will be used as example values for the rest of this section.
</p>
<pre>IOMMU Group 13:
	 06:00.0 VGA compatible controller: NVIDIA Corporation GM204 [GeForce GTX 970] [10de:13c2] (rev a1)
	 06:00.1 Audio device: NVIDIA Corporation GM204 High Definition Audio Controller [10de:0fbb] (rev a1)}}
</pre>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> 
<ul><li>You cannot specify which device to isolate using vendor-device ID pairs if the host GPU and the guest GPU share the same pair (i.e&nbsp;: if both are the same model). If this is your case, read <a href=#Using_identical_guest_and_host_GPUs>#Using identical guest and host GPUs</a> instead.</li>
<li>If, as noted in <a href=#Plugging_your_guest_GPU_in_an_unisolated_CPU-based_PCIe_slot>#Plugging your guest GPU in an unisolated CPU-based PCIe slot</a>, your pci root port is part of your IOMMU group, you <b>must not</b> pass its ID to <code>vfio-pci</code>, as it needs to remain attached to the host to function properly. Any other device within that group, however, should be left for <code>vfio-pci</code> to bind with.</li>
<li>Binding the audio device (<code>10de:0fbb</code> in above's example) is optional. Libvirt is able to unbind it from the <code>snd_hda_intel</code> driver on its own.</ul>
</div>
<p>Two methods exist for providing the device IDs. Specifying them via <a href=https://wiki.archlinux.org/title/Kernel_parameters title="Kernel parameters">kernel parameters</a> has the advantage of being able to easily edit, remove, or undo any breaking changes via your boot loader:
</p>
<pre>vfio-pci.ids=10de:13c2,10de:0fbb
</pre>
<p>Alternatively, the IDs may be added to a modprobe conf file. Since these conf files are embedded in the initramfs image, any changes require regenerating a new image each time:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>/etc/modprobe.d/vfio.conf</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>options vfio-pci ids=10de:13c2,10de:0fbb</pre>
<h3><span class=mw-headline id=Loading_vfio-pci_early>Loading vfio-pci early</span></h3>
<h4><span class=mw-headline id=mkinitcpio>mkinitcpio</span></h4>
<p>Since Arch's <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> has vfio-pci built as a module, we need to force it to load early before the graphics drivers have a chance to bind to the card. To ensure that, add <code>vfio_pci</code>, <code>vfio</code>, <code>vfio_iommu_type1</code>, and <code>vfio_virqfd</code> to <a href=https://wiki.archlinux.org/title/Mkinitcpio title=Mkinitcpio>mkinitcpio</a>:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>/etc/mkinitcpio.conf</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>MODULES=(... vfio_pci vfio vfio_iommu_type1 vfio_virqfd ...)</pre>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> 
<ul><li>If you also have another driver loaded this way for <a href=https://wiki.archlinux.org/title/Kernel_mode_setting#Early_KMS_start title="Kernel mode setting">early modesetting</a> (such as <code>nouveau</code>, <code>radeon</code>, <code>amdgpu</code>, <code>i915</code>, etc.), all of the aforementioned VFIO modules must precede it.</li>
<li>If you are modesetting the <code>nvidia</code> driver, the <code>vfio-pci.ids</code> must be embedded in the initramfs image. If given via kernel arguments, they will be read too late to take effect. Follow the instructions in <a href=#Binding_vfio-pci_via_device_ID>#Binding vfio-pci via device ID</a> for adding the ids to a modprobe conf file.</ul>
</div>
<p>Also, ensure that the modconf hook is included in the HOOKS list of <code>mkinitcpio.conf</code>:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>/etc/mkinitcpio.conf</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>HOOKS=(... modconf ...)</pre>
<p>Since new modules have been added to the initramfs configuration, you must <a href=https://wiki.archlinux.org/title/Regenerate_the_initramfs class=mw-redirect title="Regenerate the initramfs">regenerate the initramfs</a>.
</p>
<h4><span class=mw-headline id=booster>booster</span></h4>
<p>Similar to mkinitcpio you need to specify modules to load early:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>/etc/booster.yaml</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>modules_force_load: vfio_pci,vfio,vfio_iommu_type1,vfio_virqfd</pre>
<p>and then <a href=https://wiki.archlinux.org/title/Booster#Regenerate_booster_images title=Booster>regenerate the initramfs</a>.
</p>
<h4><span class=mw-headline id=dracut>dracut</span></h4>
<p>dracut's early loading mechanism is configured via kernel parameters. To load vfio-pci early, add both the <a href=#Binding_vfio-pci_via_device_ID>device ids</a> and the following line to your <a href=https://wiki.archlinux.org/title/Kernel_parameters title="Kernel parameters">kernel parameters</a>:
</p>
<pre>rd.driver.pre=vfio_pci
</pre>
<p>We also need to add all the vfio drivers to the initramfs. Add the following file to <code>/etc/dracut.conf.d</code>:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>10-vfio.conf</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>add_drivers+=" vfio_pci vfio vfio_iommu_type1 vfio_virqfd "</pre>
<p>As with mkinitcpio, you must regenerate the initramfs. See <a href=https://wiki.archlinux.org/title/Dracut title=Dracut>dracut</a> for more details.
</p>
<h3><span class=mw-headline id=Verifying_that_the_configuration_worked>Verifying that the configuration worked</span></h3>
<p>Reboot and verify that vfio-pci has loaded properly and that it is now bound to the right devices.
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em># dmesg | grep -i vfio</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>[    0.329224] VFIO - User Level meta-driver version: 0.3
[    0.341372] vfio_pci: add [10de:13c2[ffff:ffff]] class 0x000000/00000000
[    0.354704] vfio_pci: add [10de:0fbb[ffff:ffff]] class 0x000000/00000000
[    2.061326] vfio-pci 0000:06:00.0: enabling device (0100 -&gt; 0103)
</pre>
<p>It is not necessary for all devices (or even expected device) from <code>vfio.conf</code> to be in <i>dmesg</i> output.
Even if a device does not appear, it might still be visible and usable in the guest virtual machine.
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ lspci -nnk -d 10de:13c2</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>06:00.0 VGA compatible controller: NVIDIA Corporation GM204 [GeForce GTX 970] [10de:13c2] (rev a1)
	Kernel driver in use: vfio-pci
	Kernel modules: nouveau nvidia
</pre>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ lspci -nnk -d 10de:0fbb</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>06:00.1 Audio device: NVIDIA Corporation GM204 High Definition Audio Controller [10de:0fbb] (rev a1)
	Kernel driver in use: vfio-pci
	Kernel modules: snd_hda_intel
</pre>
<h2><span class=mw-headline id=Setting_up_an_OVMF-based_guest_virtual_machine>Setting up an OVMF-based guest virtual machine</span></h2>
<p>OVMF is an open-source UEFI firmware for QEMU virtual machines. While it is possible to use SeaBIOS to get similar results to an actual PCI passthrough, the setup process is different and it is generally preferable to use the EFI method if your hardware supports it.
</p>
<h3><span class=mw-headline id=Configuring_libvirt>Configuring libvirt</span></h3>
<p><a href=https://wiki.archlinux.org/title/Libvirt title=Libvirt>Libvirt</a> is a wrapper for a number of virtualization utilities that greatly simplifies the configuration and deployment process of virtual machines. In the case of KVM and QEMU, the frontend it provides allows us to avoid dealing with the permissions for QEMU and make it easier to add and remove various devices on a live virtual machine. Its status as a wrapper, however, means that it might not always support all of the latest qemu features, which could end up requiring the use of a wrapper script to provide some extra arguments to QEMU.
</p>
<div class="noprint archwiki-template-message">
<p><a href=https://wiki.archlinux.org/title/File:Tango-inaccurate.png class=image><img alt=Tango-inaccurate.png src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"><rect fill-opacity="0"/></svg>' decoding=async width=48 height=48 style="background-blend-mode:normal!important;background-clip:content-box!important;background-position:50% 50%!important;background-color:rgba(0,0,0,0)!important;background-image:var(--sf-img-13)!important;background-size:100% 100%!important;background-origin:content-box!important;background-repeat:no-repeat!important"></a><b>The factual accuracy of this article or section is disputed.</b><a href=https://wiki.archlinux.org/title/File:Tango-inaccurate.png class=image><img alt=Tango-inaccurate.png src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"><rect fill-opacity="0"/></svg>' decoding=async width=48 height=48 style="background-blend-mode:normal!important;background-clip:content-box!important;background-position:50% 50%!important;background-color:rgba(0,0,0,0)!important;background-image:var(--sf-img-13)!important;background-size:100% 100%!important;background-origin:content-box!important;background-repeat:no-repeat!important"></a></p>
<div><b>Reason:</b> <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=libvirt">libvirt</a></span> depends on <i>ebtables</i>, not <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=iptables-nft">iptables-nft</a></span> which is just a translation layer. (Discuss in <a rel=nofollow class="external text" href=https://wiki.archlinux.org/title/Talk:PCI_passthrough_via_OVMF>Talk:PCI passthrough via OVMF</a>)</div>
</div>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=qemu">qemu</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=libvirt">libvirt</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=edk2-ovmf">edk2-ovmf</a></span>, and <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=virt-manager">virt-manager</a></span>. For the default network connection, <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=iptables-nft">iptables-nft</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=dnsmasq">dnsmasq</a></span> are required.
<p>You can now <a href=https://wiki.archlinux.org/title/Enable class=mw-redirect title=Enable>enable</a> and <a href=https://wiki.archlinux.org/title/Start class=mw-redirect title=Start>start</a> <code>libvirtd.service</code> and its logging component <code>virtlogd.socket</code>.
<p>You may also need to <a rel=nofollow class="external text" href=https://wiki.libvirt.org/page/Networking#NAT_forwarding_.28aka_.22virtual_networks.22.29>activate the default libvirt network</a>:
</p>
<pre># virsh net-autostart default
# virsh net-start default
</pre>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> The default libvirt network will only be listed if the virsh command is run as root.</div>
<h3><span class=mw-headline id=Setting_up_the_guest_OS>Setting up the guest OS</span></h3>
<p>The process of setting up a virtual machine using <code>virt-manager</code> is mostly self-explanatory, as most of the process comes with fairly comprehensive on-screen instructions.
<p>However, you should pay special attention to the following steps:
</p>
<ul><li>When the virtual machine creation wizard asks you to name your virtual machine (final step before clicking "Finish"), check the "Customize before install" checkbox.</li>
<li>In the "Overview" section, <a rel=nofollow class="external text" href=https://i.imgur.com/73r2ctM.png>set your firmware to "UEFI"</a>. If the option is grayed out, make sure that:
<ul><li>Your hypervisor is running as a system session and not a user session. This can be verified <a rel=nofollow class="external text" href=https://i.ibb.co/N1XZCdp/Deepin-Screenshot-select-area-20190125113216.png>by clicking, then hovering</a> over the session in virt-manager. If you are accidentally running it as a user session, you must open a new connection by clicking "File" &gt; "Add Connection..", then select the option from the drop-down menu station "QEMU/KVM" and not "QEMU/KVM user session".</ul></li>
<li>In the "CPUs" section, change your CPU model to "host-passthrough". If it is not in the list, you will have to either type it by hand or by using <code>virt-xml <i>vmname</i> --edit --cpu host-passthrough</code>. This will ensure that your CPU is detected properly, since it causes libvirt to expose your CPU capabilities exactly as they are instead of only those it recognizes (which is the preferred default behavior to make CPU behavior easier to reproduce). Without it, some applications may complain about your CPU being of an unknown model.</li>
<li>If you want to minimize IO overhead, it is easier to setup <a href=#Virtio_disk>#Virtio disk</a> before installing</ul>
<p>The rest of the installation process will take place as normal using a standard QXL video adapter running in a window. At this point, there is no need to install additional drivers for the rest of the virtual devices, since most of them will be removed later on. Once the guest OS is done installing, simply turn off the virtual machine. It is possible you will be dropped into the UEFI menu instead of starting the installation upon powering your virtual machine for the first time. Sometimes the correct ISO file was not automatically detected and you will need to manually specify the drive to boot. By typing exit and navigating to "boot manager" you will enter a menu that allows you to choose between devices.
</p>
<h3><span class=mw-headline id=Attaching_the_PCI_devices>Attaching the PCI devices</span></h3>
<p>With the installation done, it is now possible to edit the hardware details in libvirt and remove virtual integration devices, such as the spice channel and virtual display, the QXL video adapter, the emulated mouse and keyboard and the USB tablet device. For example, remove the following sections from your XML file:
</p>
<pre>    &lt;channel type="spicevmc"&gt;
      ...
    &lt;/channel&gt;
    &lt;input type="tablet" bus="usb"&gt;
      ...
    &lt;/input&gt;
    &lt;input type="mouse" bus="ps2"/&gt;
    &lt;input type="keyboard" bus="ps2"/&gt;
    &lt;graphics type="spice" autoport="yes"&gt;
      ...
    &lt;/graphics&gt;
    &lt;video&gt;
      &lt;model type="qxl" .../&gt;
      ...
    &lt;/video&gt;</pre>
<p>Since that leaves you with no input devices, you may want to bind a few USB host devices to your virtual machine as well, but remember to <b>leave at least one mouse and/or keyboard assigned to your host</b> in case something goes wrong with the guest. This may be done by using <code>Add Hardware &gt; USB Host Device</code>.
<p>At this point, it also becomes possible to attach the PCI device that was isolated earlier; simply click on "Add Hardware" and select the PCI Host Devices you want to passthrough. If everything went well, the screen plugged into your GPU should show the OVMF splash screen and your virtual machine should start up normally. From there, you can setup the drivers for the rest of your virtual machine.
</p>
<h3><span class=mw-headline id=Video_card_driver_virtualisation_detection>Video card driver virtualisation detection</span></h3>
<p>Video card drivers by AMD incorporate very basic virtual machine detection targeting Hyper-V extensions. Should this detection mechanism trigger, the drivers will refuse to run, resulting in a black screen.
<p>If this is the case, it is required to modify the reported Hyper-V vendor ID:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>...
&lt;features&gt;
  ...
  &lt;hyperv&gt;
    ...
    &lt;vendor_id state='on' value='randomid'/&gt;
    ...
  &lt;/hyperv&gt;
  ...
&lt;/features&gt;
...</pre>
<p>Nvidia guest drivers prior to version 465 exhibited a similar behaviour which resulted in a generic error 43 in the card's device manager status. Systems using these older drivers therefore also need the above modification. In addition, they also require hiding the KVM CPU leaf:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>...
&lt;features&gt;
  ...
  &lt;kvm&gt;
    &lt;hidden state='on'/&gt;
  &lt;/kvm&gt;
  ...
&lt;/features&gt;
...</pre>
<p>Note that the above steps do not equate 'hiding' the virtual machine from Windows or any drivers/programs running in the virtual machine. Also, various other issues not related to any detection mechanism referred to here can also trigger error 43.
</p>
<h3><span id=Passing_keyboard.2Fmouse_via_Evdev></span><span class=mw-headline id=Passing_keyboard/mouse_via_Evdev>Passing keyboard/mouse via Evdev</span></h3>
<p>If you do not have a spare mouse or keyboard to dedicate to your guest, and you do not want to suffer from the video overhead of Spice, you can setup evdev to share them between your Linux host and your virtual machine.
</p>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> Press both left and right <b>Ctrl</b> keys at the same time to swap control between the host and the guest.</div>
<p>First, find your keyboard and mouse devices in <code>/dev/input/by-id/</code>. Only devices with <code>event</code> in their name are valid. You may find multiple devices associated to your mouse or keyboard, so try <code>cat /dev/input/by-id/<i>device_id</i></code> and either hit some keys on the keyboard or wiggle your mouse to see if input comes through, if so you have got the right device. Now add those devices to your configuration:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>...
  &lt;devices&gt;
    ...
    &lt;input type='evdev'&gt;
      &lt;source dev='/dev/input/by-id/MOUSE_NAME'/&gt;
    &lt;/input&gt;
    &lt;input type='evdev'&gt;
      &lt;source dev='/dev/input/by-id/KEYBOARD_NAME' grab='all' repeat='on'/&gt;
    &lt;/input&gt;
    ...
  &lt;/devices&gt;</pre>
<p>Replace <code>MOUSE_NAME</code> and <code>KEYBOARD_NAME</code> with your device path. Now you can startup the guest OS and test swapping control of your mouse and keyboard between the host and guest by pressing both the left and right control keys at the same time.
<p>You may also consider switching from PS/2 to Virtio inputs in your configurations. Add these two devices:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>...
&lt;input type='mouse' bus='virtio'/&gt;
&lt;input type='keyboard' bus='virtio'/&gt;
...</pre>
<p>The virtio input devices will not actually be used until the guest drivers are installed. QEMU will continue to send key events to the PS2 devices until it detects the virtio input driver initialization. Note that the PS2 devices cannot be removed as they are an internal function of the emulated Q35/440FX chipsets.
</p>
<h3><span class=mw-headline id=Gotchas_2>Gotchas</span></h3>
<h4><span class=mw-headline id=Using_a_non-EFI_image_on_an_OVMF-based_virtual_machine>Using a non-EFI image on an OVMF-based virtual machine</span></h4>
<p>The OVMF firmware does not support booting off non-EFI mediums. If the installation process drops you in a UEFI shell right after booting, you may have an invalid EFI boot media. Try using an alternate Linux/Windows image to determine if you have an invalid media.
</p>
<h2><span class=mw-headline id=Performance_tuning>Performance tuning</span></h2>
<p>Most use cases for PCI passthroughs relate to performance-intensive domains such as video games and GPU-accelerated tasks. While a PCI passthrough on its own is a step towards reaching native performance, there are still a few ajustments on the host and guest to get the most out of your virtual machine.
</p>
<h3><span class=mw-headline id=CPU_pinning>CPU pinning</span></h3>
<p>The default behavior for KVM guests is to run operations coming from the guest as a number of threads representing virtual processors. Those threads are managed by the Linux scheduler like any other thread and are dispatched to any available CPU cores based on niceness and priority queues. As such, the local CPU cache benefits (L1/L2/L3) are lost each time the host scheduler reschedules the virtual CPU thread on a different physical CPU. This can noticeably harm performance on the guest. CPU pinning aims to resolve this by limiting which physical CPUs the virtual CPUs are allowed to run on. The ideal setup is a one to one mapping such that the virtual CPU cores match physical CPU cores while taking hyperthreading/SMT into account.
<p>In addition, in some modern CPUs, groups of cores often share a common L3 cache. In such cases, care should be taken to pin exactly those physical cores that share a particular L3. Failing to do so might lead to cache evictions which could result in microstutters.
</p>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> For certain users enabling CPU pinning may introduce stuttering and short hangs, especially with the MuQSS scheduler (present in linux-ck and linux-zen kernels). You might want to try disabling pinning first if you experience similar issues, which effectively trades maximum performance for responsiveness at all times.</div>
<h4><span class=mw-headline id=CPU_topology>CPU topology</span></h4>
<p>Most modern CPUs support hardware multitasking, also known as hyper-threading on Intel CPUs or SMT on AMD CPUs. Hyper-threading/SMT is simply a very efficient way of running two threads on one CPU core at any given time. You will want to take into consideration that the CPU pinning you choose will greatly depend on what you do with your host while your virtual machine is running.
<p>To find the topology for your CPU run <code>lscpu -e</code>:
</p>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> Pay special attention to the 4th column <b>"CORE"</b> as this shows the association of the Physical/Logical CPU cores as well as the 8th column <b>"L3"</b> which shows which cores are connected to which L3 cache.</div>
<p><code>lscpu -e</code> on a 6c/12t Ryzen 5 1600:
</p>
<pre>CPU NODE SOCKET CORE L1d:L1i:L2:L3 ONLINE MAXMHZ    MINMHZ
0   0    0      0    0:0:0:0       yes    3800.0000 1550.0000
1   0    0      0    0:0:0:0       yes    3800.0000 1550.0000
2   0    0      1    1:1:1:0       yes    3800.0000 1550.0000
3   0    0      1    1:1:1:0       yes    3800.0000 1550.0000
4   0    0      2    2:2:2:0       yes    3800.0000 1550.0000
5   0    0      2    2:2:2:0       yes    3800.0000 1550.0000
6   0    0      3    3:3:3:1       yes    3800.0000 1550.0000
7   0    0      3    3:3:3:1       yes    3800.0000 1550.0000
8   0    0      4    4:4:4:1       yes    3800.0000 1550.0000
9   0    0      4    4:4:4:1       yes    3800.0000 1550.0000
10  0    0      5    5:5:5:1       yes    3800.0000 1550.0000
11  0    0      5    5:5:5:1       yes    3800.0000 1550.0000
</pre>
<p>Considering the L3 mapping, it is recommended to pin and isolate CPUs 611. Pinning and isolating fewer than these (e.g. 811) would result in the host system making use of the L3 cache in core 6 and 7 which would eventually lead to cache evictions and therefore bad performance.
</p>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> Ryzen 3000 ComboPi AGESA changes topology to match Intel example, even on prior generation CPUs. Above valid only on older AGESA.</div>
<p><code>lscpu -e</code> on a 6c/12t Intel 8700k:
</p>
<pre>CPU NODE SOCKET CORE L1d:L1i:L2:L3 ONLINE MAXMHZ    MINMHZ
0   0    0      0    0:0:0:0       yes    4600.0000 800.0000
1   0    0      1    1:1:1:0       yes    4600.0000 800.0000
2   0    0      2    2:2:2:0       yes    4600.0000 800.0000
3   0    0      3    3:3:3:0       yes    4600.0000 800.0000
4   0    0      4    4:4:4:0       yes    4600.0000 800.0000
5   0    0      5    5:5:5:0       yes    4600.0000 800.0000
6   0    0      0    0:0:0:0       yes    4600.0000 800.0000
7   0    0      1    1:1:1:0       yes    4600.0000 800.0000
8   0    0      2    2:2:2:0       yes    4600.0000 800.0000
9   0    0      3    3:3:3:0       yes    4600.0000 800.0000
10  0    0      4    4:4:4:0       yes    4600.0000 800.0000
11  0    0      5    5:5:5:0       yes    4600.0000 800.0000
</pre>
<p>Since all cores are connected to the same L3 in this example, it does not matter much how many CPUs you pin and isolate as long as you do it in the proper thread pairs. For instance, (0, 6), (1, 7), etc.
<p>As we see above, with AMD <b>Core 0</b> is sequential with <b>CPU 0 &amp; 1</b>, whereas Intel places <b>Core 0</b> on <b>CPU 0 &amp; 6</b>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip"><strong>Tip:</strong> You can view your systems topology in diagram form, which may help some users. If you have <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=hwloc">hwloc</a></span> installed, run <code>lstopo</code> to generate a helpful image of your CPU/Thread groupings.</div>
<p>If you do not need all cores for the guest, it would then be preferable to leave at the very least one core for the host. Choosing which cores one to use for the host or guest should be based on the specific hardware characteristics of your CPU, however <b>Core 0</b> is a good choice for the host in most cases. If any cores are reserved for the host, it is recommended to pin the emulator and iothreads, if used, to the host cores rather than the VCPUs. This may improve performance and reduce latency for the guest since those threads will not pollute the cache or contend for scheduling with the guest VCPU threads. If all cores are passed to the guest, there is no need or benefit to pinning the emulator or iothreads.
</p>
<h4><span class=mw-headline id=XML_examples>XML examples</span></h4>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> Do not use the <b>iothread</b> lines from the XML examples shown below if you have not added an <b>iothread</b> to your disk controller. <b>iothread'</b>s only work on <b>virtio-scsi</b> or <b>virtio-blk</b> devices.</div>
<h5><span id=4c.2F1t_CPU_w.2Fo_Hyperthreading_Example></span><span class=mw-headline id=4c/1t_CPU_w/o_Hyperthreading_Example>4c/1t CPU w/o Hyperthreading Example</span></h5>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>...
&lt;vcpu placement='static'&gt;4&lt;/vcpu&gt;
&lt;cputune&gt;
    &lt;vcpupin vcpu='0' cpuset='0'/&gt;
    &lt;vcpupin vcpu='1' cpuset='1'/&gt;
    &lt;vcpupin vcpu='2' cpuset='2'/&gt;
    &lt;vcpupin vcpu='3' cpuset='3'/&gt;
&lt;/cputune&gt;
...</pre>
<h5><span id=4c.2F2t_Intel.2FAMD_CPU_example_.28after_ComboPI_AGESA_bios_update.29></span><span class=mw-headline id=4c/2t_Intel/AMD_CPU_example_(after_ComboPI_AGESA_bios_update)>4c/2t Intel/AMD CPU example (after ComboPI AGESA bios update)</span></h5>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>...
&lt;vcpu placement='static'&gt;8&lt;/vcpu&gt;
&lt;iothreads&gt;1&lt;/iothreads&gt;
&lt;cputune&gt;
    &lt;vcpupin vcpu='0' cpuset='2'/&gt;
    &lt;vcpupin vcpu='1' cpuset='8'/&gt;
    &lt;vcpupin vcpu='2' cpuset='3'/&gt;
    &lt;vcpupin vcpu='3' cpuset='9'/&gt;
    &lt;vcpupin vcpu='4' cpuset='4'/&gt;
    &lt;vcpupin vcpu='5' cpuset='10'/&gt;
    &lt;vcpupin vcpu='6' cpuset='5'/&gt;
    &lt;vcpupin vcpu='7' cpuset='11'/&gt;
    &lt;emulatorpin cpuset='0,6'/&gt;
    &lt;iothreadpin iothread='1' cpuset='0,6'/&gt;
&lt;/cputune&gt;
    ...
&lt;cpu mode='host-passthrough'&gt;
    &lt;topology sockets='1' cores='4' threads='2'/&gt;
&lt;/cpu&gt;
    ...</pre>
<h5><span id=4c.2F2t_AMD_CPU_example_.28Before_ComboPi_AGESA_bios_update.29></span><span class=mw-headline id=4c/2t_AMD_CPU_example_(Before_ComboPi_AGESA_bios_update)>4c/2t AMD CPU example (Before ComboPi AGESA bios update)</span></h5>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>...
&lt;vcpu placement='static'&gt;8&lt;/vcpu&gt;
&lt;iothreads&gt;1&lt;/iothreads&gt;
&lt;cputune&gt;
  &lt;vcpupin vcpu='0' cpuset='2'/&gt;
  &lt;vcpupin vcpu='1' cpuset='3'/&gt;
  &lt;vcpupin vcpu='2' cpuset='4'/&gt;
  &lt;vcpupin vcpu='3' cpuset='5'/&gt;
  &lt;vcpupin vcpu='4' cpuset='6'/&gt;
  &lt;vcpupin vcpu='5' cpuset='7'/&gt;
  &lt;vcpupin vcpu='6' cpuset='8'/&gt;
  &lt;vcpupin vcpu='7' cpuset='9'/&gt;
  &lt;emulatorpin cpuset='0-1'/&gt;
  &lt;iothreadpin iothread='1' cpuset='0-1'/&gt;
&lt;/cputune&gt;
    ...
&lt;cpu mode='host-passthrough'&gt;
    &lt;topology sockets='1' cores='4' threads='2'/&gt;
&lt;/cpu&gt;
    ...</pre>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> If further CPU isolation is needed, consider using the <b>isolcpus</b> kernel command-line parameter on the unused physical/logical cores.</div>
<p>If you do not intend to be doing any computation-heavy work on the host (or even anything at all) at the same time as you would on the virtual machine, you may want to pin your virtual machine threads across all of your cores, so that the virtual machine can fully take advantage of the spare CPU time the host has available. Be aware that pinning all physical and logical cores of your CPU could induce latency in the guest virtual machine.
</p>
<h3><span class=mw-headline id=Huge_memory_pages>Huge memory pages</span></h3>
<p>When dealing with applications that require large amounts of memory, memory latency can become a problem since the more memory pages are being used, the more likely it is that this application will attempt to access information across multiple memory "pages", which is the base unit for memory allocation. Resolving the actual address of the memory page takes multiple steps, and so CPUs normally cache information on recently used memory pages to make subsequent uses on the same pages faster. Applications using large amounts of memory run into a problem where, for instance, a virtual machine uses 4 GiB of memory divided into 4 KiB pages (which is the default size for normal pages) for a total of 1.04 million pages, meaning that such cache misses can become extremely frequent and greatly increase memory latency. Huge pages exist to mitigate this issue by giving larger individual pages to those applications, increasing the odds that multiple operations will target the same page in succession.
</p>
<h4><span class=mw-headline id=Transparent_huge_pages>Transparent huge pages</span></h4>
<p>QEMU will use 2MiB sized transparent huge pages automatically without any explicit configuration in QEMU or Libvirt, subject to some important caveats. When using VFIO the pages are locked in at boot time and transparent huge pages are allocated up front when the virtual machine first boots. If the kernel memory is highly fragmented, or the virtual machine is using a majority of the remaining free memory, it is likely that the kernel will not have enough 2MiB pages to fully satisfy the allocation. In such a case, it silently fails by using a mix of 2MiB and 4KiB pages. Since the pages are locked in VFIO mode, the kernel will not be able to convert those 4KiB pages to huge after the virtual machine starts either. The number of available 2MiB huge pages available to THP is the same as via the <a href=#Dynamic_huge_pages>#Dynamic huge pages</a> mechanism described in the following sections.
<p>To check how much memory THP is using globally:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ grep AnonHugePages /proc/meminfo</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>AnonHugePages:   8091648 kB
</pre>
<p>To check a specific QEMU instance. QEMU's PID must be substituted in the grep command:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ grep -P 'AnonHugePages:\s+(?!0)\d+' /proc/[PID]/smaps</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>AnonHugePages:   8087552 kB
</pre>
<p>In this example, the virtual machine was allocated 8388608KiB of memory, but only 8087552KiB was available via THP. The remaining 301056KiB are allocated as 4KiB pages. Aside from manually checking, there is no indication when partial allocations occur. As such, THP's effectiveness is very much dependent on the host system's memory fragmentation at the time of virtual machine startup. If this trade off is unacceptable or strict guarantees are required, <a href=#Static_huge_pages>#Static huge pages</a> is recommended.
<p>Arch kernels have THP compiled in and enabled by default with <code>/sys/kernel/mm/transparent_hugepage/enabled</code> set to <code>madvise</code> mode.
</p>
<h4><span class=mw-headline id=Static_huge_pages>Static huge pages</span></h4>
<p>While transparent huge pages should work in the vast majority of cases, they can also be allocated statically during boot. This should only be needed to make use 1 GiB hugepages on machines that support it, since transparent huge pages normally only go up to 2 MiB.
</p>
<div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning:</strong> Static huge pages lock down the allocated amount of memory, making it unavailable for applications that are not configured to use them. Allocating 4 GiBs worth of huge pages on a machine with 8 GiB of memory will only leave you with 4 GiB of available memory on the host <b>even when the virtual machine is not running</b>.</div>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> The described procedures have some drawbacks but will not necessarily net you a great performance advantage. According to <a rel=nofollow class="external text" href=https://developers.redhat.com/blog/2021/04/27/benchmarking-transparent-versus-1gib-static-huge-page-performance-in-linux-virtual-machines#benchmarks>Red Hat benchmarks</a>, you should not expect more than a 2% performance gain from this over <a href=#Transparent_huge_pages>#Transparent huge pages</a>.</div>
<p>To allocate huge pages at boot, one must simply specify the desired amount on their kernel command line with <code>hugepages=<i>x</i></code>. For instance, reserving 1024 pages with <code>hugepages=1024</code> and the default size of 2048 KiB per huge page creates 2 GiB worth of memory for the virtual machine to use.
<p>If supported by CPU page size could be set manually. 1 GiB huge page support could be verified by <code>grep pdpe1gb /proc/cpuinfo</code>. Setting 1 GiB huge page size via kernel parameters&nbsp;: <code>default_hugepagesz=1G hugepagesz=1G hugepages=X</code>.
<p>Also, since static huge pages can only be used by applications that specifically request it, you must add this section in your libvirt domain configuration to allow kvm to benefit from them&nbsp;:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>...
&lt;memoryBacking&gt;
	&lt;hugepages/&gt;
&lt;/memoryBacking&gt;
...</pre>
<h4><span class=mw-headline id=Dynamic_huge_pages>Dynamic huge pages</span></h4>
<div class="noprint archwiki-template-message">
<p><a href=https://wiki.archlinux.org/title/File:Tango-inaccurate.png class=image><img alt=Tango-inaccurate.png src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"><rect fill-opacity="0"/></svg>' decoding=async width=48 height=48 style="background-blend-mode:normal!important;background-clip:content-box!important;background-position:50% 50%!important;background-color:rgba(0,0,0,0)!important;background-image:var(--sf-img-13)!important;background-size:100% 100%!important;background-origin:content-box!important;background-repeat:no-repeat!important"></a><b>The factual accuracy of this article or section is disputed.</b><a href=https://wiki.archlinux.org/title/File:Tango-inaccurate.png class=image><img alt=Tango-inaccurate.png src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"><rect fill-opacity="0"/></svg>' decoding=async width=48 height=48 style="background-blend-mode:normal!important;background-clip:content-box!important;background-position:50% 50%!important;background-color:rgba(0,0,0,0)!important;background-image:var(--sf-img-13)!important;background-size:100% 100%!important;background-origin:content-box!important;background-repeat:no-repeat!important"></a></p>
<div><b>Reason:</b> Need futher testing if this variant as effective as static one (Discuss in <a rel=nofollow class="external text" href=https://wiki.archlinux.org/title/Talk:PCI_passthrough_via_OVMF>Talk:PCI passthrough via OVMF</a>)</div>
</div>
<p>Hugepages could be allocated manually via <code>vm.nr_overcommit_hugepages</code> <a href=https://wiki.archlinux.org/title/Sysctl title=Sysctl>sysctl</a> parameter.
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>/etc/sysctl.d/10-kvm.conf</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>vm.nr_hugepages = 0
vm.nr_overcommit_hugepages = <i>num</i></pre>
<p>Where <code><i>num</i></code> - is the number of huge pages, which default size if 2 MiB.
Pages will be automatically allocated, and freed after the virtual machine stops.
<p>More manual way:
</p>
<pre># echo <i>num</i> &gt; /sys/kernel/mm/hugepages/hugepages-2048kB/nr_hugepages
# echo <i>num</i> &gt; /sys/kernel/mm/hugepages/hugepages-1048576kB/nr_hugepages
</pre>
<p>For 2 MiB and 1 GiB page size respectively.
And they should be manually freed in the same way.
<p>It is hardly recommended to drop caches, compact memory and wait a couple of seconds before starting the virtual machine, as there could be not enough free contiguous memory for required huge pages blocks. Especially after some uptime of the host system.
</p>
<pre># echo 3 &gt; /proc/sys/vm/drop_caches
# echo 1 &gt; /proc/sys/vm/compact_memory
</pre>
<p>Theoretically, 1 GiB pages works as 2 MiB. But practically - no guaranteed way was found to get contiguous 1 GiB memory blocks. Each consequent request of 1 GiB blocks lead to lesser and lesser dynamically allocated count.
</p>
<h3><span class=mw-headline id=CPU_frequency_governor>CPU frequency governor</span></h3>
<p>Depending on the way your <a href=https://wiki.archlinux.org/title/CPU_frequency_scaling title="CPU frequency scaling">CPU governor</a> is configured, the virtual machine threads may not hit the CPU load thresholds for the frequency to ramp up. Indeed, KVM cannot actually change the CPU frequency on its own, which can be a problem if it does not scale up with vCPU usage as it would result in underwhelming performance. An easy way to see if it behaves correctly is to check if the frequency reported by <code>watch lscpu</code> goes up when running a CPU-intensive task on the guest. If you are indeed experiencing stutter and the frequency does not go up to reach its reported maximum, it may be due to <a rel=nofollow class="external text" href="https://lime-technology.com/forum/index.php?topic=46664.msg447678#msg447678">cpu scaling being controlled by the host OS</a>. In this case, try setting all cores to maximum frequency to see if this improves performance. Note that if you are using a modern intel chip with the default pstate driver, cpupower commands will be <a href=https://wiki.archlinux.org/title/CPU_frequency_scaling#CPU_frequency_driver title="CPU frequency scaling">ineffective</a>, so monitor <code>/proc/cpuinfo</code> to make sure your cpu is actually at max frequency.
</p>
<div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning:</strong> Depending on your processor, it might actually be detrimental to performance to force the whole CPU to run at full frequency at all times. For instance, modern AMD processors (Zen 2 and Zen 3) depend heavily on being able to scale individual cores in separate core complexes for optimal thermal distribution. If the whole CPU is running at full frequency at all times, there is less headroom for invididual cores to clock high, resulting in worse performance for processes that are not heavily multithreaded such as games. This should be benchmarked in your virtual machine.</div>
<h3><span class=mw-headline id=Isolating_pinned_CPUs>Isolating pinned CPUs</span></h3>
<p>CPU pinning by itself will not prevent other host processes from running on the pinned CPUs. Properly isolating the pinned CPUs can reduce latency in the guest virtual machine.
</p>
<h4><span class=mw-headline id=With_isolcpus_kernel_parameter>With isolcpus kernel parameter</span></h4>
<p>In this example, let us assume you are using CPUs 4-7.
Use the <a href=https://wiki.archlinux.org/title/Kernel_parameters title="Kernel parameters">kernel parameters</a> <code>isolcpus nohz_full</code> to completely isolate the CPUs from the kernel. For example:
</p>
<pre>isolcpus=4-7 nohz_full=4-7
</pre>
<p>Then, run <code>qemu-system-x86_64</code> with taskset and chrt:
</p>
<pre># chrt -r 1 taskset -c 4-7 qemu-system-x86_64 ...
</pre>
<p>The <code>chrt</code> command will ensure that the task scheduler will round-robin distribute work (otherwise it will all stay on the first cpu). For <code>taskset</code>, the CPU numbers can be comma- and/or dash-separated, like "0,1,2,3" or "0-4" or "1,7-8,10" etc.
<p>See <a rel=nofollow class="external text" href=https://web.archive.org/web/20210520061110/https://www.removeddit.com/r/VFIO/comments/6vgtpx/high_dpc_latency_and_audio_stuttering_on_windows/dm0sfto/>this Internet Archive copy of a Removeddit mirror of a Reddit thread</a> for more info. (<a rel=nofollow class="external text" href=https://www.reddit.com/r/VFIO/comments/6vgtpx/high_dpc_latency_and_audio_stuttering_on_windows/dm0sfto/>The original thread</a> is worthless because of deleted comments, and Removeddit not longer works.)
</p>
<h4><span class=mw-headline id=Dynamically_isolating_CPUs>Dynamically isolating CPUs</span></h4>
<p>The isolcpus kernel parameter will permanently reserve CPU cores, even when the guest is not running. A more flexible alternative is to dynamically isolate CPUs when starting the guest. This can be achieved with the following alternatives:
</p>
<ul><li><span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href=https://aur.archlinux.org/packages/cpuset-git/>cpuset-git</a></span><sup><small>AUR</small></sup> (<a rel=nofollow class="external text" href=https://www.redhat.com/archives/vfio-users/2016-September/msg00072.html>vfio-users post</a>, <a rel=nofollow class="external text" href=https://rokups.github.io/#!pages/gaming-vm-performance.md>blog post</a>, <a rel=nofollow class="external text" href=https://github.com/PassthroughPOST/VFIO-Tools/blob/master/libvirt_hooks/hooks/cset.sh>example script</a>)</li>
<li><span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href=https://aur.archlinux.org/packages/vfio-isolate/>vfio-isolate</a></span><sup><small>AUR</small></sup></li>
<li>systemd</ul>
<h5><span class=mw-headline id=Example_with_systemd>Example with systemd</span></h5>
<p>In this example, we assume a host with 12 CPUs, where CPUs 2-5 and 8-11 are <a href=#CPU_pinning>pinned</a> to the guest. Then run the following to isolate the host to CPUs 0, 1, 6, and 7:
</p>
<pre># systemctl set-property --runtime -- user.slice AllowedCPUs=0,1,6,7
# systemctl set-property --runtime -- system.slice AllowedCPUs=0,1,6,7
# systemctl set-property --runtime -- init.scope AllowedCPUs=0,1,6,7
</pre>
<p>After shutting down the guest, run the following to reallocate all 12 CPUs back to the host:
</p>
<pre># systemctl set-property --runtime -- user.slice AllowedCPUs=0-11
# systemctl set-property --runtime -- system.slice AllowedCPUs=0-11
# systemctl set-property --runtime -- init.scope AllowedCPUs=0-11
</pre>
<p>You can use a <a rel=nofollow class="external text" href=https://libvirt.org/hooks.html>libvirt hook</a> to automatically run the above at startup/shutdown of the guest like so:
<p>Create or edit <code>/etc/libvirt/hooks/qemu</code> with the following content.
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>/etc/libvirt/hooks/qemu</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>#!/bin/sh

command=$2

if [ "$command" = "started" ]; then
    systemctl set-property --runtime -- system.slice AllowedCPUs=0,1,6,7
    systemctl set-property --runtime -- user.slice AllowedCPUs=0,1,6,7
    systemctl set-property --runtime -- init.scope AllowedCPUs=0,1,6,7
elif [ "$command" = "release" ]; then
    systemctl set-property --runtime -- system.slice AllowedCPUs=0-11
    systemctl set-property --runtime -- user.slice AllowedCPUs=0-11
    systemctl set-property --runtime -- init.scope AllowedCPUs=0-11
fi</pre>
<p>Afterwards make it <a href=https://wiki.archlinux.org/title/Executable class=mw-redirect title=Executable>executable</a>.
<p><a href=https://wiki.archlinux.org/title/Restart class=mw-redirect title=Restart>Restart</a> <code>libvirtd.service</code> and then start your virtual machine. If you create some heavily multithreaded load on your host now, you should see that it keeps your chosen CPUs free from load while the virtual machine can still make use of it. You should also see those CPUs automatically getting fully used by your host once you terminate the virtual machine.
<p>More examples are contained in the following reddit threads: <a rel=nofollow class="external autonumber" href=https://www.reddit.com/r/VFIO/comments/ebe3l5/deprecated_isolcpus_workaround/fem8jgk>[1]</a> <a rel=nofollow class="external autonumber" href=https://www.reddit.com/r/VFIO/comments/gyem88/noob_question_how_to_isolate_cpu_cores/ftaqno1/>[2]</a> <a rel=nofollow class="external autonumber" href=https://www.reddit.com/r/VFIO/comments/ij25rg/splitting_ht_cores_between_host_and_vm/>[3]</a>
<p>Note that this requires systemd 244 or higher, and <a href=https://wiki.archlinux.org/title/Cgroups title=Cgroups>cgroups v2</a>, which is now enabled by default.
</p>
<h3><span class=mw-headline id=Improving_performance_on_AMD_CPUs>Improving performance on AMD CPUs</span></h3>
<p>Starting with QEMU 3.1 the TOPOEXT cpuid flag is disabled by default. In order to use hyperthreading (SMT) on AMD CPUs you need to manually enable it:
</p>
<pre> &lt;cpu mode='host-passthrough' check='none'&gt;
 &lt;topology sockets='1' cores='4' threads='2'/&gt;
 &lt;feature policy='require' name='topoext'/&gt;
 &lt;/cpu&gt;
</pre>
<p>commit: <a rel=nofollow class="external free" href="https://git.qemu.org/?p=qemu.git;a=commit;h=7210a02c58572b2686a3a8d610c6628f87864aed">https://git.qemu.org/?p=qemu.git;a=commit;h=7210a02c58572b2686a3a8d610c6628f87864aed</a>
</p>
<h3><span class=mw-headline id=Virtio_disk>Virtio disk</span></h3>
<div class="noprint archwiki-template-message">
<p><a href=https://wiki.archlinux.org/title/File:Merge-arrows-2.png class=image><img alt=Merge-arrows-2.png src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"><rect fill-opacity="0"/></svg>' decoding=async width=48 height=48 style="background-blend-mode:normal!important;background-clip:content-box!important;background-position:50% 50%!important;background-color:rgba(0,0,0,0)!important;background-image:var(--sf-img-14)!important;background-size:100% 100%!important;background-origin:content-box!important;background-repeat:no-repeat!important"></a><b>This article or section is a candidate for merging with <a href=https://wiki.archlinux.org/title/QEMU#Installing_virtio_drivers title=QEMU>QEMU#Installing virtio drivers</a>.</b><a href=https://wiki.archlinux.org/title/File:Merge-arrows-2.png class=image><img alt=Merge-arrows-2.png src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"><rect fill-opacity="0"/></svg>' decoding=async width=48 height=48 style="background-blend-mode:normal!important;background-clip:content-box!important;background-position:50% 50%!important;background-color:rgba(0,0,0,0)!important;background-image:var(--sf-img-14)!important;background-size:100% 100%!important;background-origin:content-box!important;background-repeat:no-repeat!important"></a></p>
<div><b>Notes:</b> Off-topic. (Discuss in <a href=https://wiki.archlinux.org/title/Talk:PCI_passthrough_via_OVMF#Moving_virtio_disk_section_to_QEMU title="Talk:PCI passthrough via OVMF">Talk:PCI passthrough via OVMF#Moving virtio disk section to QEMU</a>)</div>
</div>
<p>The default disk types are SATA or IDE emulation out of the box. These controllers offer maximum compatibility but are not suited for efficient virtualization. Two accelerated models exist: <code>virtio-scsi</code> for SCSI emulation and passthrough, or <code>virtio-blk</code> for a more basic block device emulation.
</p>
<h4><span class=mw-headline id=Drivers>Drivers</span></h4>
<ul><li>Linux guests should support these out of the box on any modern kernel</li>
<li>macOS has <code>virtio-blk</code> support starting in Mojave via <code>AppleVirtIO.kext</code></li>
<li>Windows needs the <a rel=nofollow class="external text" href=https://docs.fedoraproject.org/en-US/quick-docs/creating-windows-virtual-machines-using-virtio-drivers/>Windows virtio drivers</a>. <code>virtio-scsi</code> uses the <code>vioscsi</code> driver. <code>virtio-blk</code> uses the <code>viostor</code> driver</li>
<li>Windows can be installed directly onto these disks by selecting 'load driver' on the installer disk selection menu. The windows iso and virtio driver iso should both be attached as regular SATA/IDE cdroms during the installation process</li>
<li>To switch boot disks to virtio on an existing Windows installation:
<ul><li><code>virtio-blk</code>: Add a temporary disk with bus <code>virtio</code>, boot windows &amp; load the driver for the disk, then shutdown and switch the boot disk disk bus to <code>virtio</code></li>
<li><code>virtio-scsi</code>: Add a scsi controller with model <code>virtio</code>, boot windows &amp; load the driver for the controller, then shutdown and switch the boot disk bus to <code>scsi</code> (not virtio)</ul></ul>
<h4><span class=mw-headline id=Considerations>Considerations</span></h4>
<ul><li><code>virtio-scsi</code> TRIM support is mature, all versions should support it. Traditionally, <code>virtio-scsi</code> has been the preferred approach for this reason</li>
<li><code>virtio-blk</code> TRIM support is new, this requires requires qemu 4.0+, guest linux kernel 5.0+, guest windows drivers 0.1.173+</li>
<li>Thin provisioning works by enabling TRIM on a sparse image file: <code>discard='unmap'</code>. Unused blocks will be freed and the disk usage will drop (works on both raw and qcow2). Actual on-disk size of a sparse image file may be checked with <code>du /path/to/disk.img</code></li>
<li>Thin provisioning can also work with block storage such as zfs zvols or thin lvm</li>
<li>Virt queue count will influence the number of threads inside the guest kernel used for IO processing, suggest using <code>queues='4'</code> or more</li>
<li>Native mode (<code>io='native'</code>) uses a single threaded model based on linux AIO, is a bit more CPU efficient but may have lower peak performance and does not allow host side caching to be used</li>
<li>Threaded mode (<code>io='threads'</code>) will spawn dozens of threads on demand as the disk is used. This is less efficient but may perform better if there are enough host cores available to run them, and allows for host side caching to be used</li>
<li>Modern versions of libvirt will group the dynamic worker threads created when using threaded mode in with the iothread=1 cgroup for pinning purposes. Very old versions of libvirt left these in the emulator cgroup</ul>
<h4><span class=mw-headline id=IO_threads>IO threads</span></h4>
<p>An IO thread is a dedicated thread for processing disk events, rather than using the main qemu emulator loop. This should not be confused with the worker threads spawned on demand with <code>io='threads'</code>.
</p>
<ul><li>You can only use one iothread per disk controller. The thread must be assigned to a specific controller with <code>iothread='X'</code> in the <code>&lt;driver&gt;</code> tag. Furthermore, extra &amp; unassigned iothreads will not be used and do nothing</li>
<li>In the case of <code>virtio-scsi</code>, there is one controller for multiple scsi disks. The iothread is assigned on the controller: <code>&lt;controller&gt;&lt;driver iothread='X'&gt;</code></li>
<li>In the case of <code>virtio-blk</code>, each disk has its own controller. The iothread is assigned in the driver tag under the disk itself: <code>&lt;disk&gt;&lt;driver iothread='X'&gt;</code></li>
<li>Since emulated disks incur a significant amount of CPU overhead, that can lead to vcpu stuttering under high disk load (especially high random IOPS). In this case it helps to pin the IO to different core(s) than your vcpus with <code>&lt;iothreadpin&gt;</code></ul>
<h4><span class=mw-headline id=Examples_with_libvirt>Examples with libvirt</span></h4>
<p>virtio-scsi + iothread + worker threads + host side writeback caching + full disk block device backend:
</p>
<pre>&lt;domain&gt;
  &lt;devices&gt;
    &lt;disk type='block' device='disk'&gt;
      &lt;driver name='qemu' type='raw' cache='writeback' io='threads' discard='unmap'/&gt;
      &lt;source dev='/dev/disk/by-id/ata-Samsung_SSD_840_EVO_1TB_S1D9NSAF206396F'/&gt;
      &lt;target dev='sda' bus='scsi'/&gt;
    &lt;/disk&gt;
    &lt;controller type='scsi' index='0' model='virtio-scsi'&gt;
      &lt;driver iothread='1' queues='8'/&gt;
    &lt;/controller&gt;
</pre>
<p>virtio-blk + iothread + native aio + no host caching + raw sparse image backend:
</p>
<pre>&lt;domain&gt;
  &lt;devices&gt;
    &lt;disk type='file' device='disk'&gt;
      &lt;driver name='qemu' type='raw' cache='none' io='native' discard='unmap' iothread='1' queues='8'/&gt;
      &lt;source file='/var/lib/libvirt/images/pool/win10.img'/&gt;
      &lt;target dev='vda' bus='virtio'/&gt;
    &lt;/disk&gt;
</pre>
<p>Creating the iothreads:
</p>
<pre>&lt;domain&gt;
  &lt;iothreads&gt;1&lt;/iothreads&gt;
</pre>
<p>Pinning iothreads:
</p>
<pre>&lt;domain&gt;
  &lt;cputune&gt;
    &lt;iothreadpin iothread='1' cpuset='0-1,6-7'/&gt;
</pre>
<h4><span class=mw-headline id=Example_with_virt-manager>Example with virt-manager</span></h4>
<p>This will create a <code>virtio-blk</code> device:
</p>
<ol><li>Open the virtual machine preferences</li>
<li>Go to <code>Add Hardware &gt; Storage</code></li>
<li>Create or choose a storage file</li>
<li>Select <code>Device Type: Disk device</code> and <code>Bus type: VirtIO</code></li>
<li>Click Finish</ol>
<h3><span class=mw-headline id=Virtio_network>Virtio network</span></h3>
<p>The default NIC models rtl8139 or e1000 can be a bottleneck for gigabit+ speeds and have a significant amount of CPU overhead compared to <code>virtio-net</code>.
</p>
<ul><li>Select <code>virtio</code> as the model for the NIC with libvirt or use the <code>virtio-net-pci</code> device in bare qemu</li>
<li>Windows needs the <code>NetKVM</code> driver from <a rel=nofollow class="external text" href=https://docs.fedoraproject.org/en-US/quick-docs/creating-windows-virtual-machines-using-virtio-drivers/>Windows virtio drivers</a></li>
<li>Virtio uses vhost-net by default for in-kernel packet processing without exiting to userspace</li>
<li>Multiqueue can enabled for a further speedup with multiple connections but typically will not boost single stream speeds. For libvirt add <code>&lt;driver queues='8'/&gt;</code> under the interface tag</li>
<li>Zero copy transmit may also be enabled on macvtap by setting the module parameter <code>vhost_net.experimental_zcopytx=1</code> but this may actually have worse performance, see <a rel=nofollow class="external text" href=https://github.com/torvalds/linux/commit/098eadce3c622c07b328d0a43dda379b38cf7c5e>commit</a></ul>
<p>Libvirt example with a bridge:
</p>
<pre>&lt;interface type='bridge'&gt;
  &lt;mac address="52:54:00:6d:6e:2e"/&gt;
  &lt;source bridge='br0'/&gt;
  &lt;model type='virtio'/&gt;
  &lt;driver queues='8'/&gt;
&lt;/interface&gt;
</pre>
<p>MACVTAP example with a bridge:
</p>
<pre>&lt;interface type="direct"&gt;
 &lt;source dev="<b>eno1</b>" mode="vepa"/&gt;
 &lt;target dev="macvtap0"/&gt;
 &lt;model type="virtio"/&gt;
 &lt;alias name="net0"/&gt;
&lt;/interface&gt;
</pre>
<p>Possible options for mode are 'vepa', 'bridge', 'private', and 'passthrough'. A guide with decriptions of the differences is available from redhat<a rel=nofollow class="external autonumber" href=https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/sect-virtual_networking-directly_attaching_to_physical_interface>[4]</a>.
<p>Replace the source <code>/dev</code> device with your own device address. You can get your local address with the following command:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ ip link</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
   link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: <b>eno1</b>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
   link/ether 30:9c:23:ac:51:d0 brd ff:ff:ff:ff:ff:ff
   altname enp0s31f6
</pre>
<h3><span class=mw-headline id=Further_tuning>Further tuning</span></h3>
<p>More specialized virtual machine tuning tips are available at <a rel=nofollow class="external text" href=https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/virtualization_tuning_and_optimization_guide/index>Red Hat's Virtualization Tuning and Optimization Guide</a>.
</p>
<h2><span class=mw-headline id=Special_procedures>Special procedures</span></h2>
<p>Certain setups require specific configuration tweaks in order to work properly. If you are having problems getting your host or your virtual machine to work properly, see if your system matches one of the cases below and try adjusting your configuration accordingly.
</p>
<h3><span class=mw-headline id=Using_identical_guest_and_host_GPUs>Using identical guest and host GPUs</span></h3>
<div class="noprint archwiki-template-message">
<p><a href=https://wiki.archlinux.org/title/File:Tango-view-fullscreen.png class=image><img alt=Tango-view-fullscreen.png src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"><rect fill-opacity="0"/></svg>' decoding=async width=48 height=48 style="background-blend-mode:normal!important;background-clip:content-box!important;background-position:50% 50%!important;background-color:rgba(0,0,0,0)!important;background-image:var(--sf-img-15)!important;background-size:100% 100%!important;background-origin:content-box!important;background-repeat:no-repeat!important"></a><b>This article or section needs expansion.</b><a href=https://wiki.archlinux.org/title/File:Tango-view-fullscreen.png class=image><img alt=Tango-view-fullscreen.png src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"><rect fill-opacity="0"/></svg>' decoding=async width=48 height=48 style="background-blend-mode:normal!important;background-clip:content-box!important;background-position:50% 50%!important;background-color:rgba(0,0,0,0)!important;background-image:var(--sf-img-15)!important;background-size:100% 100%!important;background-origin:content-box!important;background-repeat:no-repeat!important"></a></p>
<div><b>Reason:</b> A number of users have been having issues with this, it should probably be adressed by the article. (Discuss in <a href=https://wiki.archlinux.org/title/Talk:PCI_passthrough_via_OVMF#Additionnal_sections title="Talk:PCI passthrough via OVMF">Talk:PCI passthrough via OVMF#Additionnal sections</a>)</div>
</div>
<p>Due to how vfio-pci uses your vendor and device id pair to identify which device they need to bind to at boot, if you have two GPUs sharing such an ID pair you will not be able to get your passthrough driver to bind with just one of them. This sort of setup makes it necessary to use a script, so that whichever driver you are using is instead assigned by pci bus address using the <code>driver_override</code> mechanism.
</p>
<h4><span class=mw-headline id=Script_variants>Script variants</span></h4>
<h5><span class=mw-headline id=Passthrough_all_GPUs_but_the_boot_GPU>Passthrough all GPUs but the boot GPU</span></h5>
<p>Here, we will make a script to bind vfio-pci to all GPUs but the boot gpu. Create the script <code>/usr/local/bin/vfio-pci-override.sh</code>:
</p>
<pre>#!/bin/sh

for i in /sys/bus/pci/devices/*/boot_vga; do
    if [ $(cat "$i") -eq 0 ]; then
        GPU="${i%/boot_vga}"
        AUDIO="$(echo "$GPU" | sed -e "s/0$/1/")"
        USB="$(echo "$GPU" | sed -e "s/0$/2/")"
        echo "vfio-pci" &gt; "$GPU/driver_override"
        if [ -d "$AUDIO" ]; then
            echo "vfio-pci" &gt; "$AUDIO/driver_override"
        fi
        if [ -d "$USB" ]; then
            echo "vfio-pci" &gt; "$USB/driver_override"
        fi
    fi
done

modprobe -i vfio-pci</pre>
<h5><span class=mw-headline id=Passthrough_selected_GPU>Passthrough selected GPU</span></h5>
<p>In this case we manually specify the GPU to bind.
</p>
<pre>#!/bin/sh

DEVS="0000:03:00.0 0000:03:00.1"

if [&nbsp;! -z "$(ls -A /sys/class/iommu)" ]; then
    for DEV in $DEVS; do
        echo "vfio-pci" &gt; /sys/bus/pci/devices/$DEV/driver_override
    done
fi

modprobe -i vfio-pci</pre>
<h5><span class=mw-headline id=Passthrough_IOMMU_Group_based_of_GPU>Passthrough IOMMU Group based of GPU</span></h5>
<p>Simplifying the passthrough of other necessary devices from selected GPU(s). 
Things like the graphicscard's onboard Audio, USB and RGB controllers.
</p>
<pre>#!/bin/sh

DEVS="0000:03:00.0"

if [&nbsp;! -z "$(ls -A /sys/class/iommu)" ]; then
    for DEV in $DEVS; do
        for IOMMUDEV in $(ls /sys/bus/pci/devices/$DEV/iommu_group/devices)&nbsp;; do
            echo "vfio-pci" &gt; /sys/bus/pci/devices/$IOMMUDEV/driver_override
        done
    done
fi

modprobe -i vfio-pci</pre>
<h4><span class=mw-headline id=Script_installation>Script installation</span></h4>
<p>Edit <code>/etc/mkinitcpio.conf</code>:
</p>
<ol><li>Add <code>modconf</code> to the <a href=https://wiki.archlinux.org/title/Mkinitcpio#HOOKS title=Mkinitcpio>HOOKS</a> array and <code>/usr/local/bin/vfio-pci-override.sh</code> to the <a href=https://wiki.archlinux.org/title/Mkinitcpio#BINARIES_and_FILES title=Mkinitcpio>FILES</a> array.</ol>
<p>Edit <code>/etc/modprobe.d/vfio.conf</code>:
</p>
<ol><li>Add the following line: <code>install vfio-pci /usr/local/bin/vfio-pci-override.sh</code></li>
<li><a href=https://wiki.archlinux.org/title/Regenerate_the_initramfs class=mw-redirect title="Regenerate the initramfs">Regenerate the initramfs</a> and reboot.</ol>
<h3><span class=mw-headline id=Passing_the_boot_GPU_to_the_guest>Passing the boot GPU to the guest</span></h3>
<div class="noprint archwiki-template-message">
<p><a href=https://wiki.archlinux.org/title/File:Tango-view-fullscreen.png class=image><img alt=Tango-view-fullscreen.png src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"><rect fill-opacity="0"/></svg>' decoding=async width=48 height=48 style="background-blend-mode:normal!important;background-clip:content-box!important;background-position:50% 50%!important;background-color:rgba(0,0,0,0)!important;background-image:var(--sf-img-15)!important;background-size:100% 100%!important;background-origin:content-box!important;background-repeat:no-repeat!important"></a><b>This article or section needs expansion.</b><a href=https://wiki.archlinux.org/title/File:Tango-view-fullscreen.png class=image><img alt=Tango-view-fullscreen.png src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"><rect fill-opacity="0"/></svg>' decoding=async width=48 height=48 style="background-blend-mode:normal!important;background-clip:content-box!important;background-position:50% 50%!important;background-color:rgba(0,0,0,0)!important;background-image:var(--sf-img-15)!important;background-size:100% 100%!important;background-origin:content-box!important;background-repeat:no-repeat!important"></a></p>
<div><b>Reason:</b> This is related to VBIOS issues and should be moved into a separate section regarding VBIOS compatibility. (Discuss in <a href=https://wiki.archlinux.org/title/Talk:PCI_passthrough_via_OVMF#UEFI_(OVMF)_Compatibility_in_VBIOS title="Talk:PCI passthrough via OVMF">Talk:PCI passthrough via OVMF#UEFI (OVMF) Compatibility in VBIOS</a>)</div>
</div>
<p>The GPU marked as <code>boot_vga</code> is a special case when it comes to doing PCI passthroughs, since the BIOS needs to use it in order to display things like boot messages or the BIOS configuration menu. To do that, it makes <a rel=nofollow class="external text" href=https://www.redhat.com/archives/vfio-users/2016-May/msg00224.html>a copy of the VGA boot ROM which can then be freely modified</a>. This modified copy is the version the system gets to see, which the passthrough driver may reject as invalid. As such, it is generally recommended to change the boot GPU in the BIOS configuration so the host GPU is used instead or, if that is not possible, to swap the host and guest cards in the machine itself.
</p>
<h3><span class=mw-headline id=Using_Looking_Glass_to_stream_guest_screen_to_the_host>Using Looking Glass to stream guest screen to the host</span></h3>
<p>It is possible to make a virtual machine share the monitor, and optionally a keyboard and a mouse with a help of <a rel=nofollow class="external text" href=https://looking-glass.io/>Looking Glass</a>.
</p>
<h4><span class=mw-headline id=Adding_IVSHMEM_Device_to_virtual_machines>Adding IVSHMEM Device to virtual machines</span></h4>
<p>Looking glass works by creating a shared memory buffer between a host and a guest. This is a lot faster than streaming frames via localhost, but requires additional setup. 
<p>With your virtual machine turned off open the machine configuration
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>...
&lt;devices&gt;
    ...
  &lt;shmem name='looking-glass'&gt;
    &lt;model type='ivshmem-plain'/&gt;
    &lt;size unit='M'&gt;32&lt;/size&gt;
  &lt;/shmem&gt;
&lt;/devices&gt;
...</pre>
<p>You should replace 32 with your own calculated value based on what resolution you are going to pass through. It can be calculated like this:
</p>
<pre>width x height x 4 x 2 = total bytes
total bytes / 1024 / 1024 = total mebibytes + 10
</pre>
<p>For example, in case of 1920x1080
</p>
<pre>1920 x 1080 x 4 x 2 = 16,588,800 bytes
16,588,800 / 1024 / 1024 = 15.82 MiB + 10 = 25.82
</pre>
<p>The result must be <b>rounded up</b> to the nearest power of two, and since 25.82 is bigger than 16 we should choose 32.
<p>Next create a configuration file to create the shared memory file on boot
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>/etc/tmpfiles.d/10-looking-glass.conf</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>f	/dev/shm/looking-glass	0660	<b>user</b>	kvm	-</pre>
<p>Replace user with your username.
<p>Ask systemd-tmpfiles to create the shared memory file now without waiting to next boot
</p>
<pre># systemd-tmpfiles --create /etc/tmpfiles.d/10-looking-glass.conf
</pre>
<h4><span class=mw-headline id=Installing_the_IVSHMEM_Host_to_Windows_guest>Installing the IVSHMEM Host to Windows guest</span></h4>
<p>Currently Windows would not notify users about a new IVSHMEM device, it would silently install a dummy driver. To actually enable the device you have to go into device manager and update the driver for the device under the "System Devices" node for <b>"PCI standard RAM Controller"</b>. Download the signed driver <a rel=nofollow class="external text" href=https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/upstream-virtio/>from Red Hat</a>.
<p>Once the driver is installed you must download a matching <a rel=nofollow class="external text" href=https://looking-glass.io/downloads>looking-glass-host</a> package that matches the client you will install from AUR, and install it on your guest. In order to run it you would also need to install Microsoft Visual C++ Redistributable from <a rel=nofollow class="external text" href=https://www.visualstudio.com/downloads/>Microsoft</a>. The recent version will automatically install a service that starts the daemon on boot. The logs of the host daemon are located at <code>%ProgramData%\Looking Glass (host)\looking-glass-host.txt</code> on the guest system.
</p>
<h4><span class=mw-headline id=Setting_up_the_null_video_device>Setting up the null video device</span></h4>
<p>(Retrieved from: <a rel=nofollow class="external free" href=https://looking-glass.io/docs/stable/install/#spice-server>https://looking-glass.io/docs/stable/install/#spice-server</a>)
<p>If you would like to use Spice to give you keyboard and mouse input along with clipboard sync support, make sure you have a <code>&lt;graphics type='spice'&gt;</code> device, then:
</p>
<ul><li>Find your <code>&lt;video&gt;</code> device, and set <code>&lt;model type='none'/&gt;</code></li>
<li>If you cannot find it, make sure you have a <code>&lt;graphics&gt;</code> device, save and edit again</ul>
<h4><span class=mw-headline id=Getting_a_client>Getting a client</span></h4>
<p>Looking glass client can be installed from AUR using <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href=https://aur.archlinux.org/packages/looking-glass/>looking-glass</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href=https://aur.archlinux.org/packages/looking-glass-git/>looking-glass-git</a></span><sup><small>AUR</small></sup> packages.
<p>You can start it once the virtual machine is set up and running
</p>
<pre>$ looking-glass-client
</pre>
<p>If you do not want to use Spice to control the guest mouse and keyboard you can disable the Spice server.
</p>
<pre>$ looking-glass-client -s
</pre>
<p>Additionally you may want to start Looking Glass Client as full screen, otherwise the image may be scaled down resulting in poor image fidelity.
</p>
<pre>$ looking-glass-client -F
</pre>
<p>Launch with the <code>--help</code> option for further information.
</p>
<h4><span class=mw-headline id=Additional_information>Additional information</span></h4>
<p>Refer to the <a rel=nofollow class="external text" href=https://looking-glass.io/wiki/Installation>upstream documentation</a> for further details.
</p>
<h3><span class=mw-headline id=Swap_peripherals_to_and_from_the_Host>Swap peripherals to and from the Host</span></h3>
<p>Looking Glass includes a Spice client in order to control mouse movement on the Windows guest. However this may have too much latency for certain applications, such as gaming. An alternative method is passing through specific USB devices for minimal latency. This allows for switching the devices between host and guest.
<p>First create a .xml file for the device(s) you wish to pass-through, which libvirt will use to identify the device.
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>~/.VFIOinput/input_1.xml</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>&lt;hostdev mode='subsystem' type='usb' managed='no'&gt;
&lt;source&gt;
&lt;vendor id='0x[Before Colon]'/&gt;
&lt;product id='0x[After Colon]'/&gt;
&lt;/source&gt;
&lt;/hostdev&gt;</pre>
<p>Replace [Before/After Colon] with the contents of the 'lsusb' command, specific to the device you want to pass-through.
<p>For instance my mouse is <code>Bus 005 Device 002: ID 1532:0037 Razer USA, Ltd</code> so I would replace <code>vendor id</code> with 1532, and <code>product id</code> with 0037.
<p>Repeat this process for any additional USB devices you want to pass-through. If your mouse / keyboard has multiple entries in <code>lsusb</code>, perhaps if it is wireless, then create additional xml files for each.
</p>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> Do not forget to change the path &amp; name of the script(s) above and below to match your user and specific system.</div>
<p>Next a bash script file is needed to tell libvirt what to attach/detach the USB devices to the guest.
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>~/.VFIOinput/input_attach.sh</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>#!/bin/sh

virsh attach-device [VirtualMachine-Name] [USBdevice]</pre>
<p>Replace [VirtualMachine-Name] with the name of your virtual machine, which can be seen under virt-manager. Additionally replace [USBdevice] with the <b>full</b> path to the .xml file for the device you wish to pass-through. Add additional lines for more than 1 device. For example here is my script:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>~/.VFIOinput/input_attach.sh</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>#!/bin/sh

virsh attach-device win10 /home/$USER/.VFIOinput/input_mouse.xml
virsh attach-device win10 /home/$USER/.VFIOinput/input_keyboard.xml</pre>
<p>Next duplicate the script file and replace <code>attach-device</code> with <code>detach-device</code>. Ensure both scripts are <a href=https://wiki.archlinux.org/title/Executable class=mw-redirect title=Executable>executable</a>.
<p>This 2 script files can now be executed to attach or detach your USB devices from the host to the guest virtual machine. It is important to note that they may need to be executed as root. To run the script from the Windows virtual machine, one possibility is using <a href=https://wiki.archlinux.org/title/PuTTY title=PuTTY>PuTTY</a> to <a href=https://wiki.archlinux.org/title/SSH class=mw-redirect title=SSH>SSH</a> into the host, and execute the script. On Windows PuTTY comes with plink.exe which can execute singular commands over SSH before then logging out, instead of opening a SSH terminal, all in the background.
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>detach_devices.bat</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>"C:\Program Files\PuTTY\plink.exe" root@$HOST_IP -pw $ROOTPASSWORD /home/$USER/.VFIOinput/input_detach.sh</pre>
<p>Replace <code>$HOST_IP</code> with the Host <a href=https://wiki.archlinux.org/title/Network_configuration#IP_addresses title="Network configuration">IP Address</a> and $ROOTPASSWORD with the root password.
</p>
<div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning:</strong> This method is insecure if somebody has access to your virtual machine, since they could open the file and read your password. It is advisable to use <a href=https://wiki.archlinux.org/title/SSH_keys title="SSH keys">SSH keys</a> instead!</div>
<p>You may also want to execute the script files using key binds. On Windows one option is <a rel=nofollow class="external text" href=https://autohotkey.com/>Autohotkey</a>, and on the Host <a href=https://wiki.archlinux.org/title/Xbindkeys title=Xbindkeys>Xbindkeys</a>. Because of the need to run the scripts as root, you may also need to use <a href=https://wiki.archlinux.org/title/Polkit title=Polkit>Polkit</a> or <a href=https://wiki.archlinux.org/title/Sudo title=Sudo>Sudo</a> which can both be used to authenticate specific executables as able to run as root without needing a password.
</p>
<h3><span id=Bypassing_the_IOMMU_groups_.28ACS_override_patch.29></span><span class=mw-headline id=Bypassing_the_IOMMU_groups_(ACS_override_patch)>Bypassing the IOMMU groups (ACS override patch)</span></h3>
<p>If you find your PCI devices grouped among others that you do not wish to pass through, you may be able to seperate them using Alex Williamson's ACS override patch. Make sure you understand <a rel=nofollow class="external text" href=https://vfio.blogspot.com/2014/08/iommu-groups-inside-and-out.html>the potential risk</a> of doing so. 
<p>You will need a kernel with the patch applied. The easiest method to acquiring this is through the <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=linux-zen">linux-zen</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href=https://aur.archlinux.org/packages/linux-vfio/>linux-vfio</a></span><sup><small>AUR</small></sup> package.
<p>In addition, the ACS override patch needs to be enabled with kernel command line options. The patch file adds the following documentation:
</p>
<pre>pcie_acs_override =
        [PCIE] Override missing PCIe ACS support for:
    downstream
        All downstream ports - full ACS capabilties
    multifunction
        All multifunction devices - multifunction ACS subset
    id:nnnn:nnnn
        Specfic device - full ACS capabilities
        Specified as vid:did (vendor/device ID) in hex
</pre>
<p>The option <code>pcie_acs_override=downstream,multifunction</code> should break up as many devices as possible.
<p>After installation and configuration, reconfigure your <a href=https://wiki.archlinux.org/title/Kernel_parameters title="Kernel parameters">bootloader kernel parameters</a> to load the new kernel with the <code>pcie_acs_override=</code> option enabled.
</p>
<h2><span class=mw-headline id=Plain_QEMU_without_libvirt>Plain QEMU without libvirt</span></h2>
<p>Instead of setting up a virtual machine with the help of libvirt, plain QEMU commands with custom parameters can be used for running the virtual machine intended to be used with PCI passthrough. This is desirable for some use cases like scripted setups, where the flexibility for usage with other scripts is needed.
<p>To achieve this after <a href=#Setting_up_IOMMU>#Setting up IOMMU</a> and <a href=#Isolating_the_GPU>#Isolating the GPU</a>, follow the <a href=https://wiki.archlinux.org/title/QEMU title=QEMU>QEMU</a> article to setup the virtualized environment, <a href=https://wiki.archlinux.org/title/QEMU#Enabling_KVM title=QEMU>enable KVM</a> on it and use the flag <code>-device vfio-pci,host=07:00.0</code> replacing the identifier (07:00.0) with your actual device's ID that you used for the GPU isolation earlier.
<p>For utilizing the OVMF firmware, make sure the <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=edk2-ovmf">edk2-ovmf</a></span> package is installed, copy the UEFI variables from <code>/usr/share/edk2-ovmf/x64/OVMF_VARS.fd</code> to temporary location like <code>/tmp/MY_VARS.fd</code> and finally specify the OVMF paths by appending the following parameters to the QEMU command (order matters):
</p>
<ul><li><code>-drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2-ovmf/x64/OVMF_CODE.fd</code> for the actual OVMF firmware binary, note the readonly option</li>
<li><code>-drive if=pflash,format=raw,file=/tmp/MY_VARS.fd</code> for the variables</ul>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> 
<ul><li>Make sure that <code>OVMF_CODE.fd</code> is given as a command line parameter before <code>MY_VARS.fd</code>. The boot sequence will fail otherwise.</li>
<li>QEMU's default SeaBIOS can be used instead of OVMF, but it is not recommended as it can cause issues with passthrough setups.</ul>
</div>
<p>It is recommended to study the QEMU article for ways to enhance the performance by using the <a href=https://wiki.archlinux.org/title/QEMU#Installing_virtio_drivers title=QEMU>virtio drivers</a> and other further configurations for the setup.
<p>You also might have to use the <code>-cpu host,kvm=off</code> parameter to forward the host's CPU model info to the virtual machine and fool the virtualization detection used by Nvidia's and possibly other manufacturers' device drivers trying to block the full hardware usage inside a virtualized system.
</p>
<h2><span class=mw-headline id=Passing_through_other_devices>Passing through other devices</span></h2>
<h3><span class=mw-headline id=USB_controller>USB controller</span></h3>
<p>If your motherboard has multiple USB controllers mapped to multiple groups, it is possible to pass those instead of USB devices. Passing an actual controller over an individual USB device provides the following advantages&nbsp;: 
</p>
<ul><li>If a device disconnects or changes ID over the course of an given operation (such as a phone undergoing an update), the virtual machine will not suddenly stop seeing it.</li>
<li>Any USB port managed by this controller is directly handled by the virtual machine and can have its devices unplugged, replugged and changed without having to notify the hypervisor.</li>
<li>Libvirt will not complain if one of the USB devices you usually pass to the guest is missing when starting the virtual machine.</ul>
<p>Unlike with GPUs, drivers for most USB controllers do not require any specific configuration to work on a virtual machine and control can normally be passed back and forth between the host and guest systems with no side effects.
</p>
<div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning:</strong> Make sure your USB controller supports resetting: <a href=#Passing_through_a_device_that_does_not_support_resetting>#Passing through a device that does not support resetting</a></div>
<p>You can find out which USB devices correspond to which controller and how various ports and devices are assigned to each one of them using this command:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ for usb_ctrl in /sys/bus/pci/devices/*/usb*; do pci_path=${usb_ctrl%/*}; iommu_group=$(readlink $pci_path/iommu_group); echo "Bus $(cat $usb_ctrl/busnum) --&gt; ${pci_path##*/} (IOMMU group ${iommu_group##*/})"; lsusb -s ${usb_ctrl#*/usb}:; echo; done</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>Bus 1 --&gt; 0000:00:1a.0 (IOMMU group 4)
Bus 001 Device 004: ID 04f2:b217 Chicony Electronics Co., Ltd Lenovo Integrated Camera (0.3MP)
Bus 001 Device 007: ID 0a5c:21e6 Broadcom Corp. BCM20702 Bluetooth 4.0 [ThinkPad]
Bus 001 Device 008: ID 0781:5530 SanDisk Corp. Cruzer
Bus 001 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub

Bus 2 --&gt; 0000:00:1d.0 (IOMMU group 9)
Bus 002 Device 006: ID 0451:e012 Texas Instruments, Inc. TI-Nspire Calculator
Bus 002 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub
Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</pre>
<p>This laptop has 3 USB ports managed by 2 USB controllers, each with their own IOMMU group. In this example, Bus 001 manages a single USB port (with a SanDisk USB pendrive plugged into it so it appears on the list), but also a number of internal devices, such as the internal webcam and the bluetooth card. Bus 002, on the other hand, does not apprear to manage anything except for the calculator that is plugged into it. The third port is empty, which is why it does not show up on the list, but is actually managed by Bus 002.
<p>Once you have identified which controller manages which ports by plugging various devices into them and decided which one you want to passthrough, simply add it to the list of PCI host devices controlled by the virtual machine in your guest configuration. No other configuration should be needed.
</p>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> If your USB controller does not support resetting, is not in an isolated group, or is otherwise unable to be passed through then it may still be possible to accomplish similar results through <a href=https://wiki.archlinux.org/title/Udev title=Udev>udev</a> rules. See <a rel=nofollow class="external autonumber" href=https://github.com/olavmrk/usb-libvirt-hotplug>[5]</a> which allows any device connected to specified USB ports to be automatically attached to a virtual machine.</div>
<h3><span class=mw-headline id=Passing_audio_from_virtual_machine_to_host_via_PulseAudio>Passing audio from virtual machine to host via PulseAudio</span></h3>
<p>It is possible to route the virtual machine's audio to the host as an application using libvirt. This has the advantage of multiple audio streams being routable to one host output, and working with audio output devices that do not support passthrough. <a href=https://wiki.archlinux.org/title/PulseAudio title=PulseAudio>PulseAudio</a> is required for this to work.
<p>First, remove the comment from the <code>#user = ""</code> line. Then add your username in the quotations. This tells QEMU which user's pulseaudio stream to route through.
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>/etc/libvirt/qemu.conf</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>user = "example"</pre>
<p>An emulated audio setup consists of two components: An emulated sound device exposed to the guest and an audio backend connecting the sound device to the host's PulseAudio.
<p>Of the emulated sound devices available, two are of main interest: ICH9 and usb-audio. ICH9 features both output and input but is limited to stereo. usb-audio only features audio output but supports up to 6 channels in 5.1 configuration. For ICH9 remove any pre-existing audio backend in the <code>&lt;devices&gt;</code> section and add:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>    &lt;sound model='ich9'&gt;
      &lt;codec type='micro'/&gt;
      &lt;audio id='1'/&gt;
    &lt;/sound&gt;
    &lt;audio id='1' type='pulseaudio' serverName='/run/user/1000/pulse/native'/&gt;</pre>
<p>Note the matching <code>id</code> elements. The example above assumes a single-user system with user ID 1000. Use the <code>id</code> command to find the correct ID. You can also use the <code>/tmp</code> directory if you have multiple users accessing PulseAudio:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>    &lt;audio id='1' type='pulseaudio' serverName='unix:/tmp/pulse-socket'/&gt;</pre>
<p>If you get crackling or distorted sound, try experimenting with some latency settings. The following example uses 20000 microseconds:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>    &lt;audio id="1" type="pulseaudio" serverName="/run/user/1000/pulse/native"&gt;
      &lt;input latency="20000"/&gt;
      &lt;output latency="20000"/&gt;
    &lt;/audio&gt;</pre>
<p>You can also try disabling the software mixer included in QEMU. This should, in theory, be more efficient and allow for lower latencies since mixing will then take place on your host only:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>    &lt;audio id="1" type="pulseaudio" serverName="/run/user/1000/pulse/native"&gt;
      &lt;input mixingEngine="no"/&gt;
      &lt;output mixingEngine="no"/&gt;
    &lt;/audio&gt;</pre>
<p>For usb-audio, the corresponding elements read
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>    &lt;sound model='usb'&gt;
      &lt;audio id='1'/&gt;
    &lt;/sound&gt;
    &lt;audio id='1' type='pulseaudio' serverName='/run/user/1000/pulse/native'/&gt;</pre>
<p>However, if a 5.1 configuration is required the sound device needs to be configured via QEMU command line arguments:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>  &lt;/devices&gt;
  &lt;qemu:commandline&gt;
    &lt;qemu:arg value='-device'/&gt;
    &lt;qemu:arg value='usb-audio,id=sound0,audiodev=audio1,multi=on'/&gt;
  &lt;/qemu:commandline&gt;
&lt;/domain&gt;</pre>
<p>The <code>audiodev</code> tag has to be set to match the audio backend's <code>id</code> element. <code>id='1'</code> corresponds to <code>audio1</code> and so on. 
</p>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> 
<ul><li>You can have multiple audio backends, by simply specifying <code>&lt;audio&gt;</code>/<code>-audiodev</code> multiple times in your XML and by assigning them different ids. This can be useful for a use case of having two identical backends. With PulseAudio each backend is a separate stream and can be routed to different output devices on the host (using a pulse mixer like <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=pavucontrol">pavucontrol</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=pulsemixer">pulsemixer</a></span>).</li>
<li>USB 3 emulation is needed in Libvirt/QEMU to enable the usb-audio.</li>
<li>It is recommended to enable MSI interrupts with a tool such as <a rel=nofollow class="external autonumber" href=https://forums.guru3d.com/threads/windows-line-based-vs-message-signaled-based-interrupts-msi-tool.378044/>[6]</a> on the ICH9 audio device to mitigate any crackling, stuttering, speedup, or no audio at all after virtual machine restart.</li>
<li>If audio is crackling/stuttering/speedup etc. is still present you may want to adjust parameters such as <code>buffer-length</code> and <code>timer-period</code>, more information on these parameters and more can be found in the <span class="plainlinks archwiki-template-man" title="$ man 1 qemu"><a rel=nofollow class="external text" href=https://man.archlinux.org/man/qemu.1>qemu(1)</a></span> manual.</li>
<li>Some audio chipsets such as <a rel=nofollow class="external text" href="https://bugzilla.kernel.org/show_bug.cgi?id=195303">Realtek alc1220</a> may also have issues out of the box so do consider this when using any audio emulation with QEMU.</li>
<li>Improper pinning or heavy host usage without using <a href=#Isolating_pinned_CPUs>isolcpus</a> can also influence sound bugs, especially while gaming in a virtual machine.</ul></div>
<h3><span class=mw-headline id=Passing_audio_from_virtual_machine_to_host_via_JACK_and_PipeWire>Passing audio from virtual machine to host via JACK and PipeWire</span></h3>
<p>It is also possible to pass the virtual machine's audio to the host via JACK and PipeWire.
<p>First, make sure you have a working <a href=https://wiki.archlinux.org/title/PipeWire title=PipeWire>PipeWire</a> setup with <a href=https://wiki.archlinux.org/title/PipeWire#JACK_clients title=PipeWire>JACK support</a>.
<p>Next, you will need to tell libvirt to run QEMU as your user:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>/etc/libvirt/qemu.conf</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>user = "example"</pre>
<p>As a final preparation, the XML scheme has to be extended to allow passing of environment variables. For this, modify the virtual machine domain configuration
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>&lt;domain type='kvm'&gt;</pre>
<p>to
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>&lt;domain type='kvm' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'&gt;</pre>
<p>Then, you can add the actual audio config to your virtual machine:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>    &lt;devices&gt;
    ...
      &lt;audio id="1" type="jack"&gt;
        &lt;input clientName="vm-win10" connectPorts="your-input"/&gt;
        &lt;output clientName="vm-win10" connectPorts="your-output"/&gt;
      &lt;/audio&gt;
    &lt;/devices&gt;
      &lt;qemu:commandline&gt;
        &lt;qemu:env name="PIPEWIRE_RUNTIME_DIR" value="/run/user/1000"/&gt;
        &lt;qemu:env name="PIPEWIRE_LATENCY" value="512/48000"/&gt;
      &lt;/qemu:commandline&gt;
 &lt;/domain&gt;</pre>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> Use a tool like <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=carla">carla</a></span> to figure out which input and outputs you want.</div>
<p>Note the matching <code>id</code> elements. Above's example assumes a single-user system with user ID 1000. Use the <code>id</code> command to find the correct ID.
<p>You might have to play with the <code>PIPEWIRE_LATENCY</code> values to get to the desired latency without crackling.
</p>
<h3><span class=mw-headline id=Passing_audio_from_virtual_machine_to_host_via_Scream>Passing audio from virtual machine to host via Scream</span></h3>
<p>It is possible to pass the virtual machine's audio through a bridged network such as the one provided by Libvirt or by adding a IVSHMEM device to the host by using a application called <a rel=nofollow class="external text" href=https://github.com/duncanthrax/scream>Scream</a>. This section will only cover using PulseAudio as a receiver on the host.
See the project page for more details and instructions on other methods.
</p>
<h4><span class=mw-headline id=Using_Scream_with_a_bridged_network>Using Scream with a bridged network</span></h4>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> 
<ul><li>This is the <i>preferred</i> way to use this, although results may vary per user</li>
<li>It is recommend to use the <a href=#Virtio_network>#Virtio network</a> adapter while using Scream, other virtual adapters provided by QEMU such as <b>e1000e</b> may lead to poor performance</ul>
</div>
<p>To use scream via your network you will want to find your bridge name via <code>ip a</code>, in most cases it will be called <b>br0</b> or <b>virbr0</b>. Below is a example of the command needed to start the Scream application:
</p>
<pre>$ scream -o pulse -i virbr0 &amp;
</pre>
<div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning:</strong> This will not work with a <b>macvtap bridge</b> as that does not allow host to guest communication, also make sure you have the proper firewall ports open for it to communicate with the virtual machine</div>
<h4><span class=mw-headline id=Adding_the_IVSHMEM_device_to_use_Scream_with_IVSHMEM>Adding the IVSHMEM device to use Scream with IVSHMEM</span></h4>
<p>With the virtual machine turned off, edit the machine configuration
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ virsh edit <i>vmname</i></pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>...
&lt;devices&gt;
    ...
  &lt;shmem name='scream-ivshmem'&gt;
    &lt;model type='ivshmem-plain'/&gt;
    &lt;size unit='M'&gt;2&lt;/size&gt;
  &lt;/shmem&gt;
&lt;/devices&gt;
...</pre>
<p>In the above configuration, the size of the IVSHMEM device is 2MB (the recommended amount). Change this as needed.
<p>Now refer to <a href=#Adding_IVSHMEM_Device_to_virtual_machines>#Adding IVSHMEM Device to virtual machines</a> to configure the host to create the shared memory file on boot, replacing <code>looking-glass</code> with <code>scream-ivshmem</code>.
</p>
<h5><span class=mw-headline id=Configuring_the_Windows_guest_for_IVSHMEM>Configuring the Windows guest for IVSHMEM</span></h5>
<p>The correct driver must be installed for the IVSHMEM device on the guest. 
See <a href=#Installing_the_IVSHMEM_Host_to_Windows_guest>#Installing the IVSHMEM Host to Windows guest</a>. Ignore the part about <code>looking-glass-host</code>.
<p>Install the <a rel=nofollow class="external text" href=https://github.com/duncanthrax/scream/releases>Scream</a> virtual audio driver on the guest. 
If you have secure boot enabled for your virtual machine, you may need to disable it. 
<p>Using the registry editor, set the DWORD <code>HKLM\SYSTEM\CurrentControlSet\Services\Scream\Options\UseIVSHMEM</code> to the size of the IVSHMEM device in MB.
Note that scream identifies its IVSHMEM device using its size, so make sure there is only one device of that size (the suggested default is <code>2</code> for 2MB).
<p>Use the following command in an admin CMD shell to create both key and DWORD: <code>REG ADD HKLM\SYSTEM\CurrentControlSet\Services\Scream\Options /v UseIVSHMEM /t REG_DWORD /d 2</code> (<a rel=nofollow class="external text" href=https://github.com/duncanthrax/scream>sourced from scream on Github</a>)
</p>
<h6><span class=mw-headline id=Configuring_the_host>Configuring the host</span></h6>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href=https://aur.archlinux.org/packages/scream/>scream</a></span><sup><small>AUR</small></sup>.
<p>Create a <a href=https://wiki.archlinux.org/title/Systemd/User title=Systemd/User>systemd user service</a> to control the receiver:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>~/.config/systemd/user/scream-ivshmem-pulse.service</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>[Unit]
Description=Scream IVSHMEM pulse receiver
After=pulseaudio.service
Wants=pulseaudio.service

[Service]
Type=simple
ExecStartPre=/usr/bin/truncate -s 0 /dev/shm/scream-ivshmem
ExecStartPre=/usr/bin/dd if=/dev/zero of=/dev/shm/scream-ivshmem bs=1M count=2
ExecStart=/usr/bin/scream -m /dev/shm/scream-ivshmem

[Install]
WantedBy=default.target</pre>
<p>Edit <code>count=2</code> with the size of the IVSHMEM device in MiB.
</p>
<div class="archwiki-template-box archwiki-template-box-tip"><strong>Tip:</strong> If you are using <a href=https://wiki.archlinux.org/title/PipeWire title=PipeWire>PipeWire</a>, replace <code>pulseaudio.service</code> with <code>pipewire-pulse.service</code>.</div>
<p>Now <a href=https://wiki.archlinux.org/title/Start class=mw-redirect title=Start>start</a> the <code>scream-ivshmem-pulse.service</code> <a href=https://wiki.archlinux.org/title/User_unit class=mw-redirect title="User unit">user unit</a>.
<p>To have it automatically start on next login, <a href=https://wiki.archlinux.org/title/Enable class=mw-redirect title=Enable>enable</a> the <a href=https://wiki.archlinux.org/title/User_unit class=mw-redirect title="User unit">user unit</a>.
</p>
<h3><span id=Physical_disk.2Fpartition></span><span class=mw-headline id=Physical_disk/partition>Physical disk/partition</span></h3>
<p>Raw and qcow2 especially can have noticeable overhead for heavy IO. A whole disk or a partition may be used directly to bypass the filesystem and improve I/O performance. If you wish to dual boot the guest OS natively you would need to pass the entire disk without any partitioning. It is suggested to use /dev/disk/by- paths to refer to the disk since /dev/sdX entries can change between boots. To find out which disk/partition is associated with the one you would like to pass:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ ls -l /dev/disk/by-id/*</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>/dev/disk/by-id/ata-ST1000LM002-9VQ14L_Z0501SZ9 -&gt; ../../sdd
</pre>
<p>See <a href=#Virtio_disk>#Virtio disk</a> on how to add these with libvirt XML. You can also add the disk with Virt-Manager's <b>Add Hardware</b> menu and then type the disk you want in the <b>Select or create custom storage</b> box, e.g. <b>/dev/disk/by-id/ata-ST1000LM002-9VQ14L_Z0501SZ9</b>
</p>
<h3><span class=mw-headline id=Gotchas_3>Gotchas</span></h3>
<h4><span class=mw-headline id=Passing_through_a_device_that_does_not_support_resetting>Passing through a device that does not support resetting</span></h4>
<p>When the virtual machine shuts down, all devices used by the guest are deinitialized by its OS in preparation for shutdown. In this state, those devices are no longer functional and must then be power-cycled before they can resume normal operation. Linux can handle this power-cycling on its own, but when a device has no known reset methods, it remains in this disabled state and becomes unavailable. Since Libvirt and Qemu both expect all host PCI devices to be ready to reattach to the host before completely stopping the virtual machine, when encountering a device that will not reset, they will hang in a "Shutting down" state where they will not be able to be restarted until the host system has been rebooted. It is therefore recommended to only pass through PCI devices which the kernel is able to reset, as evidenced by the presence of a <code>reset</code> file in the PCI device sysfs node, such as <code>/sys/bus/pci/devices/0000:00:1a.0/reset</code>.
<p>The following bash command shows which devices can and cannot be reset.
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>for iommu_group in $(find /sys/kernel/iommu_groups/ -maxdepth 1 -mindepth 1 -type d);do echo "IOMMU group $(basename "$iommu_group")"; for device in $(\ls -1 "$iommu_group"/devices/); do if [[ -e "$iommu_group"/devices/"$device"/reset ]]; then echo -n "[RESET]"; fi; echo -n $'\t';lspci -nns "$device"; done; done</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>IOMMU group 0
	00:00.0 Host bridge [0600]: Intel Corporation Xeon E3-1200 v2/Ivy Bridge DRAM Controller [8086:0158] (rev 09)
IOMMU group 1
	00:01.0 PCI bridge [0604]: Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor PCI Express Root Port [8086:0151] (rev 09)
	01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK208 [GeForce GT 720] [10de:1288] (rev a1)
	01:00.1 Audio device [0403]: NVIDIA Corporation GK208 HDMI/DP Audio Controller [10de:0e0f] (rev a1)
IOMMU group 2
	00:14.0 USB controller [0c03]: Intel Corporation 7 Series/C210 Series Chipset Family USB xHCI Host Controller [8086:1e31] (rev 04)
IOMMU group 4
[RESET]	00:1a.0 USB controller [0c03]: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #2 [8086:1e2d] (rev 04)
IOMMU group 5
[RESET]	00:1b.0 Audio device [0403]: Intel Corporation 7 Series/C210 Series Chipset Family High Definition Audio Controller [8086:1e20] (rev 04)
IOMMU group 10
[RESET]	00:1d.0 USB controller [0c03]: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #1 [8086:1e26] (rev 04)
IOMMU group 13
	06:00.0 VGA compatible controller [0300]: NVIDIA Corporation GM204 [GeForce GTX 970] [10de:13c2] (rev a1)
	06:00.1 Audio device [0403]: NVIDIA Corporation GM204 High Definition Audio Controller [10de:0fbb] (rev a1)
</pre>
<p>This signals that the xHCI USB controller in 00:14.0 cannot be reset and will therefore stop the virtual machine from shutting down properly, while the integrated sound card in 00:1b.0 and the other two controllers in 00:1a.0 and 00:1d.0 do not share this problem and can be passed without issue.
</p>
<h2><span class=mw-headline id=Complete_setups_and_examples>Complete setups and examples</span></h2>
<p>For many reasons users may seek to see <a href=https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF/Examples title="PCI passthrough via OVMF/Examples">complete passthrough setup examples</a>.
<p>These examples offer a supplement to existing hardware compatibility lists. Additionally, if you have trouble configuring a certain mechanism in your setup, you might find these examples very valuable. Users there have described their setups in detail, and some have provided examples of their configuration files as well. 
<p>We encourage those who successfully build their system from this resource to help improve it by contributing their builds. Due to the many different hardware manufacturers involved, the seemingly significant lack of sufficient documentation, as well as other issues due to the nature of this process, community contributions are necessary.
</p>
<h2><span class=mw-headline id=Troubleshooting>Troubleshooting</span></h2>
<p>If your issue is not mentioned below, you may want to browse <a href=https://wiki.archlinux.org/title/QEMU#Troubleshooting title=QEMU>QEMU#Troubleshooting</a>.
</p>
<h3><span id=QEMU_4.0:_Unable_to_load_graphics_drivers.2FBSOD.2FGraphics_stutter_after_driver_install_using_Q35></span><span class=mw-headline id=QEMU_4.0:_Unable_to_load_graphics_drivers/BSOD/Graphics_stutter_after_driver_install_using_Q35>QEMU 4.0: Unable to load graphics drivers/BSOD/Graphics stutter after driver install using Q35</span></h3>
<p>Starting with QEMU 4.0, the Q35 machine type changes the default <code>kernel_irqchip</code> from <code>off</code> to <code>split</code> which breaks some guest devices, such as nVidia graphics (the driver fails to load / black screen / code 43 / graphics stutters, usually when mouse moving). Switch to full KVM mode instead by adding <code>&lt;ioapic driver='kvm'/&gt;</code> under libvirt's <code>&lt;features&gt;</code> tag in your virtual machine configuration or by adding <code>kernel_irqchip=on</code> in the <code>-machine</code> QEMU arg.
</p>
<h3><span id=QEMU_5.0:_host-passthrough_with_kernel_version_5.5_to_5.8.1_when_using_Zen_2_processors:_Windows_10_BSOD_loop_.27KERNEL_SECURITY_CHECK_FAILURE.27></span><span class=mw-headline id="QEMU_5.0:_host-passthrough_with_kernel_version_5.5_to_5.8.1_when_using_Zen_2_processors:_Windows_10_BSOD_loop_'KERNEL_SECURITY_CHECK_FAILURE'">QEMU 5.0: host-passthrough with kernel version 5.5 to 5.8.1 when using Zen 2 processors: Windows 10 BSOD loop 'KERNEL SECURITY CHECK FAILURE'</span></h3>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> As of kernel version 5.8.2, disabling STIBP is not required anymore.</div>
<p>Starting with QEMU 5.0 virtual machines running on Zen 2 and newer kernels than 5.4 will cause a BSOD loop of: 'KERNEL SECURITY CHECK FAILURE'. This can be fixed by either updating to kernel version 5.8.2 or higher, or disabling STIBP:
</p>
<pre> &lt;cpu mode='host-passthrough' ...&gt;
   ...
   &lt;feature policy='disable' name='amd-stibp'/&gt;
   ...
 &lt;/cpu&gt;
</pre>
<p>This requires libvirt 6.5 or higher. On older versions, several workarounds exist:
</p>
<ul><li>Switch CPU mode from <code>host-passthrough</code> to <code>host-model</code>. This only works on libvirt 6.4 or lower.</li>
<li>Manually patch <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=qemu">qemu</a></span> in order to revert <a rel=nofollow class="external text" href=https://github.com/qemu/qemu/commit/143c30d4d346831a09e59e9af45afdca0331e819>this</a> commit.</li>
<li>On qemu commandline, add <code>amd-stibp=off</code> to the cpu flags string. This can also be invoked through libvirt via a <code>&lt;qemu:commandline&gt;</code> entry.</ul>
<h3><span id=.22Error_43:_Driver_failed_to_load.22_with_mobile_.28Optimus.2Fmax-q.29_nvidia_GPUs></span><span class=mw-headline id='"Error_43:_Driver_failed_to_load"_with_mobile_(Optimus/max-q)_nvidia_GPUs'>"Error 43: Driver failed to load" with mobile (Optimus/max-q) nvidia GPUs</span></h3>
<p>This error occurs because the Nvidia driver wants to check the status of the power supply. If no battery is present, the driver does not work. Whether Libvirt or Quemu, by default none of them provide the possibility to simulate a battery. This might also result in a reduced screen resolution and the Nvidia Desktop Manager refusing to load when right-clicking the desktop, saying it requires Windows 10, a compatible GPU and the Nvidia graphics driver.
<p>You can however create and add a custom acpi table file to the virtual machine which will do the work.
<p>First you have to create the custom acpi table file by pasting the following base64 string <a rel=nofollow class="external text" href=https://base64.guru/converter/decode/file>here</a> and save the result file as SSDT1.dat:
</p>
<pre>U1NEVKEAAAAB9EJPQ0hTAEJYUENTU0RUAQAAAElOVEwYEBkgoA8AFVwuX1NCX1BDSTAGABBMBi5f
U0JfUENJMFuCTwVCQVQwCF9ISUQMQdAMCghfVUlEABQJX1NUQQCkCh8UK19CSUYApBIjDQELcBcL
cBcBC9A5C1gCCywBCjwKPA0ADQANTElPTgANABQSX0JTVACkEgoEAAALcBcL0Dk=</pre>
<p>Next you must add the processed file to the main domain of the virtual machine:
</p>
<pre>&lt;domain xmlns:qemu="http://libvirt.org/schemas/domain/qemu/1.0" type="kvm"&gt;
  ...
  &lt;qemu:commandline&gt;
    &lt;qemu:arg value="-acpitable"/&gt;
    &lt;qemu:arg value="file=/path/to/your/SSDT1.dat"/&gt;
  &lt;/qemu:commandline&gt;
&lt;/domain&gt;
</pre>
<p>Make sure your XML file has the correct namespace in the <code>&lt;domain&gt;</code> tag as visible above, otherwise the XML verification will fail.
<p><a rel=nofollow class="external text" href=https://www.reddit.com/r/VFIO/comments/ebo2uk/nvidia_geforce_rtx_2060_mobile_success_qemu_ovmf/>Source</a>
</p>
<h3><span id=.22BAR_3:_cannot_reserve_.5Bmem.5D.22_error_in_dmesg_after_starting_virtual_machine></span><span class=mw-headline id='"BAR_3:_cannot_reserve_[mem]"_error_in_dmesg_after_starting_virtual_machine'>"BAR 3: cannot reserve [mem]" error in dmesg after starting virtual machine</span></h3>
<div class="noprint archwiki-template-message">
<p><a href=https://wiki.archlinux.org/title/File:Tango-view-fullscreen.png class=image><img alt=Tango-view-fullscreen.png src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"><rect fill-opacity="0"/></svg>' decoding=async width=48 height=48 style="background-blend-mode:normal!important;background-clip:content-box!important;background-position:50% 50%!important;background-color:rgba(0,0,0,0)!important;background-image:var(--sf-img-15)!important;background-size:100% 100%!important;background-origin:content-box!important;background-repeat:no-repeat!important"></a><b>This article or section needs expansion.</b><a href=https://wiki.archlinux.org/title/File:Tango-view-fullscreen.png class=image><img alt=Tango-view-fullscreen.png src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"><rect fill-opacity="0"/></svg>' decoding=async width=48 height=48 style="background-blend-mode:normal!important;background-clip:content-box!important;background-position:50% 50%!important;background-color:rgba(0,0,0,0)!important;background-image:var(--sf-img-15)!important;background-size:100% 100%!important;background-origin:content-box!important;background-repeat:no-repeat!important"></a></p>
<div><b>Reason:</b> This error is actually related to the boot_vgs issue and should be merged together with everything else concerning GPU ROMs. (Discuss in <a href=https://wiki.archlinux.org/title/Talk:PCI_passthrough_via_OVMF#UEFI_(OVMF)_Compatibility_in_VBIOS title="Talk:PCI passthrough via OVMF">Talk:PCI passthrough via OVMF#UEFI (OVMF) Compatibility in VBIOS</a>)</div>
</div>
<p>With respect to <a rel=nofollow class="external text" href=https://www.linuxquestions.org/questions/linux-kernel-70/kernel-fails-to-assign-memory-to-pcie-device-4175487043/>this article</a>:
<p>If you still have code 43 check <i>dmesg</i> for memory reservation errors after starting up your virtual machine, if you have similar it could be the case:
</p>
<pre>vfio-pci 0000:09:00.0: BAR 3: cannot reserve [mem 0xf0000000-0xf1ffffff 64bit pref]
</pre>
<p>Find out a PCI Bridge your graphic card is connected to. This will give actual hierarchy of devices:
</p>
<pre>$ lspci -t
</pre>
<p>Before starting the virtual machine run the following lines, replacing IDs with actual values from previous output.
</p>
<pre># echo 1 &gt; /sys/bus/pci/devices/0000\:00\:03.1/remove
# echo 1 &gt; /sys/bus/pci/rescan
</pre>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> Probably setting <a href=https://wiki.archlinux.org/title/Kernel_parameter class=mw-redirect title="Kernel parameter">kernel parameter</a> <code>video=efifb:off</code> is required as well. <a rel=nofollow class="external text" href=https://pve.proxmox.com/wiki/Pci_passthrough#BAR_3:_can.27t_reserve_.5Bmem.5D_error>Source</a></div>
<p>In addition try adding kernel parameter <code>pci=realloc</code> which also <a rel=nofollow class="external text" href=https://github.com/Dunedan/mbp-2016-linux/issues/60#issuecomment-396311301>helps with hotplugging issues</a>.
</p>
<h3><span id=UEFI_.28OVMF.29_compatibility_in_VBIOS></span><span class=mw-headline id=UEFI_(OVMF)_compatibility_in_VBIOS>UEFI (OVMF) compatibility in VBIOS</span></h3>
<div class="noprint archwiki-template-message">
<p><a href=https://wiki.archlinux.org/title/File:Tango-edit-cut.png class=image><img alt=Tango-edit-cut.png src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"><rect fill-opacity="0"/></svg>' decoding=async width=48 height=48 style="background-blend-mode:normal!important;background-clip:content-box!important;background-position:50% 50%!important;background-color:rgba(0,0,0,0)!important;background-image:var(--sf-img-16)!important;background-size:100% 100%!important;background-origin:content-box!important;background-repeat:no-repeat!important"></a><b>This section is being considered for removal.</b><a href=https://wiki.archlinux.org/title/File:Tango-edit-cut.png class=image><img alt=Tango-edit-cut.png src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"><rect fill-opacity="0"/></svg>' decoding=async width=48 height=48 style="background-blend-mode:normal!important;background-clip:content-box!important;background-position:50% 50%!important;background-color:rgba(0,0,0,0)!important;background-image:var(--sf-img-16)!important;background-size:100% 100%!important;background-origin:content-box!important;background-repeat:no-repeat!important"></a></p>
<div><b>Reason:</b> Flashing you guest GPU for the purpose of a GPU passthrough is <b>never</b> good advice. A full section should be dedicated to VBIOS compatibility. (Discuss in <a href=https://wiki.archlinux.org/title/Talk:PCI_passthrough_via_OVMF#UEFI_(OVMF)_Compatibility_in_VBIOS title="Talk:PCI passthrough via OVMF">Talk:PCI passthrough via OVMF#UEFI (OVMF) Compatibility in VBIOS</a>)</div>
</div>
<p>With respect to <a rel=nofollow class="external text" href=https://pve.proxmox.com/wiki/Pci_passthrough#How_to_known_if_card_is_UEFI_.28ovmf.29_compatible>this article</a>:
<p>Error 43 can be caused by the GPU's VBIOS without UEFI support. To check whenever your VBIOS supports it, you will have to use <code>rom-parser</code>:
</p>
<pre>$ git clone <a rel=nofollow class="external free" href=https://github.com/awilliam/rom-parser>https://github.com/awilliam/rom-parser</a>
$ cd rom-parser &amp;&amp; make
</pre>
<p>Dump the GPU VBIOS:
</p>
<pre># echo 1 &gt; /sys/bus/pci/devices/0000:01:00.0/rom
# cat /sys/bus/pci/devices/0000:01:00.0/rom &gt; /tmp/image.rom
# echo 0 &gt; /sys/bus/pci/devices/0000:01:00.0/rom
</pre>
<p>And test it for compatibility:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ ./rom-parser /tmp/image.rom</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>Valid ROM signature found @600h, PCIR offset 190h
	PCIR: type 0 (x86 PC-AT), vendor: 10de, device: 1184, class: 030000
	PCIR: revision 0, vendor revision: 1
Valid ROM signature found @fa00h, PCIR offset 1ch
	PCIR: type 3 (EFI), vendor: 10de, device: 1184, class: 030000
	PCIR: revision 3, vendor revision: 0
		EFI: Signature Valid, Subsystem: Boot, Machine: X64
	Last image
</pre>
<p>To be UEFI compatible, you need a "type 3 (EFI)" in the result. If it is not there, try updating your GPU VBIOS. GPU manufacturers often share VBIOS upgrades on their support pages. A large database of known compatible and working VBIOSes (along with their UEFI compatibility status!) is available on <a rel=nofollow class="external text" href=https://www.techpowerup.com/vgabios/>TechPowerUp</a>.
<p>Updated VBIOS can be used in the virtual machine without flashing. To load it in QEMU:
</p>
<pre>-device vfio-pci,host=07:00.0,......,romfile=/path/to/your/gpu/bios.bin \
</pre>
<p>And in libvirt:
</p>
<pre>&lt;hostdev&gt;
     ...
     &lt;rom file='/path/to/your/gpu/bios.bin'/&gt;
     ...
   &lt;/hostdev&gt;</pre>
<p>One should compare VBIOS versions between host and guest systems using <a rel=nofollow class="external text" href=https://www.techpowerup.com/download/nvidia-nvflash/>nvflash</a> (Linux versions under <i>Show more versions</i>) or 
<a rel=nofollow class="external text" href=https://www.techpowerup.com/download/techpowerup-gpu-z/>GPU-Z</a> (in Windows guest). To check the currently loaded VBIOS:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ ./nvflash --version</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>...
Version              &nbsp;: 80.04.XX.00.97
...
UEFI Support         &nbsp;: No
UEFI Version         &nbsp;: N/A
UEFI Variant Id      &nbsp;: N/A ( Unknown )
UEFI Signer(s)       &nbsp;: Unsigned
...
</pre>
<p>And to check a given VBIOS file:
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>$ ./nvflash --version NV299MH.rom</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>...
Version              &nbsp;: 80.04.XX.00.95
...
UEFI Support         &nbsp;: Yes
UEFI Version         &nbsp;: 0x10022 (Jul  2 2013 @ 16377903 )
UEFI Variant Id      &nbsp;: 0x0000000000000004 ( GK1xx )
UEFI Signer(s)       &nbsp;: Microsoft Corporation UEFI CA 2011
...
</pre>
<p>If the external ROM did not work as it should in the guest, you will have to flash the newer VBIOS image to the GPU. In some cases it is possible to create your own VBIOS image with UEFI support using <a rel=nofollow class="external text" href=https://www.win-raid.com/t892f16-AMD-and-Nvidia-GOP-update-No-requests-DIY.html>GOPUpd</a> tool, however this is risky and may result in GPU brick.
</p>
<div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning:</strong> Failure during flashing may "brick" your GPU - recovery may be possible, but rarely easy and often requires additional hardware. <b>DO NOT</b> flash VBIOS images for other GPU models (different boards may use different VBIOSes, clocks, fan configuration). If it breaks, you get to keep all the pieces.</div>
<p>In order to avoid the irreparable damage to your graphics adapter it is necessary to unload the NVIDIA kernel driver first:
</p>
<pre># modprobe -r nvidia_modeset nvidia 
</pre>
<p>Flashing the VBIOS can be done with:
</p>
<pre># ./nvflash romfile.bin
</pre>
<div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning:</strong> <b>DO NOT</b> interrupt the flashing process, even if it looks like it is stuck. Flashing should take about a minute on most GPUs, but may take longer.</div>
<h3><span class=mw-headline id=Slowed_down_audio_pumped_through_HDMI_on_the_video_card>Slowed down audio pumped through HDMI on the video card</span></h3>
<p>For some users, the virtual machine's audio slows down/starts stuttering/becomes demonic after a while when it is pumped through HDMI on the video card. This usually also slows down graphics.
A possible solution consists of enabling MSI (Message Signaled-Based Interrupts) instead of the default (Line-Based Interrupts).
<p>In order to check whether MSI is supported or enabled, run the following command as root:
</p>
<pre># lspci -vs $device | grep 'MSI:'
</pre>
<p>where `$device` is the card's address (e.g. `01:00.0`).
<p>The output should be similar to:
</p>
<pre>Capabilities: [60] MSI: Enable<b>-</b> Count=1/1 Maskable- 64bit+
</pre>
<p>A <code>-</code> after <code>Enable</code> means MSI is supported, but not used by the virtual machine, while a <code>+</code> says that the virtual machine is using it.
<p>The procedure to enable it is quite complex, instructions and an overview of the setting can be found <a rel=nofollow class="external text" href="https://forums.guru3d.com/showthread.php?t=378044">here</a>.
<p>On a linux guest you can use modinfo to see if there is option to enable MSI (for example: "modinfo snd_hda_intel |grep msi"). If there is, one can enable it by adding the relevant option to a custom omdprobe file - in "/etc/modprobe.d/snd-hda-intel.conf" inserting "options snd-hda-intel enable_msi=1"
<p>Other hints can be found on the <a rel=nofollow class="external text" href=https://lime-technology.com/wiki/index.php/UnRAID_6/VM_Guest_Support#Enable_MSI_for_Interrupts_to_Fix_HDMI_Audio_Support>lime-technology's wiki</a>, or on this article on <a rel=nofollow class="external text" href=https://vfio.blogspot.it/2014/09/vfio-interrupts-and-how-to-coax-windows.html>VFIO tips and tricks</a>.
<p>A UI tool called <a rel=nofollow class="external text" href=https://forums.guru3d.com/threads/windows-line-based-vs-message-signaled-based-interrupts-msi-tool.378044/>MSI Utility (FOSS Version 2)</a> works with Windows 10 64-bit and simplifies the process.
<p>In order to fix the issues enabling MSI on the 0 function of a nVidia card (<code>01:00.0 VGA compatible controller: NVIDIA Corporation GM206 [GeForce GTX 960] (rev a1) (prog-if 00 [VGA controller])</code>) was not enough; it will also be required to enable it on the other function (<code>01:00.1 Audio device: NVIDIA Corporation Device 0fba (rev a1)</code>) to fix the issue.
</p>
<h3><span class=mw-headline id=No_HDMI_audio_output_on_host_when_intel_iommu_is_enabled>No HDMI audio output on host when intel_iommu is enabled</span></h3>
<p>If after enabling <code>intel_iommu</code> the HDMI output device of Intel GPU becomes unusable on the host then setting the option <code>igfx_off</code> (i.e. <code>intel_iommu=on,igfx_off</code>) might bring the audio back, please read <a rel=nofollow class="external text" href=https://www.kernel.org/doc/html/latest/x86/intel-iommu.html#graphics-problems>intel-iommu.html</a> for details about setting <code>igfx_off</code>.
</p>
<h3><span class=mw-headline id=X_does_not_start_after_enabling_vfio_pci>X does not start after enabling vfio_pci</span></h3>
<p>This is related to the host GPU being detected as a secondary GPU, which causes X to fail/crash when it tries to load a driver for the guest GPU. To circumvent this, a Xorg configuration file specifying the BusID for the host GPU is required. The correct BusID can be acquired from <code>lspci -n</code> or the Xorg log <a rel=nofollow class="external autonumber" href=https://www.redhat.com/archives/vfio-users/2016-August/msg00025.html>[7]</a>. Note that the value from the <i>lspci</i> output is hexadecimal and should be converted to decimal in the <i>.conf</i> file.
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>/etc/X11/xorg.conf.d/10-intel.conf</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>Section "Device"
        Identifier "Intel GPU"
        Driver "modesetting"
        BusID  "PCI:0:2:0"
EndSection
</pre>
<h3><span class=mw-headline id=Chromium_ignores_integrated_graphics_for_acceleration>Chromium ignores integrated graphics for acceleration</span></h3>
<p>Chromium and friends will try to detect as many GPUs as they can in the system and pick which one is preferred (usually discrete NVIDIA/AMD graphics). It tries to pick a GPU by looking at PCI devices, not OpenGL renderers available in the system - the result is that Chromium may ignore the integrated GPU available for rendering and try to use the dedicated GPU bound to the <code>vfio-pci</code> driver, and unusable on the host system, regardless of whenever a guest virtual machine is running or not. This results in software rendering being used (leading to higher CPU load, which may also result in choppy video playback, scrolling and general un-smoothness).
<p>This can be fixed by <a href=https://wiki.archlinux.org/title/Chromium/Tips_and_tricks#Forcing_specific_GPU class=mw-redirect title="Chromium/Tips and tricks">explicitly telling Chromium which GPU you want to use</a>.
</p>
<h3><span class=mw-headline id=Virtual_machine_only_uses_one_core>Virtual machine only uses one core</span></h3>
<p>For some users, even if IOMMU is enabled and the core count is set to more than 1, the virtual machine still only uses one CPU core and thread. To solve this enable "Manually set CPU topology" in <code>virt-manager</code> and set it to the desirable amount of CPU sockets, cores and threads. Keep in mind that "Threads" refers to the thread count per CPU, not the total count.
</p>
<h3><span class=mw-headline id=Passthrough_seems_to_work_but_no_output_is_displayed>Passthrough seems to work but no output is displayed</span></h3>
<p>Make sure if you are using virt-manager that UEFI firmware is selected for your virtual machine. Also, make sure you have passed the correct device to the virtual machine.
</p>
<h3><span class=mw-headline id=Host_lockup_after_virtual_machine_shutdown>Host lockup after virtual machine shutdown</span></h3>
<p>This issue seems to primarily affect users running a Windows 10 guest and usually after the virtual machine has been run for a prolonged period of time: the host will experience multiple CPU core lockups (see <a rel=nofollow class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=206050&amp;p=2">[8]</a>). To fix this try enabling Message Signal Interrupts on the GPU passed through to the guest. A good guide for how to do this can be found in <a rel=nofollow class="external autonumber" href=https://forums.guru3d.com/threads/windows-line-based-vs-message-signaled-based-interrupts.378044/>[9]</a>. You can also download this application for windows here <a rel=nofollow class="external autonumber" href=https://github.com/TechtonicSoftware/MSIInturruptEnabler>[10]</a> that should make the process easier.
</p>
<h3><span class=mw-headline id=Host_lockup_if_guest_is_left_running_during_sleep>Host lockup if guest is left running during sleep</span></h3>
<p>VFIO-enabled virtual machines tend to become unstable if left running through a sleep/wakeup cycle and have been known to cause the host machine to lockup when an attempt is then made to shut them down. In order to avoid this, one can simply prevent the host from going into sleep while the guest is running using the following libvirt hook script and systemd unit. The hook file needs executable permissions to work.
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>/etc/libvirt/hooks/qemu</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>#!/bin/sh

OBJECT="$1"
OPERATION="$2"
SUBOPERATION="$3"
EXTRA_ARG="$4"

case "$OPERATION" in
        "prepare")
                systemctl start libvirt-nosleep@"$OBJECT"
               &nbsp;;;
        "release")
                systemctl stop libvirt-nosleep@"$OBJECT"
               &nbsp;;;
esac</pre>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>/etc/systemd/system/libvirt-nosleep@.service</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>[Unit]
Description=Preventing sleep while libvirt domain "%i" is running

[Service]
Type=simple
ExecStart=/usr/bin/systemd-inhibit --what=sleep --why="Libvirt domain \"%i\" is running" --who=%U --mode=block sleep infinity</pre>
<h3><span class=mw-headline id=Cannot_boot_after_upgrading_ovmf>Cannot boot after upgrading ovmf</span></h3>
<p>If you cannot boot after upgrading from <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href="https://archlinux.org/packages/?name=edk2-ovmf">edk2-ovmf</a></span> version 1:r23112.018432f0ce-1 then you need to remove the old <code>*VARS.fd</code> file in <code>/var/lib/libvirt/qemu/nvram/</code>:
</p>
<pre># mv /var/lib/libvirt/qemu/nvram/vmname_VARS.fd /var/lib/libvirt/qemu/nvram/vmname_VARS.fd.old
</pre>
<p>See <a rel=nofollow class="external text" href=https://bugs.archlinux.org/task/57825>FS#57825</a> for further details.
</p>
<h3><span class=mw-headline id=Bluescreen_at_boot_since_Windows_10_1803>Bluescreen at boot since Windows 10 1803</span></h3>
<p>Since Windows 10 1803 there is a problem when you are using "host-passthrough" as cpu model. The machine cannot boot and is either boot looping or you get a bluescreen.
You can workaround this by:
</p>
<pre># echo 1 &gt; /sys/module/kvm/parameters/ignore_msrs
</pre>
<p>To make it permanently you can create a modprobe file <code>kvm.conf</code>:
</p>
<pre>options kvm ignore_msrs=1
</pre>
<p>To prevent clogging up <i>dmesg</i> with "ignored rdmsr" messages you can additionally add:
</p>
<pre>options kvm report_ignored_msrs=0
</pre>
<h3><span id=AMD_Ryzen_.2F_BIOS_updates_.28AGESA.29_yields_.22Error:_internal_error:_Unknown_PCI_header_type_.E2.80.98127.E2.80.99.22></span><span class=mw-headline id='AMD_Ryzen_/_BIOS_updates_(AGESA)_yields_"Error:_internal_error:_Unknown_PCI_header_type_127"'>AMD Ryzen / BIOS updates (AGESA) yields "Error: internal error: Unknown PCI header type 127"</span></h3>
<p>AMD users have been experiencing breakage of their KVM setups after updating the BIOS on their motherboard. There is a kernel <a rel=nofollow class="external text" href=https://clbin.com/VCiYJ>patch</a>, (see <a href=https://wiki.archlinux.org/title/Kernel/Arch_Build_System title="Kernel/Arch Build System">Kernel/Arch Build System</a> for instruction on compiling kernels with custom patches) that can resolve the issue as of now (7/28/19), but this is not the first time AMD has made an error of this very nature, so take this into account if you are considering updating your BIOS in the future as a VFIO user.
</p>
<h3><span id=AMD_GPU_not_resetting_properly_yielding_.22Error:_internal_error:_Unknown_PCI_header_type_.E2.80.98127.E2.80.99.22_.28Separate_issue_from_the_one_above.29></span><span class=mw-headline id='AMD_GPU_not_resetting_properly_yielding_"Error:_internal_error:_Unknown_PCI_header_type_127"_(Separate_issue_from_the_one_above)'>AMD GPU not resetting properly yielding "Error: internal error: Unknown PCI header type 127" (Separate issue from the one above)</span></h3>
<p>Passing through an AMD GPU may result into a problem known as the "AMD reset bug". Upon power cycling the guest, the GPU does not properly reset its state which causes the device to malfunction until the host is also rebooted. This is usually paired with a "code 43" driver error in a Windows guest, and the message "Error: internal error: Unknown PCI header type '127'" in the libvirt log on the host.
<p>In the past, this meant having to use work-arounds to manually reset the GPU, or resorting to the use of kernel patches that were unlikely to land in upstream. Currently, the recommended solution that does not require patching of the kernel is to install <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href=https://aur.archlinux.org/packages/vendor-reset-git/>vendor-reset-git</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href=https://aur.archlinux.org/packages/vendor-reset-dkms-git/>vendor-reset-dkms-git</a></span><sup><small>AUR</small></sup> and making sure the 'vendor-reset' kernel module is loaded before booting the guest. For convenience, you can <a href=https://wiki.archlinux.org/title/Kernel_module#Automatic_module_loading_with_systemd title="Kernel module">load the module automatically</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note"><strong>Note:</strong> Make sure you do not have any of the AMD reset bug kernel patches installed if you are using <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href=https://aur.archlinux.org/packages/vendor-reset-git/>vendor-reset-git</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel=nofollow class="external text" href=https://aur.archlinux.org/packages/vendor-reset-dkms-git/>vendor-reset-dkms-git</a></span><sup><small>AUR</small></sup>.</div>
<h3><span class=mw-headline id=Host_crashes_when_hotplugging_Nvidia_card_with_USB>Host crashes when hotplugging Nvidia card with USB</span></h3>
<p>If attempting to hotplug an Nvidia card with a USB port, you may have to blacklist the <code>i2c_nvidia_gpu</code> driver. Do this by adding the line <code>blacklist i2c_nvidia_gpu</code> to <code>/etc/modprobe.d/blacklist.conf</code>.
</p>
<h3><span class=mw-headline id=Host_unable_to_boot_and_stuck_in_black_screen_after_enabling_vfio>Host unable to boot and stuck in black screen after enabling vfio</span></h3>
<p>If debug kernel messages during boot are enabled by adding with the <code>debug ignore_loglevel</code> <a href=https://wiki.archlinux.org/title/Kernel_parameters title="Kernel parameters">kernel parameters</a>, you may see boot stuck with the last message similar to:
</p>
<pre>vfio-pci 0000:01:00.0: vgaarb: changed VGA decodes: olddecodes=io+mem,decodes=io+mem:owns=none
</pre>
<p>This can be mitigated by disconnecting the passed-through GPU from your monitor. You may reconnect the passed-through GPU to a monitor after the host has booted.
<p>If you do not want to plug the cable in each time you boot the host. You can disable the framebuffer in your boot loader to bypass this message. For <a href=https://wiki.archlinux.org/title/UEFI class=mw-redirect title=UEFI>UEFI</a> systems you can add <code>video=efifb:off</code> as a kernel parameter. For legacy support, use <code>video=vesafb:off</code> instead or in conjunction. Note that doing this may cause issues with <a href=https://wiki.archlinux.org/title/Xorg title=Xorg>Xorg</a>. 
<p>If you encounter problems with <a href=https://wiki.archlinux.org/title/Xorg title=Xorg>Xorg</a>, the following solution may help (remember to substitute with your own values if needed).
</p>
<pre style=margin-bottom:0;border-bottom:none;padding-bottom:0.8em>/etc/X11/xorg.conf.d/10-amd.conf</pre>
<pre style=margin-top:0;border-top-style:dashed;padding-top:0.8em>Section "Device"
        Identifier "AMD GPU"
        Driver "amdgpu"
        BusID  "PCI:0:2:0"
EndSection</pre>
<h3><span class=mw-headline id=AER_errors_when_passing_through_PCIe_USB_hub>AER errors when passing through PCIe USB hub</span></h3>
<p>In some cases passing through a PCIe USB hub, such as one connected to the guest GPU, might fail with AER errors similar to the following:
</p>
<pre>kernel: pcieport 0000:00:01.1: AER: Uncorrected (Non-Fatal) error received: 0000:00:01.1
kernel: pcieport 0000:00:01.1: AER: PCIe Bus Error: severity=Uncorrected (Non-Fatal), type=Transaction Layer, (Requester ID)
kernel: pcieport 0000:00:01.1: AER:   device [8086:1905] error status/mask=00100000/00000000
kernel: pcieport 0000:00:01.1: AER:    [20] UnsupReq               (First)
kernel: pcieport 0000:00:01.1: AER:   TLP Header: 00000000 00000000 00000000 00000000
kernel: pcieport 0000:00:01.1: AER: device recovery successful
</pre>
<h3><span id=Reserved_Memory_Region_Reporting_.28RMRR.29_Conflict></span><span class=mw-headline id=Reserved_Memory_Region_Reporting_(RMRR)_Conflict>Reserved Memory Region Reporting (RMRR) Conflict</span></h3>
<p>If you run into an issue passing through a device because of the BIOS's usage of RMRR, like the error below.
</p>
<pre>vfio-pci 0000:01:00.1: Device is ineligible for IOMMU domain attach due to platform RMRR requirement. Contact your platform vendor.
</pre>
<p>You can try the patches here: <a rel=nofollow class="external free" href=https://github.com/kiler129/relax-intel-rmrr>https://github.com/kiler129/relax-intel-rmrr</a>
</p>
<h3><span class=mw-headline id=Too-low_frequency_limit_for_AMD_GPU_passed-through_to_virtual_machine>Too-low frequency limit for AMD GPU passed-through to virtual machine</span></h3>
<p>On some machines with AMD GPUs, binding the devices to vfio-pci may be insufficient to prevent interference from the host, since the amdgpu driver on the host may query global ATIF methods which can alter the behavior of the GPU. For example, a user with a Dell Precision 7540 laptop containing a Radon Pro WX 3200 AMD GPU reported that, with the AMD GPU bound to vfio-pci, the passed-through AMD GPU was limited to 501 MHz instead of the correct 1295 MHz limit. <a href=https://wiki.archlinux.org/title/Kernel_module#Blacklisting title="Kernel module">Blacklisting</a> the amdgpu kernel module using the kernel command line was a workaround.
<p>See <a rel=nofollow class="external text" href=https://lore.kernel.org/regressions/092b825a-10ff-e197-18a1-d3e3a097b0e3@leemhuis.info/T/>this kernel mailing list discussion</a> for further details.
</p>
<h2><span class=mw-headline id=See_also>See also</span></h2>
<ul><li><a rel=nofollow class="external text" href=https://www.redhat.com/archives/vfio-users/>VFIO users mailing list</a></li>
<li><a rel=nofollow class="external text" href=https://www.reddit.com/r/VFIO>/r/VFIO: A subreddit focused on vfio</a></li>
<li><a rel=nofollow class="external text" href=https://github.com/intel/gvt-linux/wiki/GVTd_Setup_Guide>GVT-d: passthrough of an entire integrated GPU</a></ul>
</div>
<div class="printfooter sf-hidden">Retrieved from ""</div></div>
 <div id=catlinks class=catlinks data-mw=interface><div id=mw-normal-catlinks class=mw-normal-catlinks><a href=https://wiki.archlinux.org/title/Special:Categories title=Special:Categories>Category</a>: <ul><li><a href=https://wiki.archlinux.org/title/Category:Virtualization title=Category:Virtualization>Virtualization</a></ul></div><div id=mw-hidden-catlinks class="mw-hidden-catlinks mw-hidden-cats-hidden sf-hidden">Hidden categories: </div></div>
 </div>
</main>
 </div> 
</div> 
<div class="mw-workspace-container mw-footer-container">
 <div class=mw-content-container>
 <footer id=footer class=mw-footer role=contentinfo>
 <ul id=footer-info>
 <li id=footer-info-lastmod> This page was last edited on 27 March 2022, at 20:35.</li>
 <li id=footer-info-copyright>Content is available under <a class=external rel=nofollow href=http://www.gnu.org/copyleft/fdl.html>GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
</ul>
 <ul id=footer-places>
 <li id=footer-places-privacy><a href=https://terms.archlinux.org/docs/privacy-policy/ class=extiw title=archlinux-service-agreements:privacy-policy>Privacy policy</a></li>
 <li id=footer-places-about><a href=https://wiki.archlinux.org/title/ArchWiki:About title=ArchWiki:About>About ArchWiki</a></li>
 <li id=footer-places-disclaimer><a href=https://wiki.archlinux.org/title/ArchWiki:General_disclaimer title="ArchWiki:General disclaimer">Disclaimers</a></li>
</ul>
 
</footer>
 </div>
</div>
 </div> 
</div> 
<grammarly-desktop-integration data-grammarly-shadow-root=true><template shadowmode=open><style class=sf-hidden>div.grammarly-desktop-integration{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}div.grammarly-desktop-integration:before{content:attr(data-content)}</style><div aria-label=grammarly-integration role=group tabindex=-1 class=grammarly-desktop-integration data-content='{"mode":"full","isActive":true,"isUserDisabled":false}'></div></template></grammarly-desktop-integration><script data-template-shadow-root>(()=>{document.currentScript.remove();processNode(document);function processNode(node){node.querySelectorAll("template[shadowmode]").forEach(element=>{let shadowRoot = element.parentElement.shadowRoot;if (!shadowRoot) {try {shadowRoot=element.parentElement.attachShadow({mode:element.getAttribute("shadowmode"),delegatesFocus:Boolean(element.getAttribute("delegatesfocus"))});shadowRoot.innerHTML=element.innerHTML;element.remove()} catch (error) {} if (shadowRoot) {processNode(shadowRoot)}}})}})()</script></body><!-- Cached/compressed 20220427041628 --><script>document.currentScript.remove();!function(){"use strict";(t=>{const n="singlefile-infobar",e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABAAgMAAADXB5lNAAABhmlDQ1BJQ0MgcHJvZmlsZQAAKJF9kj1Iw0AYht+mSkUrDnYQcchQnSyIijqWKhbBQmkrtOpgcukfNGlIUlwcBdeCgz+LVQcXZ10dXAVB8AfEydFJ0UVK/C4ptIjx4LiH9+59+e67A4RGhalm1wSgapaRisfEbG5VDLyiDwEAvZiVmKkn0osZeI6ve/j4ehfhWd7n/hz9St5kgE8kjjLdsIg3iGc2LZ3zPnGIlSSF+Jx43KACiR+5Lrv8xrnosMAzQ0YmNU8cIhaLHSx3MCsZKvE0cVhRNcoXsi4rnLc4q5Uaa9XJbxjMaytprtMcQRxLSCAJETJqKKMCCxFaNVJMpGg/5uEfdvxJcsnkKoORYwFVqJAcP/gb/O6tWZiadJOCMaD7xbY/RoHALtCs2/b3sW03TwD/M3Cltf3VBjD3SXq9rYWPgIFt4OK6rcl7wOUOMPSkS4bkSH6aQqEAvJ/RM+WAwVv6EGtu31r7OH0AMtSr5Rvg4BAYK1L2use9ezr79u+ZVv9+AFlNcp0UUpiqAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5AsHAB8H+DhhoQAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAJUExURQAAAICHi4qKioTuJAkAAAABdFJOUwBA5thmAAAAAWJLR0QCZgt8ZAAAAJJJREFUOI3t070NRCEMA2CnYAOyDyPwpHj/Va7hJ3FzV7zy3ET5JIwoAF6Jk4wzAJAkzxAYG9YRTgB+24wBgKmfrGAKTcEfAY4KRlRoIeBTgKOCERVaCPgU4Khge2GqKOBTgKOCERVaAEC/4PNcnyoSWHpjqkhwKxbcig0Q6AorXYF/+A6eIYD1lVbwG/jdA6/kA2THRAURVubcAAAAAElFTkSuQmCC",o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABAAgMAAADXB5lNAAABhmlDQ1BJQ0MgcHJvZmlsZQAAKJF9kj1Iw0AYht+mSkUrDnYQcchQnSyIijqWKhbBQmkrtOpgcukfNGlIUlwcBdeCgz+LVQcXZ10dXAVB8AfEydFJ0UVK/C4ptIjx4LiH9+59+e67A4RGhalm1wSgapaRisfEbG5VDLyiDwEAvZiVmKkn0osZeI6ve/j4ehfhWd7n/hz9St5kgE8kjjLdsIg3iGc2LZ3zPnGIlSSF+Jx43KACiR+5Lrv8xrnosMAzQ0YmNU8cIhaLHSx3MCsZKvE0cVhRNcoXsi4rnLc4q5Uaa9XJbxjMaytprtMcQRxLSCAJETJqKKMCCxFaNVJMpGg/5uEfdvxJcsnkKoORYwFVqJAcP/gb/O6tWZiadJOCMaD7xbY/RoHALtCs2/b3sW03TwD/M3Cltf3VBjD3SXq9rYWPgIFt4OK6rcl7wOUOMPSkS4bkSH6aQqEAvJ/RM+WAwVv6EGtu31r7OH0AMtSr5Rvg4BAYK1L2use9ezr79u+ZVv9+AFlNcp0UUpiqAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5AsHAB8VC4EQ6QAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAJUExURQAAAICHi4qKioTuJAkAAAABdFJOUwBA5thmAAAAAWJLR0QCZgt8ZAAAAJtJREFUOI3NkrsBgCAMRLFwBPdxBArcfxXFkO8rbKWAAJfHJ9faf9vuYX/749T5NmShm3bEwbe2SxeuM4+2oxDL1cDoKtVUjRy+tH78Cv2CS+wIiQNC1AEhk4AQeUTMWUJMfUJMSEJMSEY8kIx4IONroaYAimNxsXp1PA7PxwfVL8QnowwoVC0lig07wDDVUjAdbAnjwtow/z/bDW7eI4M2KruJAAAAAElFTkSuQmCC",i="SingleFile",A="single-file-ui-element",r="\n\t.infobar {\n\t\tbackground-color: #737373;\n\t\tcolor: white;\n\t\tdisplay: flex;\n\t\tposition: fixed;\n\t\ttop: 16px;\n\t\tright: 16px;\n\t\theight: auto;\n\t\twidth: auto;\n\t\tmin-height: 24px;\n\t\tmin-width: 24px;\n\t\tbackground-position: center;\n\t\tbackground-repeat: no-repeat;\n\t\tz-index: 2147483647;\n\t\tmargin: 0 0 0 16px;\n\t\tbackground-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABABAMAAABYR2ztAAABhmlDQ1BJQ0MgcHJvZmlsZQAAKJF9kj1Iw0AYht+mSkUrDnYQcchQnSyIijqWKhbBQmkrtOpgcukfNGlIUlwcBdeCgz+LVQcXZ10dXAVB8AfEydFJ0UVK/C4ptIjx4LiH9+59+e67A4RGhalm1wSgapaRisfEbG5VDLyiDwEAvZiVmKkn0osZeI6ve/j4ehfhWd7n/hz9St5kgE8kjjLdsIg3iGc2LZ3zPnGIlSSF+Jx43KACiR+5Lrv8xrnosMAzQ0YmNU8cIhaLHSx3MCsZKvE0cVhRNcoXsi4rnLc4q5Uaa9XJbxjMaytprtMcQRxLSCAJETJqKKMCCxFaNVJMpGg/5uEfdvxJcsnkKoORYwFVqJAcP/gb/O6tWZiadJOCMaD7xbY/RoHALtCs2/b3sW03TwD/M3Cltf3VBjD3SXq9rYWPgIFt4OK6rcl7wOUOMPSkS4bkSH6aQqEAvJ/RM+WAwVv6EGtu31r7OH0AMtSr5Rvg4BAYK1L2use9ezr79u+ZVv9+AFlNcp0UUpiqAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5AsHADIRLMaOHwAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAPUExURQAAAIqKioyNjY2OjvDw8L2y1DEAAAABdFJOUwBA5thmAAAAAWJLR0QB/wIt3gAAAGNJREFUSMdjYCAJsLi4OBCQx6/CBQwIGIDPCBcXAkYQUsACU+AwlBVQHg6Eg5pgZBGOboIJZugDFwRwoJECJCUOhJI1wZwzqmBUwagCuipgIqTABG9h7YIKaKGAURAFEF/6AQAO4HqSoDP8bgAAAABJRU5ErkJggg==);\n\t\tborder-radius: 16px;\n\t\tuser-select: none;\n\t\t-moz-user-select: none;\n\t\topacity: .7;\n\t\tcursor: pointer;\n\t\tpadding-left: 0;\n\t\tpadding-right: 0;\n\t\tpadding-top: 0;\n\t\tpadding-bottom: 0;\n\t\tborder: 2px solid #eee;\n\t\tbackground-size: 70% 70%;\n\t\ttransition: all 250ms;\n\t\tfont-size: 13px;\n\t}\n\t.infobar:hover {\n\t\topacity: 1;\n\t}\n\t.infobar-open {\n\t\topacity: 1;\n\t\tbackground-color: #f9f9f9;\n\t\tcursor: auto;\n\t\tcolor: #2d2d2d;\n\t\tpadding-top: 2px;\n\t\tpadding-bottom: 2px;\n\t\tborder: 2px solid #878787;\n\t\tbackground-image: none;\n\t\tborder-radius: 8px;\n\t\tuser-select: initial;\n\t\t-moz-user-select: initial;\n\t}\n\t.infobar-close-button {\n\t\tdisplay: none;\n\t\topacity: .7;\n\t\tpadding-top: 4px;\n\t\tpadding-left: 8px;\n\t\tpadding-right: 8px;\n\t\tcursor: pointer;\n\t\ttransition: opacity 250ms;\n\t\theight: 16px;\n\t}\n\t.infobar-close-button:hover {\n\t\topacity: 1;\n\t}\n\t.infobar-content {\n\t\tdisplay: none;\n\t\tfont-family: Arial;\n\t\tfont-size: 14px;\n\t\tline-height: 22px;\n\t\tword-break: break-word;\n\t\twhite-space: pre-wrap;\n\t\tposition: relative;\n\t\ttop: 1px;\n\t\ttext-align: left;\n\t}\n\t.infobar-link {\n\t\tdisplay: none;\n\t\tpadding-left: 8px;\n\t\tpadding-right: 8px;\n\t\tline-height: 11px;\n\t\tcursor: pointer;\n\t\tuser-select: none;\n\t\toutline: 0;\n\t}\n\t.infobar-link-icon {\n\t\tpadding-top: 4px;\n\t\tpadding-left: 2px;\n\t\tcursor: pointer;\n\t\topacity: .7;\n\t\ttransition: opacity 250ms;\n\t\theight: 16px;\n\t}\n\t.infobar-link-icon:hover {\n\t\topacity: 1;\n\t}\n\t.infobar-open .infobar-close-button, .infobar-open .infobar-content, .infobar-open .infobar-link {\n\t\tdisplay: inline-block;\n\t}";let a=!0;const c=t.browser;async function s(){const t=document.evaluate("//comment()",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);let s=t&&t.singleNodeValue;if(s&&((p=s).nodeType==Node.COMMENT_NODE&&p.textContent.includes(i))){const t=s.textContent.split("\n"),[,,i,p,...g]=t;if(i&&p){let t;t=c&&c.runtime&&c.runtime.sendMessage?await c.runtime.sendMessage({method:"tabs.getOptions",url:i}):{displayInfobar:!0},t.displayInfobar&&await async function(t,i,c){let s=document.querySelector(n);if(!s){if(t=t.split("url: ")[1],i=i.split("saved date: ")[1],c&&c.length>1){let t=c[0].split("info: ")[1].trim();for(let n=1;n<c.length-1;n++)t+="\n"+c[n].trim();c=t.trim()}else c=i;s=d(n,document.body),s.className=A;const p=await async function(t){if(t.attachShadow)return t.attachShadow({mode:"open"});{a=!1;const n=d("iframe",t);return n.style.setProperty("background-color","transparent","important"),n.style.setProperty("position","fixed","important"),n.style.setProperty("top",0,"important"),n.style.setProperty("right",0,"important"),n.style.setProperty("width","44px","important"),n.style.setProperty("height","48px","important"),n.style.setProperty("z-index",2147483647,"important"),new Promise((t=>{n.contentDocument.body.style.setProperty("margin",0),n.onload=()=>t(n.contentDocument.body)}))}}(s),g=document.createElement("style");g.textContent=r,p.appendChild(g);const u=document.createElement("div");u.classList.add("infobar"),p.appendChild(u);const h=document.createElement("img");h.classList.add("infobar-close-button"),u.appendChild(h),h.src=o,h.onclick=t=>{0===t.button&&s.remove()};const m=document.createElement("span");u.appendChild(m),m.classList.add("infobar-content"),m.textContent=c;const b=document.createElement("a");b.classList.add("infobar-link"),u.appendChild(b),b.target="_blank",b.rel="noopener noreferrer",b.title="Open source URL: "+t,b.href=t;const f=document.createElement("img");f.classList.add("infobar-link-icon"),b.appendChild(f),f.src=e,l(u),document.addEventListener("click",(t=>{if(0===t.button){let n=t.target;for(;n&&n!=s;)n=n.parentElement;n!=s&&l(u)}}))}}(i,p,g)}}var p}function l(t){if(t.classList.remove("infobar-open"),t.onclick=e=>{if(0===e.button)return function(t){a||document.querySelector(n).childNodes[0].contentWindow.getSelection().removeAllRanges();if(t.classList.add("infobar-open"),t.onclick=null,t.onmouseout=null,!a){const e=document.querySelector(n).childNodes[0];e.style.setProperty("width","100vw","important"),e.style.setProperty("height","100vh","important"),e.style.setProperty("width",t.getBoundingClientRect().width+33+"px","important"),e.style.setProperty("height",t.getBoundingClientRect().height+21+"px","important")}}(t),!1},!a){const t=document.querySelector(n).childNodes[0];t.style.setProperty("width","44px","important"),t.style.setProperty("height","48px","important")}}function d(t,n){const e=document.createElement(t);return n.appendChild(e),Array.from(getComputedStyle(e)).forEach((t=>e.style.setProperty(t,"initial","important"))),e}t.window==t.top&&("loading"==document.readyState?document.addEventListener("DOMContentLoaded",s,!1):s())})("object"==typeof globalThis?globalThis:window)}();</script>